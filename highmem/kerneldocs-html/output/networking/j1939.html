

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>J1939 Documentation &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Linux Networking Documentation" href="index.html"/>
        <link rel="next" title="Linux Networking and Network Devices APIs" href="kapi.html"/>
        <link rel="prev" title="IEEE 802.15.4 Developer’s Guide" href="ieee802154.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="device_drivers/index.html">Hardware Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="devlink/index.html">Linux Devlink Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="caif/index.html">CAIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">J1939 Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview-what-is-j1939">Overview / What Is J1939</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#specifications-used">Specifications used</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#motivation">Motivation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#j1939-concepts">J1939 concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pgn">PGN</a></li>
<li class="toctree-l4"><a class="reference internal" href="#addressing">Addressing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filtering">Filtering</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-j1939">How to Use J1939</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#api-calls">API Calls</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-addressing">Dynamic Addressing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#send-examples">Send Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="page_pool.html">Page Pool API</a></li>
<li class="toctree-l2"><a class="reference internal" href="phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l2"><a class="reference internal" href="nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="6pack.html">6pack Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="arcnet-hardware.html">ARCnet Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="arcnet.html">ARCnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="atm.html">ATM</a></li>
<li class="toctree-l2"><a class="reference internal" href="ax25.html">AX.25</a></li>
<li class="toctree-l2"><a class="reference internal" href="bonding.html">Linux Ethernet Bonding Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="cdc_mbim.html">cdc_mbim - Driver for CDC MBIM Mobile Broadband modems</a></li>
<li class="toctree-l2"><a class="reference internal" href="dccp.html">DCCP protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="dctcp.html">DCTCP (DataCenter TCP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="decnet.html">Linux DECnet Networking Layer Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="dns_resolver.html">DNS Resolver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="driver.html">Softnet Driver Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="eql.html">EQL Driver: Serial IP Load Balancing HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="fib_trie.html">LC-trie implementation notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="filter.html">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic-hdlc.html">Generic HDLC layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="generic_netlink.html">Generic Netlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="gen_stats.html">Generic networking statistics for netlink users</a></li>
<li class="toctree-l2"><a class="reference internal" href="gtp.html">The Linux kernel GTP tunneling module</a></li>
<li class="toctree-l2"><a class="reference internal" href="ila.html">Identifier Locator Addressing (ILA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="ioam6-sysctl.html">IOAM6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipddp.html">AppleTalk-IP Decapsulation and AppleTalk-IP Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip_dynaddr.html">IP dynamic address hack-port v0.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipsec.html">IPsec</a></li>
<li class="toctree-l2"><a class="reference internal" href="ip-sysctl.html">IP Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipvlan.html">IPVLAN Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="ipvs-sysctl.html">IPvs-sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="kcm.html">Kernel Connection Multiplexor</a></li>
<li class="toctree-l2"><a class="reference internal" href="l2tp.html">L2TP</a></li>
<li class="toctree-l2"><a class="reference internal" href="lapb-module.html">The Linux LAPB Module Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="mac80211-injection.html">How to use packet injection with mac80211</a></li>
<li class="toctree-l2"><a class="reference internal" href="mctp.html">Management Component Transport Protocol (MCTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="mpls-sysctl.html">MPLS Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="mptcp-sysctl.html">MPTCP Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="multiqueue.html">HOWTO for multiqueue network device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="netconsole.html">Netconsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="netdev-features.html">Netdev features mess and how to get out from it alive</a></li>
<li class="toctree-l2"><a class="reference internal" href="netdevices.html">Network Devices, the Kernel, and You!</a></li>
<li class="toctree-l2"><a class="reference internal" href="netfilter-sysctl.html">Netfilter Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="netif-msg.html">NETIF Msg Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="nexthop-group-resilient.html">Resilient Next-hop Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="nf_conntrack-sysctl.html">Netfilter Conntrack Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="nf_flowtable.html">Netfilter’s flowtable infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="openvswitch.html">Open vSwitch datapath developer documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="operstates.html">Operational States</a></li>
<li class="toctree-l2"><a class="reference internal" href="packet_mmap.html">Packet MMAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="phonet.html">Linux Phonet protocol family</a></li>
<li class="toctree-l2"><a class="reference internal" href="pktgen.html">HOWTO for the linux packet generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="plip.html">PLIP: The Parallel Line Internet Protocol Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="ppp_generic.html">PPP Generic Driver and Channel Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="proc_net_tcp.html">The proc/net/tcp and proc/net/tcp6 variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="radiotap-headers.html">How to use radiotap headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="rds.html">RDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="regulatory.html">Linux wireless regulatory documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html">RxRPC Network Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#socket-options">SOCKET OPTIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#security">SECURITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="rxrpc.html#example-client-usage">EXAMPLE CLIENT USAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="sctp.html">Linux Kernel SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="secid.html">LSM/SeLinux secid</a></li>
<li class="toctree-l2"><a class="reference internal" href="seg6-sysctl.html">Seg6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="smc-sysctl.html">SMC Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="statistics.html">Interface statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="strparser.html">Stream Parser (strparser)</a></li>
<li class="toctree-l2"><a class="reference internal" href="switchdev.html">Ethernet switch device driver model (switchdev)</a></li>
<li class="toctree-l2"><a class="reference internal" href="sysfs-tagging.html">Sysfs tagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="tc-actions-env-rules.html">TC Actions - Environmental Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="tcp-thin.html">Thin-streams and TCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="team.html">Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="timestamping.html">Timestamping</a></li>
<li class="toctree-l2"><a class="reference internal" href="tipc.html">Linux Kernel TIPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="tproxy.html">Transparent proxy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="tuntap.html">Universal TUN/TAP device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="udplite.html">The UDP-Lite protocol (RFC 3828)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vrf.html">Virtual Routing and Forwarding (VRF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="vxlan.html">Virtual eXtensible Local Area Networking documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html">Packet Layer to Device Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html#device-driver-to-packet-layer">Device Driver to Packet Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25-iface.html#requirements-for-the-device-driver">Requirements for the device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="x25.html">Linux X.25 Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_device.html">XFRM device - offloading the IPsec computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_proc.html">XFRM proc - /proc/net/xfrm_* files</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_sync.html">XFRM</a></li>
<li class="toctree-l2"><a class="reference internal" href="xfrm_sysctl.html">XFRM Syscall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Linux Networking Documentation</a> &raquo;</li>
        
      <li>J1939 Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/networking/j1939.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="j1939-documentation">
<h1>J1939 Documentation<a class="headerlink" href="#j1939-documentation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview-what-is-j1939">
<h2>Overview / What Is J1939<a class="headerlink" href="#overview-what-is-j1939" title="Permalink to this headline">¶</a></h2>
<p>SAE J1939 defines a higher layer protocol on CAN. It implements a more
sophisticated addressing scheme and extends the maximum packet size above 8
bytes. Several derived specifications exist, which differ from the original
J1939 on the application level, like MilCAN A, NMEA2000, and especially
ISO-11783 (ISOBUS). This last one specifies the so-called ETP (Extended
Transport Protocol), which has been included in this implementation. This
results in a maximum packet size of ((2 ^ 24) - 1) * 7 bytes == 111 MiB.</p>
<div class="section" id="specifications-used">
<h3>Specifications used<a class="headerlink" href="#specifications-used" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>SAE J1939-21 : data link layer</li>
<li>SAE J1939-81 : network management</li>
<li>ISO 11783-6  : Virtual Terminal (Extended Transport Protocol)</li>
</ul>
</div>
</div>
<div class="section" id="motivation">
<span id="j1939-motivation"></span><h2>Motivation<a class="headerlink" href="#motivation" title="Permalink to this headline">¶</a></h2>
<p>Given the fact there’s something like SocketCAN with an API similar to BSD
sockets, we found some reasons to justify a kernel implementation for the
addressing and transport methods used by J1939.</p>
<ul class="simple">
<li><strong>Addressing:</strong> when a process on an ECU communicates via J1939, it should
not necessarily know its source address. Although, at least one process per
ECU should know the source address. Other processes should be able to reuse
that address. This way, address parameters for different processes
cooperating for the same ECU, are not duplicated. This way of working is
closely related to the UNIX concept, where programs do just one thing and do
it well.</li>
<li><strong>Dynamic addressing:</strong> Address Claiming in J1939 is time critical.
Furthermore, data transport should be handled properly during the address
negotiation. Putting this functionality in the kernel eliminates it as a
requirement for _every_ user space process that communicates via J1939. This
results in a consistent J1939 bus with proper addressing.</li>
<li><strong>Transport:</strong> both TP &amp; ETP reuse some PGNs to relay big packets over them.
Different processes may thus use the same TP &amp; ETP PGNs without actually
knowing it. The individual TP &amp; ETP sessions _must_ be serialized
(synchronized) between different processes. The kernel solves this problem
properly and eliminates the serialization (synchronization) as a requirement
for _every_ user space process that communicates via J1939.</li>
</ul>
<p>J1939 defines some other features (relaying, gateway, fast packet transport,
…). In-kernel code for these would not contribute to protocol stability.
Therefore, these parts are left to user space.</p>
<p>The J1939 sockets operate on CAN network devices (see SocketCAN). Any J1939
user space library operating on CAN raw sockets will still operate properly.
Since such a library does not communicate with the in-kernel implementation, care
must be taken that these two do not interfere. In practice, this means they
cannot share ECU addresses. A single ECU (or virtual ECU) address is used by
the library exclusively, or by the in-kernel system exclusively.</p>
</div>
<div class="section" id="j1939-concepts">
<h2>J1939 concepts<a class="headerlink" href="#j1939-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pgn">
<h3>PGN<a class="headerlink" href="#pgn" title="Permalink to this headline">¶</a></h3>
<p>The J1939 protocol uses the 29-bit CAN identifier with the following structure:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="30%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="3">29 bit CAN-ID</th>
</tr>
<tr class="row-even"><th class="head" colspan="3">Bit positions within the CAN-ID</th>
</tr>
<tr class="row-odd"><th class="head">28 … 26</th>
<th class="head">25 … 8</th>
<th class="head">7 … 0</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Priority</td>
<td>PGN</td>
<td>SA (Source Address)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The PGN (Parameter Group Number) is a number to identify a packet. The PGN
is composed as follows:</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="23%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="4">PGN</th>
</tr>
<tr class="row-even"><th class="head" colspan="4">Bit positions within the CAN-ID</th>
</tr>
<tr class="row-odd"><th class="head">25</th>
<th class="head">24</th>
<th class="head">23 … 16</th>
<th class="head">15 … 8</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>R (Reserved)</td>
<td>DP (Data Page)</td>
<td>PF (PDU Format)</td>
<td>PS (PDU Specific)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>In J1939-21 distinction is made between PDU1 format (where PF &lt; 240) and PDU2
format (where PF &gt;= 240). Furthermore, when using the PDU2 format, the PS-field
contains a so-called Group Extension, which is part of the PGN. When using PDU2
format, the Group Extension is set in the PS-field.</p>
<blockquote>
<div><table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">PDU1 Format (specific) (peer to peer)</th>
</tr>
<tr class="row-even"><th class="head" colspan="2">Bit positions within the CAN-ID</th>
</tr>
<tr class="row-odd"><th class="head">23 … 16</th>
<th class="head">15 … 8</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>00h … EFh</td>
<td>DA (Destination address)</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head" colspan="2">PDU2 Format (global) (broadcast)</th>
</tr>
<tr class="row-even"><th class="head" colspan="2">Bit positions within the CAN-ID</th>
</tr>
<tr class="row-odd"><th class="head">23 … 16</th>
<th class="head">15 … 8</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>F0h … FFh</td>
<td>GE (Group Extenstion)</td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>On the other hand, when using PDU1 format, the PS-field contains a so-called
Destination Address, which is _not_ part of the PGN. When communicating a PGN
from user space to kernel (or vice versa) and PDU2 format is used, the PS-field
of the PGN shall be set to zero. The Destination Address shall be set
elsewhere.</p>
<p>Regarding PGN mapping to 29-bit CAN identifier, the Destination Address shall
be get/set from/to the appropriate bits of the identifier by the kernel.</p>
</div>
<div class="section" id="addressing">
<h3>Addressing<a class="headerlink" href="#addressing" title="Permalink to this headline">¶</a></h3>
<p>Both static and dynamic addressing methods can be used.</p>
<p>For static addresses, no extra checks are made by the kernel and provided
addresses are considered right. This responsibility is for the OEM or system
integrator.</p>
<p>For dynamic addressing, so-called Address Claiming, extra support is foreseen
in the kernel. In J1939 any ECU is known by its 64-bit NAME. At the moment of
a successful address claim, the kernel keeps track of both NAME and source
address being claimed. This serves as a base for filter schemes. By default,
packets with a destination that is not locally will be rejected.</p>
<p>Mixed mode packets (from a static to a dynamic address or vice versa) are
allowed. The BSD sockets define separate API calls for getting/setting the
local &amp; remote address and are applicable for J1939 sockets.</p>
</div>
<div class="section" id="filtering">
<h3>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h3>
<p>J1939 defines white list filters per socket that a user can set in order to
receive a subset of the J1939 traffic. Filtering can be based on:</p>
<ul class="simple">
<li>SA</li>
<li>SOURCE_NAME</li>
<li>PGN</li>
</ul>
<p>When multiple filters are in place for a single socket, and a packet comes in
that matches several of those filters, the packet is only received once for
that socket.</p>
</div>
</div>
<div class="section" id="how-to-use-j1939">
<h2>How to Use J1939<a class="headerlink" href="#how-to-use-j1939" title="Permalink to this headline">¶</a></h2>
<div class="section" id="api-calls">
<h3>API Calls<a class="headerlink" href="#api-calls" title="Permalink to this headline">¶</a></h3>
<p>On CAN, you first need to open a socket for communicating over a CAN network.
To use J1939, <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;linux/can/j1939.h&gt;</span></code>. From there, <code class="docutils literal notranslate"><span class="pre">&lt;linux/can.h&gt;</span></code> will be
included too. To open a socket, use:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">PF_CAN</span><span class="p">,</span> <span class="n">SOCK_DGRAM</span><span class="p">,</span> <span class="n">CAN_J1939</span><span class="p">);</span>
</pre></div>
</div>
<p>J1939 does use <code class="docutils literal notranslate"><span class="pre">SOCK_DGRAM</span></code> sockets. In the J1939 specification, connections are
mentioned in the context of transport protocol sessions. These still deliver
packets to the other end (using several CAN packets). <code class="docutils literal notranslate"><span class="pre">SOCK_STREAM</span></code> is not
supported.</p>
<p>After the successful creation of the socket, you would normally use the <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code>
and/or <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code> system call to bind the socket to a CAN interface. After
binding and/or connecting the socket, you can <code class="docutils literal notranslate"><span class="pre">read(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">write(2)</span></code> from/to the
socket or use <code class="docutils literal notranslate"><span class="pre">send(2)</span></code>, <code class="docutils literal notranslate"><span class="pre">sendto(2)</span></code>, <code class="docutils literal notranslate"><span class="pre">sendmsg(2)</span></code> and the <code class="docutils literal notranslate"><span class="pre">recv*()</span></code> counterpart
operations on the socket as usual. There are also J1939 specific socket options
described below.</p>
<p>In order to send data, a <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> must have been successful. <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> assigns a
local address to a socket.</p>
<p>Different from CAN is that the payload data is just the data that get sends,
without its header info. The header info is derived from the sockaddr supplied
to <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code>, <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code>, <code class="docutils literal notranslate"><span class="pre">sendto(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">recvfrom(2)</span></code>. A <code class="docutils literal notranslate"><span class="pre">write(2)</span></code> with size 4 will
result in a packet with 4 bytes.</p>
<p>The sockaddr structure has extensions for use with J1939 as specified below:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">sockaddr_can</span> <span class="p">{</span>
   <span class="n">sa_family_t</span> <span class="n">can_family</span><span class="p">;</span>
   <span class="kt">int</span>         <span class="n">can_ifindex</span><span class="p">;</span>
   <span class="k">union</span> <span class="p">{</span>
      <span class="k">struct</span> <span class="p">{</span>
         <span class="n">__u64</span> <span class="n">name</span><span class="p">;</span>
                  <span class="cm">/* pgn:</span>
<span class="cm">                   * 8 bit: PS in PDU2 case, else 0</span>
<span class="cm">                   * 8 bit: PF</span>
<span class="cm">                   * 1 bit: DP</span>
<span class="cm">                   * 1 bit: reserved</span>
<span class="cm">                   */</span>
         <span class="n">__u32</span> <span class="n">pgn</span><span class="p">;</span>
         <span class="n">__u8</span>  <span class="n">addr</span><span class="p">;</span>
      <span class="p">}</span> <span class="n">j1939</span><span class="p">;</span>
   <span class="p">}</span> <span class="n">can_addr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">can_family</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">can_ifindex</span></code> serve the same purpose as for other SocketCAN sockets.</p>
<p><code class="docutils literal notranslate"><span class="pre">can_addr.j1939.pgn</span></code> specifies the PGN (max 0x3ffff). Individual bits are
specified above.</p>
<p><code class="docutils literal notranslate"><span class="pre">can_addr.j1939.name</span></code> contains the 64-bit J1939 NAME.</p>
<p><code class="docutils literal notranslate"><span class="pre">can_addr.j1939.addr</span></code> contains the address.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> system call assigns the local address, i.e. the source address when
sending packages. If a PGN during <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> is set, it’s used as a RX filter.
I.e. only packets with a matching PGN are received. If an ADDR or NAME is set
it is used as a receive filter, too. It will match the destination NAME or ADDR
of the incoming packet. The NAME filter will work only if appropriate Address
Claiming for this name was done on the CAN bus and registered/cached by the
kernel.</p>
<p>On the other hand <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code> assigns the remote address, i.e. the destination
address. The PGN from <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code> is used as the default PGN when sending
packets. If ADDR or NAME is set it will be used as the default destination ADDR
or NAME. Further a set ADDR or NAME during <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code> is used as a receive
filter. It will match the source NAME or ADDR of the incoming packet.</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">write(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">send(2)</span></code> will send a packet with local address from <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> and the
remote address from <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code>. Use <code class="docutils literal notranslate"><span class="pre">sendto(2)</span></code> to overwrite the destination
address.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">can_addr.j1939.name</span></code> is set (!= 0) the NAME is looked up by the kernel and
the corresponding ADDR is used. If <code class="docutils literal notranslate"><span class="pre">can_addr.j1939.name</span></code> is not set (== 0),
<code class="docutils literal notranslate"><span class="pre">can_addr.j1939.addr</span></code> is used.</p>
<p>When creating a socket, reasonable defaults are set. Some options can be
modified with <code class="docutils literal notranslate"><span class="pre">setsockopt(2)</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">getsockopt(2)</span></code>.</p>
<p>RX path related options:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SO_J1939_FILTER</span></code> - configure array of filters</li>
<li><code class="docutils literal notranslate"><span class="pre">SO_J1939_PROMISC</span></code> - disable filters set by <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code></li>
</ul>
<p>By default no broadcast packets can be send or received. To enable sending or
receiving broadcast packets use the socket option <code class="docutils literal notranslate"><span class="pre">SO_BROADCAST</span></code>:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">setsockopt</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">SO_BROADCAST</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
</pre></div>
</div>
<p>The following diagram illustrates the RX path:</p>
<div class="code highlight-none notranslate"><div class="highlight"><pre><span></span>               +--------------------+
               |  incoming packet   |
               +--------------------+
                         |
                         V
               +--------------------+
               | SO_J1939_PROMISC?  |
               +--------------------+
                        |  |
                    no  |  | yes
                        |  |
              .---------&#39;  `---------.
              |                      |
+---------------------------+        |
| bind() + connect() +      |        |
| SOCK_BROADCAST filter     |        |
+---------------------------+        |
              |                      |
              |&lt;---------------------&#39;
              V
+---------------------------+
|      SO_J1939_FILTER      |
+---------------------------+
              |
              V
+---------------------------+
|        socket recv()      |
+---------------------------+
</pre></div>
</div>
<p>TX path related options:
<code class="docutils literal notranslate"><span class="pre">SO_J1939_SEND_PRIO</span></code> - change default send priority for the socket</p>
<div class="section" id="message-flags-during-send-and-related-system-calls">
<h4>Message Flags during send() and Related System Calls<a class="headerlink" href="#message-flags-during-send-and-related-system-calls" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">send(2)</span></code>, <code class="docutils literal notranslate"><span class="pre">sendto(2)</span></code> and <code class="docutils literal notranslate"><span class="pre">sendmsg(2)</span></code> take a ‘flags’ argument. Currently
supported flags are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">MSG_DONTWAIT</span></code>, i.e. non-blocking operation.</li>
</ul>
</div>
<div class="section" id="recvmsg-2">
<h4>recvmsg(2)<a class="headerlink" href="#recvmsg-2" title="Permalink to this headline">¶</a></h4>
<p>In most cases <code class="docutils literal notranslate"><span class="pre">recvmsg(2)</span></code> is needed if you want to extract more information than
<code class="docutils literal notranslate"><span class="pre">recvfrom(2)</span></code> can provide. For example package priority and timestamp. The
Destination Address, name and packet priority (if applicable) are attached to
the msghdr in the <code class="docutils literal notranslate"><span class="pre">recvmsg(2)</span></code> call. They can be extracted using <code class="docutils literal notranslate"><span class="pre">cmsg(3)</span></code> macros,
with <code class="docutils literal notranslate"><span class="pre">cmsg_level</span> <span class="pre">==</span> <span class="pre">SOL_J1939</span> <span class="pre">&amp;&amp;</span> <span class="pre">cmsg_type</span> <span class="pre">==</span> <span class="pre">SCM_J1939_DEST_ADDR</span></code>,
<code class="docutils literal notranslate"><span class="pre">SCM_J1939_DEST_NAME</span></code> or <code class="docutils literal notranslate"><span class="pre">SCM_J1939_PRIO</span></code>. The returned data is a <code class="docutils literal notranslate"><span class="pre">uint8_t</span></code> for
<code class="docutils literal notranslate"><span class="pre">priority</span></code> and <code class="docutils literal notranslate"><span class="pre">dst_addr</span></code>, and <code class="docutils literal notranslate"><span class="pre">uint64_t</span></code> for <code class="docutils literal notranslate"><span class="pre">dst_name</span></code>.</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="kt">uint8_t</span> <span class="n">priority</span><span class="p">,</span> <span class="n">dst_addr</span><span class="p">;</span>
<span class="kt">uint64_t</span> <span class="n">dst_name</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="n">cmsg</span> <span class="o">=</span> <span class="n">CMSG_FIRSTHDR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">);</span> <span class="n">cmsg</span><span class="p">;</span> <span class="n">cmsg</span> <span class="o">=</span> <span class="n">CMSG_NXTHDR</span><span class="p">(</span><span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="n">cmsg</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="n">cmsg</span><span class="o">-&gt;</span><span class="n">cmsg_level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="nl">SOL_CAN_J1939</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">cmsg</span><span class="o">-&gt;</span><span class="n">cmsg_type</span> <span class="o">==</span> <span class="n">SCM_J1939_DEST_ADDR</span><span class="p">)</span>
                        <span class="n">dst_addr</span> <span class="o">=</span> <span class="o">*</span><span class="n">CMSG_DATA</span><span class="p">(</span><span class="n">cmsg</span><span class="p">);</span>
                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">cmsg</span><span class="o">-&gt;</span><span class="n">cmsg_type</span> <span class="o">==</span> <span class="n">SCM_J1939_DEST_NAME</span><span class="p">)</span>
                        <span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dst_name</span><span class="p">,</span> <span class="n">CMSG_DATA</span><span class="p">(</span><span class="n">cmsg</span><span class="p">),</span> <span class="n">cmsg</span><span class="o">-&gt;</span><span class="n">cmsg_len</span> <span class="o">-</span> <span class="n">CMSG_LEN</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">cmsg</span><span class="o">-&gt;</span><span class="n">cmsg_type</span> <span class="o">==</span> <span class="n">SCM_J1939_PRIO</span><span class="p">)</span>
                        <span class="n">priority</span> <span class="o">=</span> <span class="o">*</span><span class="n">CMSG_DATA</span><span class="p">(</span><span class="n">cmsg</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dynamic-addressing">
<h3>Dynamic Addressing<a class="headerlink" href="#dynamic-addressing" title="Permalink to this headline">¶</a></h3>
<p>Distinction has to be made between using the claimed address and doing an
address claim. To use an already claimed address, one has to fill in the
<code class="docutils literal notranslate"><span class="pre">j1939.name</span></code> member and provide it to <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code>. If the name had claimed an address
earlier, all further messages being sent will use that address. And the
<code class="docutils literal notranslate"><span class="pre">j1939.addr</span></code> member will be ignored.</p>
<p>An exception on this is PGN 0x0ee00. This is the “Address Claim/Cannot Claim
Address” message and the kernel will use the <code class="docutils literal notranslate"><span class="pre">j1939.addr</span></code> member for that PGN if
necessary.</p>
<p>To claim an address following code example can be used:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">sockaddr_can</span> <span class="n">baddr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">can_family</span> <span class="o">=</span> <span class="n">AF_CAN</span><span class="p">,</span>
        <span class="p">.</span><span class="n">can_addr</span><span class="p">.</span><span class="n">j1939</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
                <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">J1939_IDLE_ADDR</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_NO_PGN</span><span class="p">,</span>    <span class="cm">/* to disable bind() rx filter for PGN */</span>
        <span class="p">},</span>
        <span class="p">.</span><span class="n">can_ifindex</span> <span class="o">=</span> <span class="n">if_nametoindex</span><span class="p">(</span><span class="s">&quot;can0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="n">bind</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">baddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">baddr</span><span class="p">));</span>

<span class="cm">/* for Address Claiming broadcast must be allowed */</span>
<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">setsockopt</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">SO_BROADCAST</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>

<span class="cm">/* configured advanced RX filter with PGN needed for Address Claiming */</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">j1939_filter</span> <span class="n">filt</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_PGN_ADDRESS_CLAIMED</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn_mask</span> <span class="o">=</span> <span class="n">J1939_PGN_PDU1_MAX</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_PGN_REQUEST</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn_mask</span> <span class="o">=</span> <span class="n">J1939_PGN_PDU1_MAX</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_PGN_ADDRESS_COMMANDED</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn_mask</span> <span class="o">=</span> <span class="n">J1939_PGN_MAX</span><span class="p">,</span>
        <span class="p">},</span>
<span class="p">};</span>

<span class="n">setsockopt</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">SOL_CAN_J1939</span><span class="p">,</span> <span class="n">SO_J1939_FILTER</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">filt</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">filt</span><span class="p">));</span>

<span class="kt">uint64_t</span> <span class="n">dat</span> <span class="o">=</span> <span class="n">htole64</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_can</span> <span class="n">saddr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">can_family</span> <span class="o">=</span> <span class="n">AF_CAN</span><span class="p">,</span>
        <span class="p">.</span><span class="n">can_addr</span><span class="p">.</span><span class="n">j1939</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_PGN_ADDRESS_CLAIMED</span><span class="p">,</span>
                <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">J1939_NO_ADDR</span><span class="p">,</span>
        <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Afterwards do a sendto(2) with data set to the NAME (Little Endian). If the</span>
<span class="cm"> * NAME provided, does not match the j1939.name provided to bind(2), EPROTO</span>
<span class="cm"> * will be returned.</span>
<span class="cm"> */</span>
<span class="n">sendto</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">));</span>
</pre></div>
</div>
<p>If no-one else contests the address claim within 250ms after transmission, the
kernel marks the NAME-SA assignment as valid. The valid assignment will be kept
among other valid NAME-SA assignments. From that point, any socket bound to the
NAME can send packets.</p>
<p>If another ECU claims the address, the kernel will mark the NAME-SA expired.
No socket bound to the NAME can send packets (other than address claims). To
claim another address, some socket bound to NAME, must <code class="docutils literal notranslate"><span class="pre">bind(2)</span></code> again, but with
only <code class="docutils literal notranslate"><span class="pre">j1939.addr</span></code> changed to the new SA, and must then send a valid address claim
packet. This restarts the state machine in the kernel (and any other
participant on the bus) for this NAME.</p>
<p><code class="docutils literal notranslate"><span class="pre">can-utils</span></code> also include the <code class="docutils literal notranslate"><span class="pre">j1939acd</span></code> tool, so it can be used as code example or as
default Address Claiming daemon.</p>
</div>
<div class="section" id="send-examples">
<h3>Send Examples<a class="headerlink" href="#send-examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="static-addressing">
<h4>Static Addressing<a class="headerlink" href="#static-addressing" title="Permalink to this headline">¶</a></h4>
<p>This example will send a PGN (0x12300) from SA 0x20 to DA 0x30.</p>
<p>Bind:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">sockaddr_can</span> <span class="n">baddr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">can_family</span> <span class="o">=</span> <span class="n">AF_CAN</span><span class="p">,</span>
        <span class="p">.</span><span class="n">can_addr</span><span class="p">.</span><span class="n">j1939</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">J1939_NO_NAME</span><span class="p">,</span>
                <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="n">J1939_NO_PGN</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">.</span><span class="n">can_ifindex</span> <span class="o">=</span> <span class="n">if_nametoindex</span><span class="p">(</span><span class="s">&quot;can0&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="n">bind</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">baddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">baddr</span><span class="p">));</span>
</pre></div>
</div>
<p>Now, the socket ‘sock’ is bound to the SA 0x20. Since no <code class="docutils literal notranslate"><span class="pre">connect(2)</span></code> was called,
at this point we can use only <code class="docutils literal notranslate"><span class="pre">sendto(2)</span></code> or <code class="docutils literal notranslate"><span class="pre">sendmsg(2)</span></code>.</p>
<p>Send:</p>
<div class="highlight-C notranslate"><div class="highlight"><pre><span></span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_can</span> <span class="n">saddr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">can_family</span> <span class="o">=</span> <span class="n">AF_CAN</span><span class="p">,</span>
        <span class="p">.</span><span class="n">can_addr</span><span class="p">.</span><span class="n">j1939</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">J1939_NO_NAME</span><span class="p">;</span>
                <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
                <span class="p">.</span><span class="n">pgn</span> <span class="o">=</span> <span class="mh">0x12300</span><span class="p">,</span>
        <span class="p">},</span>
<span class="p">};</span>

<span class="n">sendto</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dat</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">saddr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">saddr</span><span class="p">));</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kapi.html" class="btn btn-neutral float-right" title="Linux Networking and Network Devices APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ieee802154.html" class="btn btn-neutral" title="IEEE 802.15.4 Developer’s Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
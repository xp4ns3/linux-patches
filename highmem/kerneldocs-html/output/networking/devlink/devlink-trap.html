

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Devlink Trap &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../index.html"/>
        <link rel="up" title="Linux Devlink Documentation" href="index.html"/>
        <link rel="next" title="bnxt devlink support" href="bnxt.html"/>
        <link rel="prev" title="Devlink Reload" href="devlink-reload.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device_drivers/index.html">Hardware Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Linux Devlink Documentation</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="index.html#locking">Locking</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html#interface-documentation">Interface documentation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="devlink-dpipe.html">Devlink DPIPE</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-health.html">Devlink Health</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-info.html">Devlink Info</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-flash.html">Devlink Flash</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-params.html">Devlink Params</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-port.html">Devlink Port</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-region.html">Devlink Region</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-resource.html">Devlink Resource</a></li>
<li class="toctree-l4"><a class="reference internal" href="devlink-reload.html">Devlink Reload</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Devlink Trap</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#driver-specific-documentation">Driver-specific documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../caif/index.html">CAIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../j1939.html">J1939 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../page_pool.html">Page Pool API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6pack.html">6pack Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arcnet-hardware.html">ARCnet Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../arcnet.html">ARCnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../atm.html">ATM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ax25.html">AX.25</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bonding.html">Linux Ethernet Bonding Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cdc_mbim.html">cdc_mbim - Driver for CDC MBIM Mobile Broadband modems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dccp.html">DCCP protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dctcp.html">DCTCP (DataCenter TCP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../decnet.html">Linux DECnet Networking Layer Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dns_resolver.html">DNS Resolver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../driver.html">Softnet Driver Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eql.html">EQL Driver: Serial IP Load Balancing HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fib_trie.html">LC-trie implementation notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filter.html">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-hdlc.html">Generic HDLC layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic_netlink.html">Generic Netlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gen_stats.html">Generic networking statistics for netlink users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gtp.html">The Linux kernel GTP tunneling module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ila.html">Identifier Locator Addressing (ILA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ioam6-sysctl.html">IOAM6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipddp.html">AppleTalk-IP Decapsulation and AppleTalk-IP Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ip_dynaddr.html">IP dynamic address hack-port v0.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipsec.html">IPsec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ip-sysctl.html">IP Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipvlan.html">IPVLAN Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ipvs-sysctl.html">IPvs-sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kcm.html">Kernel Connection Multiplexor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../l2tp.html">L2TP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lapb-module.html">The Linux LAPB Module Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mac80211-injection.html">How to use packet injection with mac80211</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mctp.html">Management Component Transport Protocol (MCTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mpls-sysctl.html">MPLS Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mptcp-sysctl.html">MPTCP Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multiqueue.html">HOWTO for multiqueue network device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netconsole.html">Netconsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netdev-features.html">Netdev features mess and how to get out from it alive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netdevices.html">Network Devices, the Kernel, and You!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netfilter-sysctl.html">Netfilter Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../netif-msg.html">NETIF Msg Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nexthop-group-resilient.html">Resilient Next-hop Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nf_conntrack-sysctl.html">Netfilter Conntrack Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nf_flowtable.html">Netfilter’s flowtable infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../openvswitch.html">Open vSwitch datapath developer documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../operstates.html">Operational States</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packet_mmap.html">Packet MMAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../phonet.html">Linux Phonet protocol family</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pktgen.html">HOWTO for the linux packet generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plip.html">PLIP: The Parallel Line Internet Protocol Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ppp_generic.html">PPP Generic Driver and Channel Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../proc_net_tcp.html">The proc/net/tcp and proc/net/tcp6 variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../radiotap-headers.html">How to use radiotap headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rds.html">RDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regulatory.html">Linux wireless regulatory documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rxrpc.html">RxRPC Network Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rxrpc.html#socket-options">SOCKET OPTIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rxrpc.html#security">SECURITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rxrpc.html#example-client-usage">EXAMPLE CLIENT USAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sctp.html">Linux Kernel SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secid.html">LSM/SeLinux secid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../seg6-sysctl.html">Seg6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../smc-sysctl.html">SMC Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistics.html">Interface statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../strparser.html">Stream Parser (strparser)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switchdev.html">Ethernet switch device driver model (switchdev)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysfs-tagging.html">Sysfs tagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tc-actions-env-rules.html">TC Actions - Environmental Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tcp-thin.html">Thin-streams and TCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../team.html">Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timestamping.html">Timestamping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tipc.html">Linux Kernel TIPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tproxy.html">Transparent proxy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tuntap.html">Universal TUN/TAP device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../udplite.html">The UDP-Lite protocol (RFC 3828)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vrf.html">Virtual Routing and Forwarding (VRF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vxlan.html">Virtual eXtensible Local Area Networking documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x25-iface.html">Packet Layer to Device Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x25-iface.html#device-driver-to-packet-layer">Device Driver to Packet Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x25-iface.html#requirements-for-the-device-driver">Requirements for the device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../x25.html">Linux X.25 Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfrm_device.html">XFRM device - offloading the IPsec computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfrm_proc.html">XFRM proc - /proc/net/xfrm_* files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfrm_sync.html">XFRM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../xfrm_sysctl.html">XFRM Syscall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Networking Documentation</a> &raquo;</li>
        
          <li><a href="index.html">Linux Devlink Documentation</a> &raquo;</li>
        
      <li>Devlink Trap</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/networking/devlink/devlink-trap.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="devlink-trap">
<h1>Devlink Trap<a class="headerlink" href="#devlink-trap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>Devices capable of offloading the kernel’s datapath and perform functions such
as bridging and routing must also be able to send specific packets to the
kernel (i.e., the CPU) for processing.</p>
<p>For example, a device acting as a multicast-aware bridge must be able to send
IGMP membership reports to the kernel for processing by the bridge module.
Without processing such packets, the bridge module could never populate its
MDB.</p>
<p>As another example, consider a device acting as router which has received an IP
packet with a TTL of 1. Upon routing the packet the device must send it to the
kernel so that it will route it as well and generate an ICMP Time Exceeded
error datagram. Without letting the kernel route such packets itself, utilities
such as <code class="docutils literal notranslate"><span class="pre">traceroute</span></code> could never work.</p>
<p>The fundamental ability of sending certain packets to the kernel for processing
is called “packet trapping”.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism allows capable device drivers to register their
supported packet traps with <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and report trapped packets to
<code class="docutils literal notranslate"><span class="pre">devlink</span></code> for further analysis.</p>
<p>Upon receiving trapped packets, <code class="docutils literal notranslate"><span class="pre">devlink</span></code> will perform a per-trap packets and
bytes accounting and potentially report the packet to user space via a netlink
event along with all the provided metadata (e.g., trap reason, timestamp, input
port). This is especially useful for drop traps (see <a class="reference internal" href="#trap-types"><span class="std std-ref">Trap Types</span></a>)
as it allows users to obtain further visibility into packet drops that would
otherwise be invisible.</p>
<p>The following diagram provides a general overview of <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                            Netlink event: Packet w/ metadata
                                           Or a summary of recent drops
                          ^
                          |
 Userspace                |
+---------------------------------------------------+
 Kernel                   |
                          |
                  +-------+--------+
                  |                |
                  |  drop_monitor  |
                  |                |
                  +-------^--------+
                          |
                          | Non-control traps
                          |
                     +----+----+
                     |         |      Kernel&#39;s Rx path
                     | devlink |      (non-drop traps)
                     |         |
                     +----^----+      ^
                          |           |
                          +-----------+
                          |
                  +-------+-------+
                  |               |
                  | Device driver |
                  |               |
                  +-------^-------+
 Kernel                   |
+---------------------------------------------------+
 Hardware                 |
                          | Trapped packet
                          |
                       +--+---+
                       |      |
                       | ASIC |
                       |      |
                       +------+
</pre></div>
</div>
</div>
<div class="section" id="trap-types">
<span id="id1"></span><h2>Trap Types<a class="headerlink" href="#trap-types" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism supports the following packet trap types:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">drop</span></code>: Trapped packets were dropped by the underlying device. Packets
are only processed by <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and not injected to the kernel’s Rx path.
The trap action (see <a class="reference internal" href="#trap-actions"><span class="std std-ref">Trap Actions</span></a>) can be changed.</li>
<li><code class="docutils literal notranslate"><span class="pre">exception</span></code>: Trapped packets were not forwarded as intended by the
underlying device due to an exception (e.g., TTL error, missing neighbour
entry) and trapped to the control plane for resolution. Packets are
processed by <code class="docutils literal notranslate"><span class="pre">devlink</span></code> and injected to the kernel’s Rx path. Changing the
action of such traps is not allowed, as it can easily break the control
plane.</li>
<li><code class="docutils literal notranslate"><span class="pre">control</span></code>: Trapped packets were trapped by the device because these are
control packets required for the correct functioning of the control plane.
For example, ARP request and IGMP query packets. Packets are injected to
the kernel’s Rx path, but not reported to the kernel’s drop monitor.
Changing the action of such traps is not allowed, as it can easily break
the control plane.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="trap-actions">
<span id="id2"></span><h2>Trap Actions<a class="headerlink" href="#trap-actions" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism supports the following packet trap actions:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">trap</span></code>: The sole copy of the packet is sent to the CPU.</li>
<li><code class="docutils literal notranslate"><span class="pre">drop</span></code>: The packet is dropped by the underlying device and a copy is not
sent to the CPU.</li>
<li><code class="docutils literal notranslate"><span class="pre">mirror</span></code>: The packet is forwarded by the underlying device and a copy is
sent to the CPU.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="generic-packet-traps">
<h2>Generic Packet Traps<a class="headerlink" href="#generic-packet-traps" title="Permalink to this headline">¶</a></h2>
<p>Generic packet traps are used to describe traps that trap well-defined packets
or packets that are trapped due to well-defined conditions (e.g., TTL error).
Such traps can be shared by multiple device drivers and their description must
be added to the following table:</p>
<table border="1" class="colwidths-given docutils" id="id4">
<caption><span class="caption-text">List of Generic Packet Traps</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="5%" />
<col width="5%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Type</td>
<td>Description</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">source_mac_is_multicast</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps incoming packets that the device decided to drop because of a
multicast source MAC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vlan_tag_mismatch</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps incoming packets that the device decided to drop in case of VLAN
tag mismatch: The ingress bridge port is not configured with a PVID and
the packet is untagged or prio-tagged</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ingress_vlan_filter</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps incoming packets that the device decided to drop in case they are
tagged with a VLAN that is not configured on the ingress bridge port</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ingress_spanning_tree_filter</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps incoming packets that the device decided to drop in case the STP
state of the ingress bridge port is not “forwarding”</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">port_list_is_empty</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop in case they need to be
flooded (e.g., unknown unicast, unregistered multicast) and there are
no ports the packets should be flooded to</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">port_loopback_filter</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop in case after layer 2
forwarding the only port from which they should be transmitted through
is the port from which they were received</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">blackhole_route</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop in case they hit a
blackhole route</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ttl_value_is_too_small</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps unicast packets that should be forwarded by the device whose TTL
was decremented to 0 or less</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">tail_drop</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they could not be
enqueued to a transmission queue which is full</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">non_ip</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to
undergo a layer 3 lookup, but are not IP or MPLS packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">uc_dip_over_mc_dmac</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and they have a unicast destination IP and a multicast destination
MAC</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dip_is_loopback_address</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and their destination IP is the loopback address (i.e., 127.0.0.0/8
and ::1/128)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">sip_is_mc</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and their source IP is multicast (i.e., 224.0.0.0/8 and ff::/8)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">sip_is_loopback_address</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and their source IP is the loopback address (i.e., 127.0.0.0/8 and ::1/128)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ip_header_corrupted</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and their IP header is corrupted: wrong checksum, wrong IP version
or too short Internet Header Length (IHL)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv4_sip_is_limited_bc</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they need to be
routed and their source IP is limited broadcast (i.e., 255.255.255.255/32)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_mc_dip_reserved_scope</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps IPv6 packets that the device decided to drop because they need to
be routed and their IPv6 multicast destination IP has a reserved scope
(i.e., ffx0::/16)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_mc_dip_interface_local_scope</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps IPv6 packets that the device decided to drop because they need to
be routed and their IPv6 multicast destination IP has an interface-local scope
(i.e., ffx1::/16)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mtu_value_is_too_small</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps packets that should have been routed by the device, but were bigger
than the MTU of the egress interface</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">unresolved_neigh</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps packets that did not have a matching IP neighbour after routing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mc_reverse_path_forwarding</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps multicast IP packets that failed reverse-path forwarding (RPF)
check during multicast routing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">reject_route</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps packets that hit reject routes (i.e., “unreachable”, “prohibit”)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_lpm_miss</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps unicast IPv4 packets that did not match any route</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_lpm_miss</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps unicast IPv6 packets that did not match any route</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">non_routable_packet</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop because they are not
supposed to be routed. For example, IGMP queries can be flooded by the
device in layer 2 and reach the router. Such packets should not be
routed and instead dropped</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">decap_error</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">exception</span></code></td>
<td>Traps NVE and IPinIP packets that the device decided to drop because of
failure during decapsulation (e.g., packet being too short, reserved
bits set in VXLAN header)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">overlay_smac_is_mc</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps NVE packets that the device decided to drop because their overlay
source MAC is multicast</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ingress_flow_action_drop</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped during processing of ingress flow action drop</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">egress_flow_action_drop</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped during processing of egress flow action drop</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">stp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps STP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">lacp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps LACP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">lldp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps LLDP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">igmp_query</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IGMP Membership Query packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">igmp_v1_report</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IGMP Version 1 Membership Report packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">igmp_v2_report</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IGMP Version 2 Membership Report packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">igmp_v3_report</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IGMP Version 3 Membership Report packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">igmp_v2_leave</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IGMP Version 2 Leave Group packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mld_query</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps MLD Multicast Listener Query packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mld_v1_report</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps MLD Version 1 Multicast Listener Report packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mld_v2_report</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps MLD Version 2 Multicast Listener Report packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mld_v1_done</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps MLD Version 1 Multicast Listener Done packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv4_dhcp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 DHCP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_dhcp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 DHCP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">arp_request</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps ARP request packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">arp_response</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps ARP response packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">arp_overlay</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps NVE-decapsulated ARP packets that reached the overlay network.
This is required, for example, when the address that needs to be
resolved is a local address</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_neigh_solicit</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 Neighbour Solicitation packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_neigh_advert</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 Neighbour Advertisement packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_bfd</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 BFD packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_bfd</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 BFD packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_ospf</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 OSPF packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_ospf</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 OSPF packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_bgp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 BGP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_bgp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 BGP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_vrrp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 VRRP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_vrrp</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 VRRP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv4_pim</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 PIM packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_pim</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 PIM packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">uc_loopback</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps unicast packets that need to be routed through the same layer 3
interface from which they were received. Such packets are routed by the
kernel, but also cause it to potentially generate ICMP redirect packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">local_route</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps unicast packets that hit a local route and need to be locally
delivered</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">external_route</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps packets that should be routed through an external interface (e.g.,
management interface) that does not belong to the same device (e.g.,
switch ASIC) as the ingress interface</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_uc_dip_link_local_scope</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps unicast IPv6 packets that need to be routed and have a destination
IP address with a link-local scope (i.e., fe80::/10). The trap allows
device drivers to avoid programming link-local routes, but still receive
packets for local delivery</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_dip_all_nodes</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 packets that their destination IP address is the “All Nodes
Address” (i.e., ff02::1)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_dip_all_routers</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 packets that their destination IP address is the “All Routers
Address” (i.e., ff02::2)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_router_solicit</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 Router Solicitation packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv6_router_advert</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 Router Advertisement packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_redirect</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 Redirect Message packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipv4_router_alert</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv4 packets that need to be routed and include the Router Alert
option. Such packets need to be locally delivered to raw sockets that
have the IP_ROUTER_ALERT socket option set</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6_router_alert</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps IPv6 packets that need to be routed and include the Router Alert
option in their Hop-by-Hop extension header. Such packets need to be
locally delivered to raw sockets that have the IPV6_ROUTER_ALERT socket
option set</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ptp_event</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps PTP time-critical event messages (Sync, Delay_req, Pdelay_Req and
Pdelay_Resp)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ptp_general</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps PTP general messages (Announce, Follow_Up, Delay_Resp,
Pdelay_Resp_Follow_Up, management and signaling)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">flow_action_sample</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps packets sampled during processing of flow action sample (e.g., via
tc’s sample action)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">flow_action_trap</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">control</span></code></td>
<td>Traps packets logged during processing of flow action trap (e.g., via
tc’s trap action)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">early_drop</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to the RED (Random Early Detection) algorithm
(i.e., early drops)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vxlan_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the VXLAN header parsing which
might be because of packet truncation or the I flag is not set.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">llc_snap_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the LLC+SNAP header parsing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">vlan_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the VLAN header parsing. Could
include unexpected packet truncation.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">pppoe_ppp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the PPPoE+PPP header parsing.
This could include finding a session ID of 0xFFFF (which is reserved and
not for use), a PPPoE length which is larger than the frame received or
any common error on this type of header</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mpls_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the MPLS header parsing which
could include unexpected header truncation</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">arp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the ARP header parsing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ip_1_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the first IP header parsing.
This packet trap could include packets which do not pass an IP checksum
check, a header length check (a minimum of 20 bytes), which might suffer
from packet truncation thus the total length field exceeds the received
packet length etc</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ip_n_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the parsing of the last IP
header (the inner one in case of an IP over IP tunnel). The same common
error checking is performed here as for the ip_1_parsing trap</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">gre_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the GRE header parsing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">udp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the UDP header parsing.
This packet trap could include checksum errorrs, an improper UDP
length detected (smaller than 8 bytes) or detection of header
truncation.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">tcp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the TCP header parsing.
This could include TCP checksum errors, improper combination of SYN, FIN
and/or RESET etc.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ipsec_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the IPSEC header parsing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">sctp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the SCTP header parsing.
This would mean that port number 0 was used or that the header is
truncated.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dccp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the DCCP header parsing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">gtp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the GTP header parsing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">esp_parsing</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets dropped due to an error in the ESP header parsing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">blackhole_nexthop</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps packets that the device decided to drop in case they hit a
blackhole nexthop</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">dmac_filter</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">drop</span></code></td>
<td>Traps incoming packets that the device decided to drop because
the destination MAC is not configured in the MAC table and
the interface is not in promiscuous mode</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="driver-specific-packet-traps">
<h2>Driver-specific Packet Traps<a class="headerlink" href="#driver-specific-packet-traps" title="Permalink to this headline">¶</a></h2>
<p>Device drivers can register driver-specific packet traps, but these must be
clearly documented. Such traps can correspond to device-specific exceptions and
help debug packet drops caused by these exceptions. The following list includes
links to the description of driver-specific traps registered by various device
drivers:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="netdevsim.html"><span class="doc">netdevsim devlink support</span></a></li>
<li><a class="reference internal" href="mlxsw.html"><span class="doc">mlxsw devlink support</span></a></li>
<li><a class="reference internal" href="prestera.html"><span class="doc">prestera devlink support</span></a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="generic-packet-trap-groups">
<span id="id3"></span><h2>Generic Packet Trap Groups<a class="headerlink" href="#generic-packet-trap-groups" title="Permalink to this headline">¶</a></h2>
<p>Generic packet trap groups are used to aggregate logically related packet
traps. These groups allow the user to batch operations such as setting the trap
action of all member traps. In addition, <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> can report aggregated
per-group packets and bytes statistics, in case per-trap statistics are too
narrow. The description of these groups must be added to the following table:</p>
<table border="1" class="colwidths-given docutils" id="id5">
<caption><span class="caption-text">List of Generic Packet Trap Groups</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="10%" />
<col width="90%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Name</td>
<td>Description</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">l2_drops</span></code></td>
<td>Contains packet traps for packets that were dropped by the device during
layer 2 forwarding (i.e., bridge)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">l3_drops</span></code></td>
<td>Contains packet traps for packets that were dropped by the device during
layer 3 forwarding</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">l3_exceptions</span></code></td>
<td>Contains packet traps for packets that hit an exception (e.g., TTL
error) during layer 3 forwarding</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">buffer_drops</span></code></td>
<td>Contains packet traps for packets that were dropped by the device due to
an enqueue decision</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">tunnel_drops</span></code></td>
<td>Contains packet traps for packets that were dropped by the device during
tunnel encapsulation / decapsulation</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">acl_drops</span></code></td>
<td>Contains packet traps for packets that were dropped by the device during
ACL processing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">stp</span></code></td>
<td>Contains packet traps for STP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">lacp</span></code></td>
<td>Contains packet traps for LACP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">lldp</span></code></td>
<td>Contains packet traps for LLDP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">mc_snooping</span></code></td>
<td>Contains packet traps for IGMP and MLD packets required for multicast
snooping</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">dhcp</span></code></td>
<td>Contains packet traps for DHCP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">neigh_discovery</span></code></td>
<td>Contains packet traps for neighbour discovery packets (e.g., ARP, IPv6
ND)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bfd</span></code></td>
<td>Contains packet traps for BFD packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ospf</span></code></td>
<td>Contains packet traps for OSPF packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">bgp</span></code></td>
<td>Contains packet traps for BGP packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">vrrp</span></code></td>
<td>Contains packet traps for VRRP packets</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">pim</span></code></td>
<td>Contains packet traps for PIM packets</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">uc_loopback</span></code></td>
<td>Contains a packet trap for unicast loopback packets (i.e.,
<code class="docutils literal notranslate"><span class="pre">uc_loopback</span></code>). This trap is singled-out because in cases such as
one-armed router it will be constantly triggered. To limit the impact on
the CPU usage, a packet trap policer with a low rate can be bound to the
group without affecting other traps</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">local_delivery</span></code></td>
<td>Contains packet traps for packets that should be locally delivered after
routing, but do not match more specific packet traps (e.g.,
<code class="docutils literal notranslate"><span class="pre">ipv4_bgp</span></code>)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">external_delivery</span></code></td>
<td>Contains packet traps for packets that should be routed through an
external interface (e.g., management interface) that does not belong to
the same device (e.g., switch ASIC) as the ingress interface</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ipv6</span></code></td>
<td>Contains packet traps for various IPv6 control packets (e.g., Router
Advertisements)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">ptp_event</span></code></td>
<td>Contains packet traps for PTP time-critical event messages (Sync,
Delay_req, Pdelay_Req and Pdelay_Resp)</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">ptp_general</span></code></td>
<td>Contains packet traps for PTP general messages (Announce, Follow_Up,
Delay_Resp, Pdelay_Resp_Follow_Up, management and signaling)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">acl_sample</span></code></td>
<td>Contains packet traps for packets that were sampled by the device during
ACL processing</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">acl_trap</span></code></td>
<td>Contains packet traps for packets that were trapped (logged) by the
device during ACL processing</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">parser_error_drops</span></code></td>
<td>Contains packet traps for packets that were marked by the device during
parsing as erroneous</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="packet-trap-policers">
<h2>Packet Trap Policers<a class="headerlink" href="#packet-trap-policers" title="Permalink to this headline">¶</a></h2>
<p>As previously explained, the underlying device can trap certain packets to the
CPU for processing. In most cases, the underlying device is capable of handling
packet rates that are several orders of magnitude higher compared to those that
can be handled by the CPU.</p>
<p>Therefore, in order to prevent the underlying device from overwhelming the CPU,
devices usually include packet trap policers that are able to police the
trapped packets to rates that can be handled by the CPU.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">devlink-trap</span></code> mechanism allows capable device drivers to register their
supported packet trap policers with <code class="docutils literal notranslate"><span class="pre">devlink</span></code>. The device driver can choose
to associate these policers with supported packet trap groups (see
<a class="reference internal" href="#generic-packet-trap-groups"><span class="std std-ref">Generic Packet Trap Groups</span></a>) during its initialization, thereby exposing
its default control plane policy to user space.</p>
<p>Device drivers should allow user space to change the parameters of the policers
(e.g., rate, burst size) as well as the association between the policers and
trap groups by implementing the relevant callbacks.</p>
<p>If possible, device drivers should implement a callback that allows user space
to retrieve the number of packets that were dropped by the policer because its
configured policy was violated.</p>
</div>
<div class="section" id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>See <code class="docutils literal notranslate"><span class="pre">tools/testing/selftests/drivers/net/netdevsim/devlink_trap.sh</span></code> for a
test covering the core infrastructure. Test cases should be added for any new
functionality.</p>
<p>Device drivers should focus their tests on device-specific functionality, such
as the triggering of supported packet traps.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bnxt.html" class="btn btn-neutral float-right" title="bnxt devlink support" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="devlink-reload.html" class="btn btn-neutral" title="Devlink Reload" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Mellanox ConnectX(R) mlx5 core VPI Network Driver &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../../../index.html"/>
        <link rel="up" title="Ethernet Device Drivers" href="../index.html"/>
        <link rel="next" title="Hyper-V network driver" href="../microsoft/netvsc.html"/>
        <link rel="prev" title="Marvell OcteonTx2 RVU Kernel Drivers" href="../marvell/octeontx2.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Linux Networking Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../af_xdp.html">AF_XDP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../bareudp.html">Bare UDP Tunnelling Module Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../batman-adv.html">batman-adv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../can.html">SocketCAN - Controller Area Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../can_ucan_protocol.html">The UCAN Protocol</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Hardware Device Drivers</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../appletalk/index.html">AppleTalk Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../atm/index.html">Asynchronous Transfer Mode (ATM) Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cable/index.html">Cable Modem Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../can/index.html">Controller Area Network (CAN) Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../cellular/index.html">Cellular Modem Device Drivers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Ethernet Device Drivers</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../3com/3c509.html">Linux and the 3Com EtherLink III Series Ethercards (driver v1.18c and higher)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../3com/vortex.html">3Com Vortex device driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../amazon/ena.html">Linux kernel driver for Elastic Network Adapter (ENA) family</a></li>
<li class="toctree-l4"><a class="reference internal" href="../altera/altera_tse.html">Altera Triple-Speed Ethernet MAC driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aquantia/atlantic.html">Marvell(Aquantia) AQtion Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../chelsio/cxgb.html">Chelsio N210 10Gb Ethernet Network Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cirrus/cs89x0.html">Cirrus Logic LAN CS8900/CS8920 Ethernet Adapters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dlink/dl2k.html">D-Link DL2000-based Gigabit Ethernet Adapter Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../davicom/dm9000.html">DM9000 Network driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dec/de4x5.html">DEC EtherWORKS Ethernet De4x5 cards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../dec/dmfe.html">Davicom DM9102(A)/DM9132/DM9801 fast ethernet driver for Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../freescale/dpaa.html">The QorIQ DPAA Ethernet Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../freescale/dpaa2/index.html">DPAA2 Documentation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../freescale/gianfar.html">The Gianfar Ethernet Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../google/gve.html">Linux kernel driver for Compute Engine Virtual Ethernet (gve):</a></li>
<li class="toctree-l4"><a class="reference internal" href="../huawei/hinic.html">Linux Kernel Driver for Huawei Intelligent NIC(HiNIC) family</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/e100.html">Linux Base Driver for the Intel(R) PRO/100 Family of Adapters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/e1000.html">Linux Base Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/e1000e.html">Linux Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/fm10k.html">Linux Base Driver for Intel(R) Ethernet Multi-host Controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/igb.html">Linux Base Driver for Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/igbvf.html">Linux Base Virtual Function Driver for Intel(R) 1G Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/ixgb.html">Linux Base Driver for 10 Gigabit Intel(R) Ethernet Network Connection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/ixgbe.html">Linux Base Driver for the Intel(R) Ethernet 10 Gigabit PCI Express Adapters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/ixgbevf.html">Linux Base Virtual Function Driver for Intel(R) 10G Ethernet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/i40e.html">Linux Base Driver for the Intel(R) Ethernet Controller 700 Series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/iavf.html">Linux Base Driver for Intel(R) Ethernet Adaptive Virtual Function</a></li>
<li class="toctree-l4"><a class="reference internal" href="../intel/ice.html">Linux Base Driver for the Intel(R) Ethernet Controller 800 Series</a></li>
<li class="toctree-l4"><a class="reference internal" href="../marvell/octeontx2.html">Marvell OcteonTx2 RVU Kernel Drivers</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Mellanox ConnectX(R) mlx5 core VPI Network Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../microsoft/netvsc.html">Hyper-V network driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../neterion/s2io.html">Neterion’s (Formerly S2io) Xframe I/II PCI-X 10GbE driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../neterion/vxge.html">Neterion’s (Formerly S2io) X3100 Series 10GbE PCIe Server Adapter Linux driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../netronome/nfp.html">Netronome Flow Processor (NFP) Kernel Drivers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../pensando/ionic.html">Linux Driver for the Pensando(R) Ethernet adapter family</a></li>
<li class="toctree-l4"><a class="reference internal" href="../smsc/smc9.html">SMC 9xxxx Driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../stmicro/stmmac.html">Linux Driver for the Synopsys(R) Ethernet Controllers “stmmac”</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ti/cpsw.html">Texas Instruments CPSW ethernet driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ti/cpsw_switchdev.html">Texas Instruments CPSW switchdev based ethernet driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ti/am65_nuss_cpsw_switchdev.html">Texas Instruments K3 AM65 CPSW NUSS switchdev based ethernet driver</a></li>
<li class="toctree-l4"><a class="reference internal" href="../ti/tlan.html">TLAN driver for Linux</a></li>
<li class="toctree-l4"><a class="reference internal" href="../toshiba/spider_net.html">The Spidernet Device Driver</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../fddi/index.html">Fiber Distributed Data Interface (FDDI) Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../hamradio/index.html">Amateur Radio Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../qlogic/index.html">QLogic QLGE Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../wan/index.html">Classic WAN Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../wifi/index.html">Wi-Fi Device Drivers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../wwan/index.html">WWAN Device Drivers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../dsa/index.html">Distributed Switch Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../devlink/index.html">Linux Devlink Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../caif/index.html">CAIF</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ethtool-netlink.html">Netlink interface for ethtool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ieee802154.html">IEEE 802.15.4 Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../j1939.html">J1939 Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kapi.html">Linux Networking and Network Devices APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../msg_zerocopy.html">MSG_ZEROCOPY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../failover.html">FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net_dim.html">Net DIM - Generic Network Dynamic Interrupt Moderation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../net_failover.html">NET_FAILOVER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../page_pool.html">Page Pool API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../phy.html">PHY Abstraction Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sfp-phylink.html">phylink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../alias.html">IP-Aliasing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../bridge.html">Ethernet Bridging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../snmp_counter.html">SNMP counter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../checksum-offloads.html">Checksum Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../segmentation-offloads.html">Segmentation Offloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../scaling.html">Scaling in the Linux Networking Stack</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tls.html">Kernel TLS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tls-offload.html">Kernel TLS offload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nfc.html">Linux NFC subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../6lowpan.html">Netdev private dataroom for 6lowpan interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../6pack.html">6pack Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arcnet-hardware.html">ARCnet Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arcnet.html">ARCnet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../atm.html">ATM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ax25.html">AX.25</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../bonding.html">Linux Ethernet Bonding Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cdc_mbim.html">cdc_mbim - Driver for CDC MBIM Mobile Broadband modems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dccp.html">DCCP protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dctcp.html">DCTCP (DataCenter TCP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../decnet.html">Linux DECnet Networking Layer Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../dns_resolver.html">DNS Resolver Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../driver.html">Softnet Driver Issues</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../eql.html">EQL Driver: Serial IP Load Balancing HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../fib_trie.html">LC-trie implementation notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../filter.html">Linux Socket Filtering aka Berkeley Packet Filter (BPF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../generic-hdlc.html">Generic HDLC layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../generic_netlink.html">Generic Netlink</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gen_stats.html">Generic networking statistics for netlink users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../gtp.html">The Linux kernel GTP tunneling module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ila.html">Identifier Locator Addressing (ILA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ioam6-sysctl.html">IOAM6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ipddp.html">AppleTalk-IP Decapsulation and AppleTalk-IP Encapsulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ip_dynaddr.html">IP dynamic address hack-port v0.03</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ipsec.html">IPsec</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ip-sysctl.html">IP Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ipv6.html">IPv6</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ipvlan.html">IPVLAN Driver HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ipvs-sysctl.html">IPvs-sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../kcm.html">Kernel Connection Multiplexor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../l2tp.html">L2TP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../lapb-module.html">The Linux LAPB Module Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mac80211-injection.html">How to use packet injection with mac80211</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mctp.html">Management Component Transport Protocol (MCTP)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mpls-sysctl.html">MPLS Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../mptcp-sysctl.html">MPTCP Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../multiqueue.html">HOWTO for multiqueue network device support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netconsole.html">Netconsole</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netdev-features.html">Netdev features mess and how to get out from it alive</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netdevices.html">Network Devices, the Kernel, and You!</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netfilter-sysctl.html">Netfilter Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../netif-msg.html">NETIF Msg Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nexthop-group-resilient.html">Resilient Next-hop Groups</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nf_conntrack-sysctl.html">Netfilter Conntrack Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../nf_flowtable.html">Netfilter’s flowtable infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../openvswitch.html">Open vSwitch datapath developer documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../operstates.html">Operational States</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../packet_mmap.html">Packet MMAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../phonet.html">Linux Phonet protocol family</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../pktgen.html">HOWTO for the linux packet generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../plip.html">PLIP: The Parallel Line Internet Protocol Device</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ppp_generic.html">PPP Generic Driver and Channel Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../proc_net_tcp.html">The proc/net/tcp and proc/net/tcp6 variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../radiotap-headers.html">How to use radiotap headers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rds.html">RDS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../regulatory.html">Linux wireless regulatory documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rxrpc.html">RxRPC Network Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rxrpc.html#socket-options">SOCKET OPTIONS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rxrpc.html#security">SECURITY</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../rxrpc.html#example-client-usage">EXAMPLE CLIENT USAGE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sctp.html">Linux Kernel SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../secid.html">LSM/SeLinux secid</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../seg6-sysctl.html">Seg6 Sysfs variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../smc-sysctl.html">SMC Sysctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../statistics.html">Interface statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../strparser.html">Stream Parser (strparser)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../switchdev.html">Ethernet switch device driver model (switchdev)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../sysfs-tagging.html">Sysfs tagging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tc-actions-env-rules.html">TC Actions - Environmental Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tcp-thin.html">Thin-streams and TCP</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../team.html">Team</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../timestamping.html">Timestamping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tipc.html">Linux Kernel TIPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tproxy.html">Transparent proxy support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tuntap.html">Universal TUN/TAP device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../udplite.html">The UDP-Lite protocol (RFC 3828)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vrf.html">Virtual Routing and Forwarding (VRF)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../vxlan.html">Virtual eXtensible Local Area Networking documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../x25-iface.html">Packet Layer to Device Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../x25-iface.html#device-driver-to-packet-layer">Device Driver to Packet Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../x25-iface.html#requirements-for-the-device-driver">Requirements for the device driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../x25.html">Linux X.25 Project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xfrm_device.html">XFRM device - offloading the IPsec computations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xfrm_proc.html">XFRM proc - /proc/net/xfrm_* files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xfrm_sync.html">XFRM</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../xfrm_sysctl.html">XFRM Syscall</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Linux Networking Documentation</a> &raquo;</li>
        
          <li><a href="../../index.html">Hardware Device Drivers</a> &raquo;</li>
        
          <li><a href="../index.html">Ethernet Device Drivers</a> &raquo;</li>
        
      <li>Mellanox ConnectX(R) mlx5 core VPI Network Driver</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../_sources/networking/device_drivers/ethernet/mellanox/mlx5.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mellanox-connectx-r-mlx5-core-vpi-network-driver">
<h1>Mellanox ConnectX(R) mlx5 core VPI Network Driver<a class="headerlink" href="#mellanox-connectx-r-mlx5-core-vpi-network-driver" title="Permalink to this headline">¶</a></h1>
<p>Copyright (c) 2019, Mellanox Technologies LTD.</p>
<div class="section" id="contents">
<h2>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#enabling-the-driver-and-kconfig-options">Enabling the driver and kconfig options</a></li>
<li><a class="reference internal" href="#devlink-info">Devlink info</a></li>
<li><a class="reference internal" href="#devlink-parameters">Devlink parameters</a></li>
<li><a class="reference internal" href="#bridge-offload">Bridge offload</a></li>
<li><a class="reference internal" href="#mlx5-subfunction">mlx5 subfunction</a></li>
<li><a class="reference internal" href="#mlx5-function-attributes">mlx5 function attributes</a></li>
<li><a class="reference internal" href="#devlink-health-reporters">Devlink health reporters</a></li>
<li><a class="reference internal" href="#mlx5-tracepoints">mlx5 tracepoints</a></li>
</ul>
</div>
<div class="section" id="enabling-the-driver-and-kconfig-options">
<h2>Enabling the driver and kconfig options<a class="headerlink" href="#enabling-the-driver-and-kconfig-options" title="Permalink to this headline">¶</a></h2>
<div class="line-block">
<div class="line">mlx5 core is modular and most of the major mlx5 core driver features can be selected (compiled in/out)</div>
<div class="line">at build time via kernel Kconfig flags.</div>
<div class="line">Basic features, ethernet net device rx/tx offloads and XDP, are available with the most basic flags</div>
<div class="line">CONFIG_MLX5_CORE=y/m and CONFIG_MLX5_CORE_EN=y.</div>
<div class="line">For the list of advanced features please see below.</div>
</div>
<p><strong>CONFIG_MLX5_CORE=(y/m/n)</strong> (module mlx5_core.ko)</p>
<div class="line-block">
<div class="line">The driver can be enabled by choosing CONFIG_MLX5_CORE=y/m in kernel config.</div>
<div class="line">This will provide mlx5 core driver for mlx5 ulps to interface with (mlx5e, mlx5_ib).</div>
</div>
<p><strong>CONFIG_MLX5_CORE_EN=(y/n)</strong></p>
<div class="line-block">
<div class="line">Choosing this option will allow basic ethernet netdevice support with all of the standard rx/tx offloads.</div>
<div class="line">mlx5e is the mlx5 ulp driver which provides netdevice kernel interface, when chosen, mlx5e will be</div>
<div class="line">built-in into mlx5_core.ko.</div>
</div>
<p><strong>CONFIG_MLX5_EN_ARFS=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables Hardware-accelerated receive flow steering (arfs) support, and ntuple filtering.</div>
<div class="line"><a class="reference external" href="https://community.mellanox.com/s/article/howto-configure-arfs-on-connectx-4">https://community.mellanox.com/s/article/howto-configure-arfs-on-connectx-4</a></div>
</div>
<p><strong>CONFIG_MLX5_EN_RXNFC=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables ethtool receive network flow classification, which allows user defined</div>
<div class="line">flow rules to direct traffic into arbitrary rx queue via ethtool set/get_rxnfc API.</div>
</div>
<p><strong>CONFIG_MLX5_CORE_EN_DCB=(y/n)</strong>:</p>
<div class="line-block">
<div class="line">Enables <a class="reference external" href="https://community.mellanox.com/s/article/howto-auto-config-pfc-and-ets-on-connectx-4-via-lldp-dcbx">Data Center Bridging (DCB) Support</a>.</div>
</div>
<p><strong>CONFIG_MLX5_MPFS=(y/n)</strong></p>
<div class="line-block">
<div class="line">Ethernet Multi-Physical Function Switch (MPFS) support in ConnectX NIC.</div>
<div class="line">MPFs is required for when <a class="reference external" href="http://www.mellanox.com/page/multihost">Multi-Host</a> configuration is enabled to allow passing</div>
<div class="line">user configured unicast MAC addresses to the requesting PF.</div>
</div>
<p><strong>CONFIG_MLX5_ESWITCH=(y/n)</strong></p>
<div class="line-block">
<div class="line">Ethernet SRIOV E-Switch support in ConnectX NIC. E-Switch provides internal SRIOV packet steering</div>
<div class="line">and switching for the enabled VFs and PF in two available modes:</div>
<div class="line-block">
<div class="line">1) <a class="reference external" href="https://community.mellanox.com/s/article/howto-configure-sr-iov-for-connectx-4-connectx-5-with-kvm--ethernet-x">Legacy SRIOV mode (L2 mac vlan steering based)</a>.</div>
<div class="line">2) <a class="reference external" href="https://www.mellanox.com/related-docs/prod_software/ASAP2_Hardware_Offloading_for_vSwitches_User_Manual_v4.4.pdf">Switchdev mode (eswitch offloads)</a>.</div>
</div>
</div>
<p><strong>CONFIG_MLX5_CORE_IPOIB=(y/n)</strong></p>
<div class="line-block">
<div class="line">IPoIB offloads &amp; acceleration support.</div>
<div class="line">Requires CONFIG_MLX5_CORE_EN to provide an accelerated interface for the rdma</div>
<div class="line">IPoIB ulp netdevice.</div>
</div>
<p><strong>CONFIG_MLX5_FPGA=(y/n)</strong></p>
<div class="line-block">
<div class="line">Build support for the Innova family of network cards by Mellanox Technologies.</div>
<div class="line">Innova network cards are comprised of a ConnectX chip and an FPGA chip on one board.</div>
<div class="line">If you select this option, the mlx5_core driver will include the Innova FPGA core and allow</div>
<div class="line">building sandbox-specific client drivers.</div>
</div>
<p><strong>CONFIG_MLX5_EN_IPSEC=(y/n)</strong></p>
<div class="line-block">
<div class="line">Enables <a class="reference external" href="http://www.mellanox.com/related-docs/prod_software/Mellanox_Innova_IPsec_Ethernet_Adapter_Card_User_Manual.pdf">IPSec XFRM cryptography-offload accelaration</a>.</div>
</div>
<p><strong>CONFIG_MLX5_EN_TLS=(y/n)</strong></p>
<div class="line-block">
<div class="line">TLS cryptography-offload accelaration.</div>
</div>
<p><strong>CONFIG_MLX5_INFINIBAND=(y/n/m)</strong> (module mlx5_ib.ko)</p>
<div class="line-block">
<div class="line">Provides low-level InfiniBand/RDMA and <a class="reference external" href="https://community.mellanox.com/s/article/recommended-network-configuration-examples-for-roce-deployment">RoCE</a> support.</div>
</div>
<p><strong>CONFIG_MLX5_SF=(y/n)</strong></p>
<div class="line-block">
<div class="line">Build support for subfunction.</div>
<div class="line">Subfunctons are more light weight than PCI SRIOV VFs. Choosing this option</div>
<div class="line">will enable support for creating subfunction devices.</div>
</div>
<p><strong>External options</strong> ( Choose if the corresponding mlx5 feature is required )</p>
<ul class="simple">
<li>CONFIG_PTP_1588_CLOCK: When chosen, mlx5 ptp support will be enabled</li>
<li>CONFIG_VXLAN: When chosen, mlx5 vxlan support will be enabled.</li>
<li>CONFIG_MLXFW: When chosen, mlx5 firmware flashing support will be enabled (via devlink and ethtool).</li>
</ul>
</div>
<div class="section" id="devlink-info">
<h2>Devlink info<a class="headerlink" href="#devlink-info" title="Permalink to this headline">¶</a></h2>
<p>The devlink info reports the running and stored firmware versions on device.
It also prints the device PSID which represents the HCA board type ID.</p>
<p>User command example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev info pci/0000:00:06.0
   pci/0000:00:06.0:
   driver mlx5_core
   versions:
      fixed:
         fw.psid MT_0000000009
      running:
         fw.version 16.26.0100
      stored:
         fw.version 16.26.0100
</pre></div>
</div>
</div>
<div class="section" id="devlink-parameters">
<h2>Devlink parameters<a class="headerlink" href="#devlink-parameters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="flow-steering-mode-device-flow-steering-mode">
<h3>flow_steering_mode: Device flow steering mode<a class="headerlink" href="#flow-steering-mode-device-flow-steering-mode" title="Permalink to this headline">¶</a></h3>
<p>The flow steering mode parameter controls the flow steering mode of the driver.
Two modes are supported:
1. ‘dmfs’ - Device managed flow steering.
2. ‘smfs  - Software/Driver managed flow steering.</p>
<p>In DMFS mode, the HW steering entities are created and managed through the
Firmware.
In SMFS mode, the HW steering entities are created and managed though by
the driver directly into Hardware without firmware intervention.</p>
<p>SMFS mode is faster and provides better rule inserstion rate compared to default DMFS mode.</p>
<p>User command examples:</p>
<ul>
<li><p class="first">Set SMFS flow steering mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param set pci/0000:06:00.0 name flow_steering_mode value &quot;smfs&quot; cmode runtime
</pre></div>
</div>
</li>
<li><p class="first">Read device flow steering mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param show pci/0000:06:00.0 name flow_steering_mode
  pci/0000:06:00.0:
  name flow_steering_mode type driver-specific
  values:
     cmode runtime value smfs
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="enable-roce-roce-enablement-state">
<h3>enable_roce: RoCE enablement state<a class="headerlink" href="#enable-roce-roce-enablement-state" title="Permalink to this headline">¶</a></h3>
<p>RoCE enablement state controls driver support for RoCE traffic.
When RoCE is disabled, there is no gid table, only raw ethernet QPs are supported and traffic on the well known UDP RoCE port is handled as raw ethernet traffic.</p>
<p>To change RoCE enablement state a user must change the driverinit cmode value and run devlink reload.</p>
<p>User command examples:</p>
<ul>
<li><p class="first">Disable RoCE:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param set pci/0000:06:00.0 name enable_roce value false cmode driverinit
$ devlink dev reload pci/0000:06:00.0
</pre></div>
</div>
</li>
<li><p class="first">Read RoCE enablement state:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param show pci/0000:06:00.0 name enable_roce
  pci/0000:06:00.0:
  name enable_roce type generic
  values:
     cmode driverinit value true
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="esw-port-metadata-eswitch-port-metadata-state">
<h3>esw_port_metadata: Eswitch port metadata state<a class="headerlink" href="#esw-port-metadata-eswitch-port-metadata-state" title="Permalink to this headline">¶</a></h3>
<p>When applicable, disabling Eswitch metadata can increase packet rate
up to 20% depending on the use case and packet sizes.</p>
<p>Eswitch port metadata state controls whether to internally tag packets with
metadata. Metadata tagging must be enabled for multi-port RoCE, failover
between representors and stacked devices.
By default metadata is enabled on the supported devices in E-switch.
Metadata is applicable only for E-switch in switchdev mode and
users may disable it when NONE of the below use cases will be in use:
1. HCA is in Dual/multi-port RoCE mode.
2. VF/SF representor bonding (Usually used for Live migration)
3. Stacked devices</p>
<p>When metadata is disabled, the above use cases will fail to initialize if
users try to enable them.</p>
<ul>
<li><p class="first">Show eswitch port metadata:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param show pci/0000:06:00.0 name esw_port_metadata
  pci/0000:06:00.0:
    name esw_port_metadata type driver-specific
      values:
        cmode runtime value true
</pre></div>
</div>
</li>
<li><p class="first">Disable eswitch port metadata:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev param set pci/0000:06:00.0 name esw_port_metadata value false cmode runtime
</pre></div>
</div>
</li>
<li><p class="first">Change eswitch mode to switchdev mode where after choosing the metadata value:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev eswitch set pci/0000:06:00.0 mode switchdev
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="bridge-offload">
<h2>Bridge offload<a class="headerlink" href="#bridge-offload" title="Permalink to this headline">¶</a></h2>
<p>The mlx5 driver implements support for offloading bridge rules when in switchdev
mode. Linux bridge FDBs are automatically offloaded when mlx5 switchdev
representor is attached to bridge.</p>
<ul>
<li><p class="first">Change device to switchdev mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev eswitch set pci/0000:06:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p class="first">Attach mlx5 switchdev representor ‘enp8s0f0’ to bridge netdev ‘bridge1’:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip link set enp8s0f0 master bridge1
</pre></div>
</div>
</li>
</ul>
<div class="section" id="vlans">
<h3>VLANs<a class="headerlink" href="#vlans" title="Permalink to this headline">¶</a></h3>
<p>Following bridge VLAN functions are supported by mlx5:</p>
<ul>
<li><p class="first">VLAN filtering (including multiple VLANs per port):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ip link set bridge1 type bridge vlan_filtering 1
$ bridge vlan add dev enp8s0f0 vid 2-3
</pre></div>
</div>
</li>
<li><p class="first">VLAN push on bridge ingress:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ bridge vlan add dev enp8s0f0 vid 3 pvid
</pre></div>
</div>
</li>
<li><p class="first">VLAN pop on bridge egress:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ bridge vlan add dev enp8s0f0 vid 3 untagged
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="mlx5-subfunction">
<h2>mlx5 subfunction<a class="headerlink" href="#mlx5-subfunction" title="Permalink to this headline">¶</a></h2>
<p>mlx5 supports subfunction management using devlink port (see <a class="reference internal" href="../../../devlink/devlink-port.html#devlink-port"><span class="std std-ref">Documentation/networking/devlink/devlink-port.rst</span></a>) interface.</p>
<p>A Subfunction has its own function capabilities and its own resources. This
means a subfunction has its own dedicated queues (txq, rxq, cq, eq). These
queues are neither shared nor stolen from the parent PCI function.</p>
<p>When a subfunction is RDMA capable, it has its own QP1, GID table and rdma
resources neither shared nor stolen from the parent PCI function.</p>
<p>A subfunction has a dedicated window in PCI BAR space that is not shared
with ther other subfunctions or the parent PCI function. This ensures that all
devices (netdev, rdma, vdpa etc.) of the subfunction accesses only assigned
PCI BAR space.</p>
<p>A Subfunction supports eswitch representation through which it supports tc
offloads. The user configures eswitch to send/receive packets from/to
the subfunction port.</p>
<p>Subfunctions share PCI level resources such as PCI MSI-X IRQs with
other subfunctions and/or with its parent PCI function.</p>
<p>Example mlx5 software, system and device view:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>      _______
     | admin |
     | user  |----------
     |_______|         |
         |             |
     ____|____       __|______            _________________
    |         |     |         |          |                 |
    | devlink |     | tc tool |          |    user         |
    | tool    |     |_________|          | applications    |
    |_________|         |                |_________________|
          |             |                   |          |
          |             |                   |          |         Userspace
+---------|-------------|-------------------|----------|--------------------+
          |             |           +----------+   +----------+   Kernel
          |             |           |  netdev  |   | rdma dev |
          |             |           +----------+   +----------+
  (devlink port add/del |              ^               ^
   port function set)   |              |               |
          |             |              +---------------|
     _____|___          |              |        _______|_______
    |         |         |              |       | mlx5 class    |
    | devlink |   +------------+       |       |   drivers     |
    | kernel  |   | rep netdev |       |       |(mlx5_core,ib) |
    |_________|   +------------+       |       |_______________|
          |             |              |               ^
  (devlink ops)         |              |          (probe/remove)
 _________|________     |              |           ____|________
| subfunction      |    |     +---------------+   | subfunction |
| management driver|-----     | subfunction   |---|  driver     |
| (mlx5_core)      |          | auxiliary dev |   | (mlx5_core) |
|__________________|          +---------------+   |_____________|
          |                                            ^
 (sf add/del, vhca events)                             |
          |                                      (device add/del)
     _____|____                                    ____|________
    |          |                                  | subfunction |
    |  PCI NIC |---- activate/deactive events----&gt;| host driver |
    |__________|                                  | (mlx5_core) |
                                                  |_____________|
</pre></div>
</div>
<p>Subfunction is created using devlink port interface.</p>
<ul>
<li><p class="first">Change device to switchdev mode:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev eswitch set pci/0000:06:00.0 mode switchdev
</pre></div>
</div>
</li>
<li><p class="first">Add a devlink port of subfunction flaovur:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port add pci/0000:06:00.0 flavour pcisf pfnum 0 sfnum 88
pci/0000:06:00.0/32768: type eth netdev eth6 flavour pcisf controller 0 pfnum 0 sfnum 88 external false splittable false
  function:
    hw_addr 00:00:00:00:00:00 state inactive opstate detached
</pre></div>
</div>
</li>
<li><p class="first">Show a devlink port of the subfunction:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port show pci/0000:06:00.0/32768
pci/0000:06:00.0/32768: type eth netdev enp6s0pf0sf88 flavour pcisf pfnum 0 sfnum 88
  function:
    hw_addr 00:00:00:00:00:00 state inactive opstate detached
</pre></div>
</div>
</li>
<li><p class="first">Delete a devlink port of subfunction after use:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port del pci/0000:06:00.0/32768
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="mlx5-function-attributes">
<h2>mlx5 function attributes<a class="headerlink" href="#mlx5-function-attributes" title="Permalink to this headline">¶</a></h2>
<p>The mlx5 driver provides a mechanism to setup PCI VF/SF function attributes in
a unified way for SmartNIC and non-SmartNIC.</p>
<p>This is supported only when the eswitch mode is set to switchdev. Port function
configuration of the PCI VF/SF is supported through devlink eswitch port.</p>
<p>Port function attributes should be set before PCI VF/SF is enumerated by the
driver.</p>
<div class="section" id="mac-address-setup">
<h3>MAC address setup<a class="headerlink" href="#mac-address-setup" title="Permalink to this headline">¶</a></h3>
<p>mlx5 driver provides mechanism to setup the MAC address of the PCI VF/SF.</p>
<p>The configured MAC address of the PCI VF/SF will be used by netdevice and rdma
device created for the PCI VF/SF.</p>
<ul>
<li><p class="first">Get the MAC address of the VF identified by its unique devlink port index:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port show pci/0000:06:00.0/2
pci/0000:06:00.0/2: type eth netdev enp6s0pf0vf1 flavour pcivf pfnum 0 vfnum 1
  function:
    hw_addr 00:00:00:00:00:00
</pre></div>
</div>
</li>
<li><p class="first">Set the MAC address of the VF identified by its unique devlink port index:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port function set pci/0000:06:00.0/2 hw_addr 00:11:22:33:44:55

$ devlink port show pci/0000:06:00.0/2
pci/0000:06:00.0/2: type eth netdev enp6s0pf0vf1 flavour pcivf pfnum 0 vfnum 1
  function:
    hw_addr 00:11:22:33:44:55
</pre></div>
</div>
</li>
<li><p class="first">Get the MAC address of the SF identified by its unique devlink port index:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port show pci/0000:06:00.0/32768
pci/0000:06:00.0/32768: type eth netdev enp6s0pf0sf88 flavour pcisf pfnum 0 sfnum 88
  function:
    hw_addr 00:00:00:00:00:00
</pre></div>
</div>
</li>
<li><p class="first">Set the MAC address of the VF identified by its unique devlink port index:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port function set pci/0000:06:00.0/32768 hw_addr 00:00:00:00:88:88

$ devlink port show pci/0000:06:00.0/32768
pci/0000:06:00.0/32768: type eth netdev enp6s0pf0sf88 flavour pcivf pfnum 0 sfnum 88
  function:
    hw_addr 00:00:00:00:88:88
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="sf-state-setup">
<h3>SF state setup<a class="headerlink" href="#sf-state-setup" title="Permalink to this headline">¶</a></h3>
<p>To use the SF, the user must active the SF using the SF function state
attribute.</p>
<ul>
<li><p class="first">Get the state of the SF identified by its unique devlink port index:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port show ens2f0npf0sf88
pci/0000:06:00.0/32768: type eth netdev ens2f0npf0sf88 flavour pcisf controller 0 pfnum 0 sfnum 88 external false splittable false
  function:
    hw_addr 00:00:00:00:88:88 state inactive opstate detached
</pre></div>
</div>
</li>
<li><p class="first">Activate the function and verify its state is active:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port function set ens2f0npf0sf88 state active

$ devlink port show ens2f0npf0sf88
pci/0000:06:00.0/32768: type eth netdev ens2f0npf0sf88 flavour pcisf controller 0 pfnum 0 sfnum 88 external false splittable false
  function:
    hw_addr 00:00:00:00:88:88 state active opstate detached
</pre></div>
</div>
</li>
</ul>
<p>Upon function activation, the PF driver instance gets the event from the device
that a particular SF was activated. It’s the cue to put the device on bus, probe
it and instantiate the devlink instance and class specific auxiliary devices
for it.</p>
<ul>
<li><p class="first">Show the auxiliary device and port of the subfunction:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink dev show
devlink dev show auxiliary/mlx5_core.sf.4

$ devlink port show auxiliary/mlx5_core.sf.4/1
auxiliary/mlx5_core.sf.4/1: type eth netdev p0sf88 flavour virtual port 0 splittable false

$ rdma link show mlx5_0/1
link mlx5_0/1 state ACTIVE physical_state LINK_UP netdev p0sf88

$ rdma dev show
8: rocep6s0f1: node_type ca fw 16.29.0550 node_guid 248a:0703:00b3:d113 sys_image_guid 248a:0703:00b3:d112
13: mlx5_0: node_type ca fw 16.29.0550 node_guid 0000:00ff:fe00:8888 sys_image_guid 248a:0703:00b3:d112
</pre></div>
</div>
</li>
<li><p class="first">Subfunction auxiliary device and class device hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>            mlx5_core.sf.4
     (subfunction auxiliary device)
                  /\
                 /  \
                /    \
               /      \
              /        \
 mlx5_core.eth.4     mlx5_core.rdma.4
(sf eth aux dev)     (sf rdma aux dev)
    |                      |
    |                      |
 p0sf88                  mlx5_0
(sf netdev)          (sf rdma device)
</pre></div>
</div>
</li>
</ul>
<p>Additionally, the SF port also gets the event when the driver attaches to the
auxiliary device of the subfunction. This results in changing the operational
state of the function. This provides visiblity to the user to decide when is it
safe to delete the SF port for graceful termination of the subfunction.</p>
<ul>
<li><p class="first">Show the SF port operational state:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink port show ens2f0npf0sf88
pci/0000:06:00.0/32768: type eth netdev ens2f0npf0sf88 flavour pcisf controller 0 pfnum 0 sfnum 88 external false splittable false
  function:
    hw_addr 00:00:00:00:88:88 state active opstate attached
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="devlink-health-reporters">
<h2>Devlink health reporters<a class="headerlink" href="#devlink-health-reporters" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tx-reporter">
<h3>tx reporter<a class="headerlink" href="#tx-reporter" title="Permalink to this headline">¶</a></h3>
<p>The tx reporter is responsible for reporting and recovering of the following two error scenarios:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>TX timeout</dt>
<dd>Report on kernel tx timeout detection.
Recover by searching lost interrupts.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>TX error completion</dt>
<dd>Report on error tx completion.
Recover by flushing the TX queue and reset it.</dd>
</dl>
</li>
</ul>
<p>TX reporter also support on demand diagnose callback, on which it provides
real time information of its send queues status.</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Diagnose send queues status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter tx
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command has valid output only when interface is up, otherwise the command has empty output.</p>
<ul>
<li><p class="first">Show number of tx errors indicated, number of recover flows ended successfully,
is autorecover enabled and graceful period from last recover:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health show pci/0000:82:00.0 reporter tx
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="rx-reporter">
<h3>rx reporter<a class="headerlink" href="#rx-reporter" title="Permalink to this headline">¶</a></h3>
<p>The rx reporter is responsible for reporting and recovering of the following two error scenarios:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>RX queues initialization (population) timeout</dt>
<dd>RX queues descriptors population on ring initialization is done in
napi context via triggering an irq, in case of a failure to get
the minimum amount of descriptors, a timeout would occur and it
could be recoverable by polling the EQ (Event Queue).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>RX completions with errors (reported by HW on interrupt context)</dt>
<dd>Report on rx completion error.
Recover (if needed) by flushing the related queue and reset it.</dd>
</dl>
</li>
</ul>
<p>RX reporter also supports on demand diagnose callback, on which it
provides real time information of its receive queues status.</p>
<ul>
<li><p class="first">Diagnose rx queues status, and corresponding completion queue:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter rx
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command has valid output only when interface is up, otherwise the command has empty output.</p>
<ul>
<li><p class="first">Show number of rx errors indicated, number of recover flows ended successfully,
is autorecover enabled and graceful period from last recover:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health show pci/0000:82:00.0 reporter rx
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="fw-reporter">
<h3>fw reporter<a class="headerlink" href="#fw-reporter" title="Permalink to this headline">¶</a></h3>
<p>The fw reporter implements diagnose and dump callbacks.
It follows symptoms of fw error such as fw syndrome by triggering
fw core dump and storing it into the dump buffer.
The fw reporter diagnose command can be triggered any time by the user to check
current fw status.</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Check fw heath status:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health diagnose pci/0000:82:00.0 reporter fw
</pre></div>
</div>
</li>
<li><p class="first">Read FW core dump if already stored or trigger new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health dump show pci/0000:82:00.0 reporter fw
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command can run only on the PF which has fw tracer ownership,
running it on other PF or any VF will return “Operation not permitted”.</p>
</div>
<div class="section" id="fw-fatal-reporter">
<h3>fw fatal reporter<a class="headerlink" href="#fw-fatal-reporter" title="Permalink to this headline">¶</a></h3>
<p>The fw fatal reporter implements dump and recover callbacks.
It follows fatal errors indications by CR-space dump and recover flow.
The CR-space dump uses vsc interface which is valid even if the FW command
interface is not functional, which is the case in most FW fatal errors.
The recover function runs recover flow which reloads the driver and triggers fw
reset if needed.
On firmware error, the health buffer is dumped into the dmesg. The log
level is derived from the error’s severity (given in health buffer).</p>
<p>User commands examples:</p>
<ul>
<li><p class="first">Run fw recover flow manually:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health recover pci/0000:82:00.0 reporter fw_fatal
</pre></div>
</div>
</li>
<li><p class="first">Read FW CR-space dump if already strored or trigger new one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ devlink health dump show pci/0000:82:00.1 reporter fw_fatal
</pre></div>
</div>
</li>
</ul>
<p>NOTE: This command can run only on PF.</p>
</div>
</div>
<div class="section" id="mlx5-tracepoints">
<h2>mlx5 tracepoints<a class="headerlink" href="#mlx5-tracepoints" title="Permalink to this headline">¶</a></h2>
<p>mlx5 driver provides internal trace points for tracking and debugging using
kernel tracepoints interfaces (refer to <a class="reference internal" href="../../../../trace/ftrace.html"><span class="doc">ftrace - Function Tracer</span></a>).</p>
<p>For the list of support mlx5 events check /sys/kernel/debug/tracing/events/mlx5/</p>
<p>tc and eswitch offloads tracepoints:</p>
<ul>
<li><p class="first">mlx5e_configure_flower: trace flower filter actions and cookies offloaded to mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_configure_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6535  [019] ...1  2672.404466: mlx5e_configure_flower: cookie=0000000067874a55 actions= REDIRECT
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_delete_flower: trace flower filter actions and cookies deleted from mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_delete_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6569  [010] .N.1  2686.379075: mlx5e_delete_flower: cookie=0000000067874a55 actions= NULL
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_stats_flower: trace flower stats request:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_stats_flower &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
tc-6546  [010] ...1  2679.704889: mlx5e_stats_flower: cookie=0000000060eb3d6a bytes=0 packets=0 lastused=4295560217
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_tc_update_neigh_used_value: trace tunnel rule neigh update value offloaded to mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_tc_update_neigh_used_value &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u48:4-8806  [009] ...1 55117.882428: mlx5e_tc_update_neigh_used_value: netdev: ens1f0 IPv4: 1.1.1.10 IPv6: ::ffff:1.1.1.10 neigh_used=1
</pre></div>
</div>
</li>
<li><p class="first">mlx5e_rep_neigh_update: trace neigh update tasks scheduled due to neigh state change events:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5e_rep_neigh_update &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u48:7-2221  [009] ...1  1475.387435: mlx5e_rep_neigh_update: netdev: ens1f0 MAC: 24:8a:07:9a:17:9a IPv4: 1.1.1.10 IPv6: ::ffff:1.1.1.10 neigh_connected=1
</pre></div>
</div>
</li>
</ul>
<p>Bridge offloads tracepoints:</p>
<ul>
<li><p class="first">mlx5_esw_bridge_fdb_entry_init: trace bridge FDB entry offloaded to mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_fdb_entry_init &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u20:9-2217    [003] ...1   318.582243: mlx5_esw_bridge_fdb_entry_init: net_device=enp8s0f0_0 addr=e4:fd:05:08:00:02 vid=0 flags=0 used=0
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_fdb_entry_cleanup: trace bridge FDB entry deleted from mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_fdb_entry_cleanup &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
ip-2581    [005] ...1   318.629871: mlx5_esw_bridge_fdb_entry_cleanup: net_device=enp8s0f0_1 addr=e4:fd:05:08:00:03 vid=0 flags=0 used=16
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_fdb_entry_refresh: trace bridge FDB entry offload refreshed in
mlx5:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_fdb_entry_refresh &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u20:8-3849    [003] ...1       466716: mlx5_esw_bridge_fdb_entry_refresh: net_device=enp8s0f0_0 addr=e4:fd:05:08:00:02 vid=3 flags=0 used=0
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_vlan_create: trace bridge VLAN object add on mlx5
representor:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_vlan_create &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
ip-2560    [007] ...1   318.460258: mlx5_esw_bridge_vlan_create: vid=1 flags=6
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_vlan_cleanup: trace bridge VLAN object delete from mlx5
representor:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_vlan_cleanup &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
bridge-2582    [007] ...1   318.653496: mlx5_esw_bridge_vlan_cleanup: vid=2 flags=8
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_vport_init: trace mlx5 vport assigned with bridge upper
device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_vport_init &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
ip-2560    [007] ...1   318.458915: mlx5_esw_bridge_vport_init: vport_num=1
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_bridge_vport_cleanup: trace mlx5 vport removed from bridge upper
device:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_bridge_vport_cleanup &gt;&gt; set_event
$ cat /sys/kernel/debug/tracing/trace
...
ip-5387    [000] ...1       573713: mlx5_esw_bridge_vport_cleanup: vport_num=1
</pre></div>
</div>
</li>
</ul>
<p>Eswitch QoS tracepoints:</p>
<ul>
<li><p class="first">mlx5_esw_vport_qos_create: trace creation of transmit scheduler arbiter for vport:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_vport_qos_create &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-23496   [018] .... 73136.838831: mlx5_esw_vport_qos_create: (0000:82:00.0) vport=2 tsar_ix=4 bw_share=0, max_rate=0 group=000000007b576bb3
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_vport_qos_config: trace configuration of transmit scheduler arbiter for vport:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_vport_qos_config &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-26548   [023] .... 75754.223823: mlx5_esw_vport_qos_config: (0000:82:00.0) vport=1 tsar_ix=3 bw_share=34, max_rate=10000 group=000000007b576bb3
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_vport_qos_destroy: trace deletion of transmit scheduler arbiter for vport:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_vport_qos_destroy &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-27418   [004] .... 76546.680901: mlx5_esw_vport_qos_destroy: (0000:82:00.0) vport=1 tsar_ix=3
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_group_qos_create: trace creation of transmit scheduler arbiter for rate group:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_group_qos_create &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-26578   [008] .... 75776.022112: mlx5_esw_group_qos_create: (0000:82:00.0) group=000000008dac63ea tsar_ix=5
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_group_qos_config: trace configuration of transmit scheduler arbiter for rate group:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_group_qos_config &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-27303   [020] .... 76461.455356: mlx5_esw_group_qos_config: (0000:82:00.0) group=000000008dac63ea tsar_ix=5 bw_share=100 max_rate=20000
</pre></div>
</div>
</li>
<li><p class="first">mlx5_esw_group_qos_destroy: trace deletion of transmit scheduler arbiter for group:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_esw_group_qos_destroy &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
&lt;...&gt;-27418   [006] .... 76547.187258: mlx5_esw_group_qos_destroy: (0000:82:00.0) group=000000007b576bb3 tsar_ix=1
</pre></div>
</div>
</li>
</ul>
<p>SF tracepoints:</p>
<ul>
<li><p class="first">mlx5_sf_add: trace addition of the SF port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_add &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
devlink-9363    [031] ..... 24610.188722: mlx5_sf_add: (0000:06:00.0) port_index=32768 controller=0 hw_id=0x8000 sfnum=88
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_free: trace freeing of the SF port:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_free &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
devlink-9830    [038] ..... 26300.404749: mlx5_sf_free: (0000:06:00.0) port_index=32768 controller=0 hw_id=0x8000
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_hwc_alloc: trace allocating of the hardware SF context:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_hwc_alloc &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
devlink-9775    [031] ..... 26296.385259: mlx5_sf_hwc_alloc: (0000:06:00.0) controller=0 hw_id=0x8000 sfnum=88
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_hwc_free: trace freeing of the hardware SF context:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_hwc_free &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u128:3-9093    [046] ..... 24625.365771: mlx5_sf_hwc_free: (0000:06:00.0) hw_id=0x8000
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_hwc_deferred_free : trace deferred freeing of the hardware SF context:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_hwc_deferred_free &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
devlink-9519    [046] ..... 24624.400271: mlx5_sf_hwc_deferred_free: (0000:06:00.0) hw_id=0x8000
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_vhca_event: trace SF vhca event and state:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_vhca_event &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u128:3-9093    [046] ..... 24625.365525: mlx5_sf_vhca_event: (0000:06:00.0) hw_id=0x8000 sfnum=88 vhca_state=1
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_dev_add : trace SF device add event:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_dev_add&gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u128:3-9093    [000] ..... 24616.524495: mlx5_sf_dev_add: (0000:06:00.0) sfdev=00000000fc5d96fd aux_id=4 hw_id=0x8000 sfnum=88
</pre></div>
</div>
</li>
<li><p class="first">mlx5_sf_dev_del : trace SF device delete event:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo mlx5:mlx5_sf_dev_del &gt;&gt; /sys/kernel/debug/tracing/set_event
$ cat /sys/kernel/debug/tracing/trace
...
kworker/u128:3-9093    [044] ..... 24624.400749: mlx5_sf_dev_del: (0000:06:00.0) sfdev=00000000fc5d96fd aux_id=4 hw_id=0x8000 sfnum=88
</pre></div>
</div>
</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../microsoft/netvsc.html" class="btn btn-neutral float-right" title="Hyper-V network driver" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../marvell/octeontx2.html" class="btn btn-neutral" title="Marvell OcteonTx2 RVU Kernel Drivers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TTY Internals &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="TTY" href="index.html"/>
        <link rel="next" title="Linux PECI Subsystem" href="../peci/index.html"/>
        <link rel="prev" title="N_TTY" href="n_tty.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tty_driver.html">TTY Driver and TTY Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_port.html">TTY Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_struct.html">TTY Struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_ldisc.html">TTY Line Discipline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_buffer.html">TTY Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="n_tty.html">N_TTY</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TTY Internals</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kopen">Kopen</a></li>
<li class="toctree-l4"><a class="reference internal" href="#exported-internal-functions">Exported Internal Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-functions">Internal Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TTY</a> &raquo;</li>
        
      <li>TTY Internals</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tty/tty_internals.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tty-internals">
<h1>TTY Internals<a class="headerlink" href="#tty-internals" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#kopen" id="id1">Kopen</a></li>
<li><a class="reference internal" href="#exported-internal-functions" id="id2">Exported Internal Functions</a></li>
<li><a class="reference internal" href="#internal-functions" id="id3">Internal Functions</a></li>
</ul>
</div>
<div class="section" id="kopen">
<h2><a class="toc-backref" href="#id1">Kopen</a><a class="headerlink" href="#kopen" title="Permalink to this headline">¶</a></h2>
<p>These functions serve for opening a TTY from the kernelspace:</p>
<dl class="function">
<dt id="c.tty_kclose">
void <code class="descname">tty_kclose</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kclose" title="Permalink to this definition">¶</a></dt>
<dd><p>closes tty opened by tty_kopen</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Performs the final steps to release and free a tty device. It is the same as
<a class="reference internal" href="#c.tty_release_struct" title="tty_release_struct"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_release_struct()</span></code></a> except that it also resets <code class="docutils literal notranslate"><span class="pre">TTY_PORT_KOPENED</span></code> flag on
<strong>tty-&gt;port</strong>.</p>
<dl class="function">
<dt id="c.tty_kopen_exclusive">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_kopen_exclusive</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kopen_exclusive" title="Permalink to this definition">¶</a></dt>
<dd><p>open a tty device for kernel</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>dev_t of device to open</dd>
</dl>
<p><strong>Description</strong></p>
<p>Opens tty exclusively for kernel. Performs the driver lookup, makes sure
it’s not already opened and performs the first-time tty initialization.</p>
<dl class="docutils">
<dt>Claims the global <code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code> to serialize:</dt>
<dd><ul class="first last simple">
<li>concurrent first-time tty initialization</li>
<li>concurrent tty driver removal w/ lookup</li>
<li>concurrent tty removal from driver table</li>
</ul>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the locked initialized <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_struct</span></code></a></p>
<dl class="function">
<dt id="c.tty_kopen_shared">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_kopen_shared</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kopen_shared" title="Permalink to this definition">¶</a></dt>
<dd><p>open a tty device for shared in-kernel use</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>dev_t of device to open</dd>
</dl>
<p><strong>Description</strong></p>
<p>Opens an already existing tty for in-kernel use. Compared to
<a class="reference internal" href="#c.tty_kopen_exclusive" title="tty_kopen_exclusive"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kopen_exclusive()</span></code></a> above it doesn’t ensure to be the only user.</p>
<p>Locking: identical to tty_kopen() above.</p>
</div>
<hr class="docutils" />
<div class="section" id="exported-internal-functions">
<h2><a class="toc-backref" href="#id2">Exported Internal Functions</a><a class="headerlink" href="#exported-internal-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_dev_name_to_number">
int <code class="descname">tty_dev_name_to_number</code><span class="sig-paren">(</span>const char<em>&nbsp;*name</em>, dev_t<em>&nbsp;*number</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_dev_name_to_number" title="Permalink to this definition">¶</a></dt>
<dd><p>return dev_t for device name</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name</span></code></dt>
<dd>user space name of device under /dev</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">*number</span></code></dt>
<dd>pointer to dev_t that this function will populate</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function converts device names like ttyS0 or ttyUSB1 into dev_t like
(4, 64) or (188, 1). If no corresponding driver is registered then the
function returns -<code class="docutils literal notranslate"><span class="pre">ENODEV</span></code>.</p>
<dl class="docutils">
<dt>Locking: this acquires tty_mutex to protect the tty_drivers list from</dt>
<dd>being modified while we are traversing it, and makes sure to
release it before exiting.</dd>
</dl>
<dl class="function">
<dt id="c.tty_release_struct">
void <code class="descname">tty_release_struct</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_release_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>release a tty struct</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>index of the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Performs the final steps to release and free a tty device. It is roughly the
reverse of <a class="reference internal" href="#c.tty_init_dev" title="tty_init_dev"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_init_dev()</span></code></a>.</p>
<dl class="function">
<dt id="c.tty_get_icount">
int <code class="descname">tty_get_icount</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct serial_icounter_struct<em>&nbsp;*icount</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_get_icount" title="Permalink to this definition">¶</a></dt>
<dd><p>get tty statistics</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">serial_icounter_struct</span> <span class="pre">*icount</span></code></dt>
<dd>output parameter</dd>
</dl>
<p><strong>Description</strong></p>
<p>Gets a copy of the <strong>tty</strong>’s icount statistics.</p>
<p>Locking: none (up to the driver)</p>
</div>
<hr class="docutils" />
<div class="section" id="internal-functions">
<h2><a class="toc-backref" href="#id3">Internal Functions</a><a class="headerlink" href="#internal-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.free_tty_struct">
void <code class="descname">free_tty_struct</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.free_tty_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>free a disused tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty struct to free</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free the write buffers, tty queue and tty memory itself.</p>
<p>Locking: none. Must be called after tty is definitely unused</p>
<dl class="function">
<dt id="c.tty_free_file">
void <code class="descname">tty_free_file</code><span class="sig-paren">(</span>struct file<em>&nbsp;*file</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_free_file" title="Permalink to this definition">¶</a></dt>
<dd><p>free file-&gt;private_data</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>to free private_data of</dd>
</dl>
<p><strong>Description</strong></p>
<p>This shall be used only for fail path handling when tty_add_file was not
called yet.</p>
<dl class="function">
<dt id="c.get_tty_driver">
struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a> * <code class="descname">get_tty_driver</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em>, int<em>&nbsp;*index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.get_tty_driver" title="Permalink to this definition">¶</a></dt>
<dd><p>find device of a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>device identifier</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*index</span></code></dt>
<dd>returns the index of the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>This routine returns a tty driver structure, given a device number and also
passes back the index number.</p>
<p>Locking: caller must hold tty_mutex</p>
<dl class="function">
<dt id="c.tty_release_redirect">
struct file * <code class="descname">tty_release_redirect</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_release_redirect" title="Permalink to this definition">¶</a></dt>
<dd><p>Release a redirect on a pty if present</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is available to the pty code so if the master closes, if the slave is a
redirect it can release the redirect.</p>
<dl class="function">
<dt id="c.__tty_hangup">
void <code class="descname">__tty_hangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int<em>&nbsp;exit_session</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__tty_hangup" title="Permalink to this definition">¶</a></dt>
<dd><p>actual handler for hangup events</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">exit_session</span></code></dt>
<dd>if non-zero, signal all foreground group processes</dd>
</dl>
<p><strong>Description</strong></p>
<p>This can be called by a “kworker” kernel thread. That is process synchronous
but doesn’t hold any locks, so we need to make sure we have the appropriate
locks for what we’re doing.</p>
<p>The hangup event clears any pending redirections onto the hung up device. It
ensures future writes will error and it does the needed line discipline
hangup and signal delivery. The tty object itself remains intact.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first simple">
<li>BTM</li>
</ul>
<blockquote class="last">
<div><ul class="simple">
<li>redirect lock for undoing redirection</li>
<li>file list lock for manipulating list of ttys</li>
<li>tty_ldiscs_lock from called functions</li>
<li>termios_rwsem resetting termios data</li>
<li>tasklist_lock to walk task list for hangup event</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>-&gt;siglock to protect -&gt;signal/-&gt;sighand</li>
</ul>
</div></blockquote>
</div></blockquote>
</dd>
</dl>
<dl class="function">
<dt id="c.tty_vhangup_self">
void <code class="descname">tty_vhangup_self</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.tty_vhangup_self" title="Permalink to this definition">¶</a></dt>
<dd><p>process vhangup for own ctty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">void</span></code></dt>
<dd>no arguments</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform a vhangup on the current controlling tty</p>
<dl class="function">
<dt id="c.tty_vhangup_session">
void <code class="descname">tty_vhangup_session</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_vhangup_session" title="Permalink to this definition">¶</a></dt>
<dd><p>hangup session leader exit</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to hangup</dd>
</dl>
<p><strong>Description</strong></p>
<p>The session leader is exiting and hanging up its controlling terminal.
Every process in the foreground process group is signalled <code class="docutils literal notranslate"><span class="pre">SIGHUP</span></code>.</p>
<p>We do this synchronously so that when the syscall returns the process is
complete. That guarantee is necessary for security reasons.</p>
<dl class="function">
<dt id="c.tty_read">
ssize_t <code class="descname">tty_read</code><span class="sig-paren">(</span>struct kiocb<em>&nbsp;*iocb</em>, struct iov_iter<em>&nbsp;*to</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_read" title="Permalink to this definition">¶</a></dt>
<dd><p>read method for tty device files</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">kiocb</span> <span class="pre">*iocb</span></code></dt>
<dd>kernel I/O control block</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iov_iter</span> <span class="pre">*to</span></code></dt>
<dd>destination for the data read</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform the read system call function on this terminal device. Checks
for hung up devices before calling the line discipline method.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>Locks the line discipline internally while needed. Multiple read calls
may be outstanding in parallel.</dd>
</dl>
<dl class="function">
<dt id="c.tty_write_message">
void <code class="descname">tty_write_message</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, char<em>&nbsp;*msg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_write_message" title="Permalink to this definition">¶</a></dt>
<dd><p>write a message to a certain tty, not just the console.</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the destination tty_struct</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*msg</span></code></dt>
<dd>the message to write</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is used for messages that need to be redirected to a specific tty. We
don’t put it into the syslog queue right now maybe in the future if really
needed.</p>
<p>We must still hold the BTM and test the CLOSING flag for the moment.</p>
<dl class="function">
<dt id="c.tty_write">
ssize_t <code class="descname">tty_write</code><span class="sig-paren">(</span>struct kiocb<em>&nbsp;*iocb</em>, struct iov_iter<em>&nbsp;*from</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_write" title="Permalink to this definition">¶</a></dt>
<dd><p>write method for tty device file</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">kiocb</span> <span class="pre">*iocb</span></code></dt>
<dd>kernel I/O control block</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iov_iter</span> <span class="pre">*from</span></code></dt>
<dd>iov_iter with data to write</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write data to a tty device via the line discipline.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>Locks the line discipline as required
Writes to the tty driver are serialized by the atomic_write_lock
and are then processed in chunks to the device. The line
discipline write method will not be invoked in parallel for
each device.</dd>
</dl>
<dl class="function">
<dt id="c.tty_send_xchar">
int <code class="descname">tty_send_xchar</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, char<em>&nbsp;ch</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_send_xchar" title="Permalink to this definition">¶</a></dt>
<dd><p>send priority character</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty to send to</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">ch</span></code></dt>
<dd>xchar to send</dd>
</dl>
<p><strong>Description</strong></p>
<p>Send a high priority character to the tty even if stopped.</p>
<p>Locking: none for xchar method, write ordering for write method.</p>
<dl class="function">
<dt id="c.pty_line_name">
void <code class="descname">pty_line_name</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, int<em>&nbsp;index</em>, char<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.pty_line_name" title="Permalink to this definition">¶</a></dt>
<dd><p>generate name for a pty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the tty driver in use</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt>
<dd>the minor number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*p</span></code></dt>
<dd>output buffer of at least 6 bytes</dd>
</dl>
<p><strong>Description</strong></p>
<p>Generate a name from a <strong>driver</strong> reference and write it to the output buffer
<strong>p</strong>.</p>
<p>Locking: None</p>
<dl class="function">
<dt id="c.tty_line_name">
ssize_t <code class="descname">tty_line_name</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, int<em>&nbsp;index</em>, char<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_line_name" title="Permalink to this definition">¶</a></dt>
<dd><p>generate name for a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the tty driver in use</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">index</span></code></dt>
<dd>the minor number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">*p</span></code></dt>
<dd>output buffer of at least 7 bytes</dd>
</dl>
<p><strong>Description</strong></p>
<p>Generate a name from a <strong>driver</strong> reference and write it to the output buffer
<strong>p</strong>.</p>
<p>Locking: None</p>
<dl class="function">
<dt id="c.tty_driver_lookup_tty">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_driver_lookup_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, struct file<em>&nbsp;*file</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_driver_lookup_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>find an existing tty, if any</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the driver for the tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>file object</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>the minor number</dd>
</dl>
<p><strong>Return</strong></p>
<p>the tty, if found. If not found, return <code class="docutils literal notranslate"><span class="pre">NULL</span></code> or ERR_PTR() if the
driver lookup() method returns an error.</p>
<p><strong>Description</strong></p>
<p>Locking: tty_mutex must be held. If the tty is found, bump the tty kref.</p>
<dl class="function">
<dt id="c.tty_driver_install_tty">
int <code class="descname">tty_driver_install_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_driver_install_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>install a tty entry in the driver</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the driver for the tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Install a tty object into the driver tables. The <strong>tty-&gt;index</strong> field will be
set by the time this is called. This method is responsible for ensuring any
need additional structures are allocated and configured.</p>
<p>Locking: tty_mutex for now</p>
<dl class="function">
<dt id="c.tty_driver_remove_tty">
void <code class="descname">tty_driver_remove_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_driver_remove_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>remove a tty from the driver tables</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the driver for the tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to remove</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove a tty object from the driver tables. The tty-&gt;index field will be set
by the time this is called.</p>
<p>Locking: tty_mutex for now</p>
<dl class="function">
<dt id="c.tty_reopen">
int <code class="descname">tty_reopen</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_reopen" title="Permalink to this definition">¶</a></dt>
<dd><p>fast re-open of an open tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty to open</dd>
</dl>
<p><strong>Description</strong></p>
<p>Re-opens on master ptys are not allowed and return -<code class="docutils literal notranslate"><span class="pre">EIO</span></code>.</p>
<p>Locking: Caller must hold tty_lock</p>
<p><strong>Return</strong></p>
<p>0 on success, -errno on error.</p>
<dl class="function">
<dt id="c.tty_init_dev">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_init_dev</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_init_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>initialise a tty device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>tty driver we are opening a device on</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>device index</dd>
</dl>
<p><strong>Description</strong></p>
<p>Prepare a tty device. This may not be a “new” clean device but could also be
an active device. The pty drivers require special handling because of this.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>The function is called under the tty_mutex, which protects us from the
tty struct or driver itself going away.</dd>
</dl>
<p>On exit the tty device has the line discipline attached and a reference
count of 1. If a pair was created for pty/tty use and the other was a pty
master then it too has a reference count of 1.</p>
<p>WSH 06/09/97: Rewritten to remove races and properly clean up after a failed
open. The new code protects the open with a mutex, so it’s really quite
straightforward. The mutex locking can probably be relaxed for the (most
common) case of reopening a tty.</p>
<p><strong>Return</strong></p>
<p>new tty structure</p>
<dl class="function">
<dt id="c.tty_flush_works">
void <code class="descname">tty_flush_works</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_flush_works" title="Permalink to this definition">¶</a></dt>
<dd><p>flush all works of a tty/pty pair</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device to flush works for (or either end of a pty pair)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Sync flush all works belonging to <strong>tty</strong> (and the ‘other’ tty).</p>
<dl class="function">
<dt id="c.release_one_tty">
void <code class="descname">release_one_tty</code><span class="sig-paren">(</span>struct work_struct<em>&nbsp;*work</em><span class="sig-paren">)</span><a class="headerlink" href="#c.release_one_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>release tty structure memory</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_struct</span> <span class="pre">*work</span></code></dt>
<dd>work of tty we are obliterating</dd>
</dl>
<p><strong>Description</strong></p>
<p>Releases memory associated with a tty structure, and clears out the
driver table slots. This function is called when a device is no longer
in use. It also gets called when setup of a device fails.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>takes the file list lock internally when working on the list of ttys
that the driver keeps.</dd>
</dl>
<p>This method gets called from a work queue so that the driver private
cleanup ops can sleep (needed for USB at least)</p>
<dl class="function">
<dt id="c.release_tty">
void <code class="descname">release_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.release_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>release tty structure memory</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device release</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>index of the tty device release</dd>
</dl>
<p><strong>Description</strong></p>
<p>Release both <strong>tty</strong> and a possible linked partner (think pty pair),
and decrement the refcount of the backing module.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>tty_mutex
takes the file list lock internally when working on the list of ttys
that the driver keeps.</dd>
</dl>
<dl class="function">
<dt id="c.tty_release_checks">
int <code class="descname">tty_release_checks</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_release_checks" title="Permalink to this definition">¶</a></dt>
<dd><p>check a tty before real release</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to check</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>index of the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Performs some paranoid checking before true release of the <strong>tty</strong>. This is a
no-op unless <code class="docutils literal notranslate"><span class="pre">TTY_PARANOIA_CHECK</span></code> is defined.</p>
<dl class="function">
<dt id="c.tty_release">
int <code class="descname">tty_release</code><span class="sig-paren">(</span>struct inode<em>&nbsp;*inode</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_release" title="Permalink to this definition">¶</a></dt>
<dd><p>vfs callback for close</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">inode</span> <span class="pre">*inode</span></code></dt>
<dd>inode of tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer for handle to tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called the last time each file handle is closed that references this tty.
There may however be several such references.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>Takes BKL. See tty_release_dev().</dd>
</dl>
<p>Even releasing the tty structures is a tricky business. We have to be very
careful that the structures are all released at the same time, as interrupts
might otherwise get the wrong pointers.</p>
<p>WSH 09/09/97: rewritten to avoid some nasty race conditions that could
lead to double frees or releasing memory still in use.</p>
<dl class="function">
<dt id="c.tty_open_current_tty">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_open_current_tty</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_open_current_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>get locked tty of current task</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>device number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer to tty</dd>
</dl>
<p><strong>Return</strong></p>
<p>locked tty of the current task iff <strong>device</strong> is /dev/tty</p>
<p><strong>Description</strong></p>
<p>Performs a re-open of the current task’s controlling tty.</p>
<p>We cannot return driver and index like for the other nodes because devpts
will not work then. It expects inodes to be from devpts FS.</p>
<dl class="function">
<dt id="c.tty_lookup_driver">
struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a> * <code class="descname">tty_lookup_driver</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em>, struct file<em>&nbsp;*filp</em>, int<em>&nbsp;*index</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_lookup_driver" title="Permalink to this definition">¶</a></dt>
<dd><p>lookup a tty driver for a given device file</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>device number</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer to tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">*index</span></code></dt>
<dd>index for the device in the <strong>return</strong> driver</dd>
</dl>
<p><strong>Description</strong></p>
<p>If returned value is not erroneous, the caller is responsible to decrement
the refcount by <a class="reference internal" href="tty_driver.html#c.tty_driver_kref_put" title="tty_driver_kref_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_driver_kref_put()</span></code></a>.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code> protects <a class="reference internal" href="#c.get_tty_driver" title="get_tty_driver"><code class="xref c c-func docutils literal notranslate"><span class="pre">get_tty_driver()</span></code></a></p>
<p><strong>Return</strong></p>
<p>driver for this inode (with increased refcount)</p>
<dl class="function">
<dt id="c.tty_open_by_driver">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_open_by_driver</code><span class="sig-paren">(</span>dev_t<em>&nbsp;device</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_open_by_driver" title="Permalink to this definition">¶</a></dt>
<dd><p>open a tty device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev_t</span> <span class="pre">device</span></code></dt>
<dd>dev_t of device to open</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer to tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Performs the driver lookup, checks for a reopen, or otherwise performs the
first-time tty initialization.</p>
<dl class="docutils">
<dt>Claims the global tty_mutex to serialize:</dt>
<dd><ul class="first last simple">
<li>concurrent first-time tty initialization</li>
<li>concurrent tty driver removal w/ lookup</li>
<li>concurrent tty removal from driver table</li>
</ul>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>the locked initialized or re-opened <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_struct</span></code></a></p>
<dl class="function">
<dt id="c.tty_open">
int <code class="descname">tty_open</code><span class="sig-paren">(</span>struct inode<em>&nbsp;*inode</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_open" title="Permalink to this definition">¶</a></dt>
<dd><p>open a tty device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">inode</span> <span class="pre">*inode</span></code></dt>
<dd>inode of device file</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer to tty</dd>
</dl>
<p><strong>Description</strong></p>
<p><a class="reference internal" href="#c.tty_open" title="tty_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_open()</span></code></a> and <a class="reference internal" href="#c.tty_release" title="tty_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_release()</span></code></a> keep up the tty count that contains the number
of opens done on a tty. We cannot use the inode-count, as different inodes
might point to the same tty.</p>
<p>Open-counting is needed for pty masters, as well as for keeping track of
serial lines: DTR is dropped when the last close happens.
(This is not done solely through tty-&gt;count, now.  - Ted 1/27/92)</p>
<p>The termios state of a pty is reset on the first open so that settings don’t
persist across reuse.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li><code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code> protects tty, <a class="reference internal" href="#c.tty_lookup_driver" title="tty_lookup_driver"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_lookup_driver()</span></code></a> and <a class="reference internal" href="#c.tty_init_dev" title="tty_init_dev"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_init_dev()</span></code></a>.</li>
<li><strong>tty-&gt;count</strong> should protect the rest.</li>
<li>-&gt;siglock protects -&gt;signal/-&gt;sighand</li>
</ul>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>the tty_unlock/lock cases without a ref are only safe due to <code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code></p>
<dl class="function">
<dt id="c.tty_poll">
__poll_t <code class="descname">tty_poll</code><span class="sig-paren">(</span>struct file<em>&nbsp;*filp</em>, poll_table<em>&nbsp;*wait</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_poll" title="Permalink to this definition">¶</a></dt>
<dd><p>check tty status</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file being polled</dd>
<dt><code class="docutils literal notranslate"><span class="pre">poll_table</span> <span class="pre">*wait</span></code></dt>
<dd>poll wait structures to update</dd>
</dl>
<p><strong>Description</strong></p>
<p>Call the line discipline polling method to obtain the poll status of the
device.</p>
<p>Locking: locks called line discipline but ldisc poll method may be
re-entered freely by other callers.</p>
<dl class="function">
<dt id="c.tiocsti">
int <code class="descname">tiocsti</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, char __user<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tiocsti" title="Permalink to this definition">¶</a></dt>
<dd><p>fake input character</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to fake input into</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">__user</span> <span class="pre">*p</span></code></dt>
<dd>pointer to character</dd>
</dl>
<p><strong>Description</strong></p>
<p>Fake input to a tty device. Does the necessary locking and input management.</p>
<p>FIXME: does not honour flow control ??</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>Called functions take tty_ldiscs_lock</li>
<li>current-&gt;signal-&gt;tty check is safe without locks</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="c.tiocgwinsz">
int <code class="descname">tiocgwinsz</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct winsize __user<em>&nbsp;*arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tiocgwinsz" title="Permalink to this definition">¶</a></dt>
<dd><p>implement window query ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">winsize</span> <span class="pre">__user</span> <span class="pre">*arg</span></code></dt>
<dd>user buffer for result</dd>
</dl>
<p><strong>Description</strong></p>
<p>Copies the kernel idea of the window size into the user buffer.</p>
<p>Locking: <strong>tty-&gt;winsize_mutex</strong> is taken to ensure the winsize data is
consistent.</p>
<dl class="function">
<dt id="c.tiocswinsz">
int <code class="descname">tiocswinsz</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct winsize __user<em>&nbsp;*arg</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tiocswinsz" title="Permalink to this definition">¶</a></dt>
<dd><p>implement window size set ioctl</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty side of tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">winsize</span> <span class="pre">__user</span> <span class="pre">*arg</span></code></dt>
<dd>user buffer for result</dd>
</dl>
<p><strong>Description</strong></p>
<p>Copies the user idea of the window size to the kernel. Traditionally this is
just advisory information but for the Linux console it actually has driver
level meaning and triggers a VC resize.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>Driver dependent. The default do_resize method takes the tty termios
mutex and ctrl.lock. The console takes its own lock then calls into the
default method.</dd>
</dl>
<dl class="function">
<dt id="c.tioccons">
int <code class="descname">tioccons</code><span class="sig-paren">(</span>struct file<em>&nbsp;*file</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tioccons" title="Permalink to this definition">¶</a></dt>
<dd><p>allow admin to move logical console</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>the file to become console</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allow the administrator to move the redirected console device.</p>
<p>Locking: uses redirect_lock to guard the redirect information</p>
<dl class="function">
<dt id="c.tiocsetd">
int <code class="descname">tiocsetd</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int __user<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tiocsetd" title="Permalink to this definition">¶</a></dt>
<dd><p>set line discipline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">__user</span> <span class="pre">*p</span></code></dt>
<dd>pointer to user data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Set the line discipline according to user request.</p>
<p>Locking: see <a class="reference internal" href="tty_ldisc.html#c.tty_set_ldisc" title="tty_set_ldisc"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_set_ldisc()</span></code></a>, this function is just a helper</p>
<dl class="function">
<dt id="c.tiocgetd">
int <code class="descname">tiocgetd</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int __user<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tiocgetd" title="Permalink to this definition">¶</a></dt>
<dd><p>get line discipline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">__user</span> <span class="pre">*p</span></code></dt>
<dd>pointer to user data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Retrieves the line discipline id directly from the ldisc.</p>
<p>Locking: waits for ldisc reference (in case the line discipline is changing
or the <strong>tty</strong> is being hungup)</p>
<dl class="function">
<dt id="c.send_break">
int <code class="descname">send_break</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned int<em>&nbsp;duration</em><span class="sig-paren">)</span><a class="headerlink" href="#c.send_break" title="Permalink to this definition">¶</a></dt>
<dd><p>performed time break</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>device to break on</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">duration</span></code></dt>
<dd>timeout in mS</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform a timed break on hardware that lacks its own driver level timed
break functionality.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><strong>tty-&gt;atomic_write_lock</strong> serializes</dd>
</dl>
<dl class="function">
<dt id="c.tty_tiocmget">
int <code class="descname">tty_tiocmget</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int __user<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_tiocmget" title="Permalink to this definition">¶</a></dt>
<dd><p>get modem status</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">__user</span> <span class="pre">*p</span></code></dt>
<dd>pointer to result</dd>
</dl>
<p><strong>Description</strong></p>
<p>Obtain the modem status bits from the tty driver if the feature is
supported. Return -<code class="docutils literal notranslate"><span class="pre">ENOTTY</span></code> if it is not available.</p>
<p>Locking: none (up to the driver)</p>
<dl class="function">
<dt id="c.tty_tiocmset">
int <code class="descname">tty_tiocmset</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned int<em>&nbsp;cmd</em>, unsigned __user<em>&nbsp;*p</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_tiocmset" title="Permalink to this definition">¶</a></dt>
<dd><p>set modem status</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">cmd</span></code></dt>
<dd>command - clear bits, set bits or set all</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">__user</span> <span class="pre">*p</span></code></dt>
<dd>pointer to desired bits</dd>
</dl>
<p><strong>Description</strong></p>
<p>Set the modem status bits from the tty driver if the feature
is supported. Return -<code class="docutils literal notranslate"><span class="pre">ENOTTY</span></code> if it is not available.</p>
<p>Locking: none (up to the driver)</p>
<dl class="function">
<dt id="c.alloc_tty_struct">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">alloc_tty_struct</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, int<em>&nbsp;idx</em><span class="sig-paren">)</span><a class="headerlink" href="#c.alloc_tty_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>allocate a new tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>driver which will handle the returned tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">idx</span></code></dt>
<dd>minor of the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>This subroutine allocates and initializes a tty structure.</p>
<p>Locking: none - <strong>tty</strong> in question is not exposed at this point</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../peci/index.html" class="btn btn-neutral float-right" title="Linux PECI Subsystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="n_tty.html" class="btn btn-neutral" title="N_TTY" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TTY Port &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="TTY" href="index.html"/>
        <link rel="next" title="TTY Struct" href="tty_struct.html"/>
        <link rel="prev" title="TTY Driver and TTY Operations" href="tty_driver.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tty_driver.html">TTY Driver and TTY Operations</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TTY Port</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tty-port-functions">TTY Port Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tty-port-reference">TTY Port Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tty-port-operations-reference">TTY Port Operations Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tty_struct.html">TTY Struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_ldisc.html">TTY Line Discipline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_buffer.html">TTY Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="n_tty.html">N_TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_internals.html">TTY Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TTY</a> &raquo;</li>
        
      <li>TTY Port</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tty/tty_port.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tty-port">
<h1>TTY Port<a class="headerlink" href="#tty-port" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#tty-port-functions" id="id1">TTY Port Functions</a><ul>
<li><a class="reference internal" href="#init-destroy" id="id2">Init &amp; Destroy</a></li>
<li><a class="reference internal" href="#open-close-hangup-helpers" id="id3">Open/Close/Hangup Helpers</a></li>
<li><a class="reference internal" href="#tty-refcounting" id="id4">TTY Refcounting</a></li>
<li><a class="reference internal" href="#tty-helpers" id="id5">TTY Helpers</a></li>
<li><a class="reference internal" href="#modem-signals" id="id6">Modem Signals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tty-port-reference" id="id7">TTY Port Reference</a></li>
<li><a class="reference internal" href="#tty-port-operations-reference" id="id8">TTY Port Operations Reference</a></li>
</ul>
</div>
<p>The TTY drivers are advised to use <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> helpers as much as possible.
If the drivers implement <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_port.ops.activate()</span></code> and
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_port.ops.shutdown()</span></code>, they can use <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>,
<a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a>, and <a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a> in respective
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_struct.ops</span></code> hooks.</p>
<p>The reference and details are contained in the <a class="reference internal" href="#tty-port-reference">TTY Port Reference</a> and <a class="reference internal" href="#tty-port-operations-reference">TTY
Port Operations Reference</a> sections at the bottom.</p>
<div class="section" id="tty-port-functions">
<h2><a class="toc-backref" href="#id1">TTY Port Functions</a><a class="headerlink" href="#tty-port-functions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="init-destroy">
<h3><a class="toc-backref" href="#id2">Init &amp; Destroy</a><a class="headerlink" href="#init-destroy" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.tty_port_init">
void <code class="descname">tty_port_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_init" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>initialize tty_port</li>
</ul>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port to initialize</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initializes the state of <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>. When a port was initialized using
this function, one has to destroy the port by <a class="reference internal" href="#c.tty_port_destroy" title="tty_port_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_destroy()</span></code></a>. Either
indirectly by using <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_port</span></code></a> refcounting (<a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a>) or directly if
refcounting is not used.</p>
<dl class="function">
<dt id="c.tty_port_destroy">
void <code class="descname">tty_port_destroy</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_destroy" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>destroy inited port</li>
</ul>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to be destroyed</dd>
</dl>
<p><strong>Description</strong></p>
<p>When a port was initialized using <a class="reference internal" href="#c.tty_port_init" title="tty_port_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_init()</span></code></a>, one has to destroy the
port by this function. Either indirectly by using <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_port</span></code></a> refcounting
(<a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a>) or directly if refcounting is not used.</p>
<dl class="function">
<dt id="c.tty_port_put">
void <code class="descname">tty_port_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_put" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>drop a reference to tty_port</li>
</ul>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>port to drop a reference of (can be NULL)</dd>
</dl>
<p><strong>Description</strong></p>
<p>The final put will destroy and free up the <strong>port</strong> using
<strong>port-&gt;ops-&gt;destruct()</strong> hook, or using <a class="reference internal" href="../core-api/mm-api.html#c.kfree" title="kfree"><code class="xref c c-func docutils literal notranslate"><span class="pre">kfree()</span></code></a> if not provided.</p>
</div>
<div class="section" id="open-close-hangup-helpers">
<h3><a class="toc-backref" href="#id3">Open/Close/Hangup Helpers</a><a class="headerlink" href="#open-close-hangup-helpers" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.tty_port_shutdown">
void <code class="descname">tty_port_shutdown</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_shutdown" title="Permalink to this definition">¶</a></dt>
<dd><p>internal helper to shutdown the device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to be shut down</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the associated tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is used by <a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a> and <a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a>. Its task is to
shutdown the device if it was initialized (note consoles remain
functioning). It lowers DTR/RTS (if <strong>tty</strong> has HUPCL set) and invokes
<strong>port-&gt;ops-&gt;shutdown()</strong>.</p>
<dl class="function">
<dt id="c.tty_port_hangup">
void <code class="descname">tty_port_hangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_hangup" title="Permalink to this definition">¶</a></dt>
<dd><p>hangup helper</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform port level tty hangup flag and count changes. Drop the tty
reference.</p>
<p>Caller holds tty lock.</p>
<dl class="function">
<dt id="c.tty_port_block_til_ready">
int <code class="descname">tty_port_block_til_ready</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_block_til_ready" title="Permalink to this definition">¶</a></dt>
<dd><p>Waiting logic for tty open</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>the tty port being opened</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty device being bound</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>the file pointer of the opener or <code class="docutils literal notranslate"><span class="pre">NULL</span></code></dd>
</dl>
<p><strong>Description</strong></p>
<p>Implement the core POSIX/SuS tty behaviour when opening a tty device.
Handles:</p>
<blockquote>
<div><ul class="simple">
<li>hangup (both before and during)</li>
<li>non blocking open</li>
<li>rts/dtr/dcd</li>
<li>signals</li>
<li>port flags and counts</li>
</ul>
</div></blockquote>
<p>The passed <strong>port</strong> must implement the <strong>port-&gt;ops-&gt;carrier_raised</strong> method if it
can do carrier detect and the <strong>port-&gt;ops-&gt;dtr_rts</strong> method if it supports
software management of these lines. Note that the dtr/rts raise is done each
iteration as a hangup may have previously dropped them while we wait.</p>
<p>Caller holds tty lock.</p>
<p><strong>Note</strong></p>
<p>May drop and reacquire tty lock when blocking, so <strong>tty</strong> and <strong>port</strong> may
have changed state (eg., may have been hung up).</p>
<dl class="function">
<dt id="c.tty_port_close_start">
int <code class="descname">tty_port_close_start</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close_start" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for tty-&gt;ops-&gt;close, part 1/2</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty being closed</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>passed file pointer</dd>
</dl>
<p><strong>Description</strong></p>
<p>Decrements and checks open count. Flushes the port if this is the last
close. That means, dropping the data from the outpu buffer on the device and
waiting for sending logic to finish. The rest of close handling is performed
in <a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a>.</p>
<p>Locking: Caller holds tty lock.</p>
<p><strong>Return</strong></p>
<p>1 if this is the last close, otherwise 0</p>
<dl class="function">
<dt id="c.tty_port_close_end">
void <code class="descname">tty_port_close_end</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close_end" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for tty-&gt;ops-&gt;close, part 2/2</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty being closed</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a continuation of the first part: <a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a>. This
should be called after turning off the device. It flushes the data from the
line discipline and delays the close by <strong>port-&gt;close_delay</strong>.</p>
<p>Locking: Caller holds tty lock.</p>
<dl class="function">
<dt id="c.tty_port_close">
void <code class="descname">tty_port_close</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_close" title="Permalink to this definition">¶</a></dt>
<dd><p>generic tty-&gt;ops-&gt;close handler</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty being closed</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>passed file pointer</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is a generic helper to be used in driver’s <strong>tty-&gt;ops-&gt;close</strong>. It wraps a
sequence of <a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a>, <a class="reference internal" href="#c.tty_port_shutdown" title="tty_port_shutdown"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_shutdown()</span></code></a>, and
<a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a>. The latter two are called only if this is the last
close. See the respective functions for the details.</p>
<p>Locking: Caller holds tty lock</p>
<dl class="function">
<dt id="c.tty_port_install">
int <code class="descname">tty_port_install</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_install" title="Permalink to this definition">¶</a></dt>
<dd><p>generic tty-&gt;ops-&gt;install handler</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>tty_driver for this device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to be installed</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is the same as <a class="reference internal" href="tty_struct.html#c.tty_standard_install" title="tty_standard_install"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_standard_install()</span></code></a> except the provided <strong>port</strong> is linked
to a concrete tty specified by <strong>tty</strong>. Use this or <a class="reference internal" href="tty_driver.html#c.tty_port_register_device" title="tty_port_register_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_register_device()</span></code></a>
(or both). Call <a class="reference internal" href="tty_driver.html#c.tty_port_link_device" title="tty_port_link_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_link_device()</span></code></a> as a last resort.</p>
<dl class="function">
<dt id="c.tty_port_open">
int <code class="descname">tty_port_open</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_open" title="Permalink to this definition">¶</a></dt>
<dd><p>generic tty-&gt;ops-&gt;open handler</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty_port of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to be opened</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>passed file pointer</dd>
</dl>
<p><strong>Description</strong></p>
<p>It is a generic helper to be used in driver’s <strong>tty-&gt;ops-&gt;open</strong>. It activates
the devices using <strong>port-&gt;ops-&gt;activate</strong> if not active already. And waits for
the device to be ready using <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a> (e.g.  raises
DTR/CTS and waits for carrier).</p>
<p>Note that <strong>port-&gt;ops-&gt;shutdown</strong> is not called when <strong>port-&gt;ops-&gt;activate</strong>
returns an error (on the contrary, <strong>tty-&gt;ops-&gt;close</strong> is).</p>
<p>Locking: Caller holds tty lock.</p>
<p><strong>Note</strong></p>
<p>may drop and reacquire tty lock (in <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a>) so
<strong>tty</strong> and <strong>port</strong> may have changed state (eg., may be hung up now).</p>
</div>
<div class="section" id="tty-refcounting">
<h3><a class="toc-backref" href="#id4">TTY Refcounting</a><a class="headerlink" href="#tty-refcounting" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.tty_port_tty_get">
struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_port_tty_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_get" title="Permalink to this definition">¶</a></dt>
<dd><p>get a tty reference</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
<p><strong>Description</strong></p>
<p>Return a refcount protected tty instance or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> if the port is not
associated with a tty (eg due to close or hangup).</p>
<dl class="function">
<dt id="c.tty_port_tty_set">
void <code class="descname">tty_port_tty_set</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_set" title="Permalink to this definition">¶</a></dt>
<dd><p>set the tty of a port</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>Associate the port and tty pair. Manages any internal refcounts. Pass <code class="docutils literal notranslate"><span class="pre">NULL</span></code>
to deassociate a port.</p>
</div>
<div class="section" id="tty-helpers">
<h3><a class="toc-backref" href="#id5">TTY Helpers</a><a class="headerlink" href="#tty-helpers" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.tty_port_tty_hangup">
void <code class="descname">tty_port_tty_hangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, bool<em>&nbsp;check_clocal</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_hangup" title="Permalink to this definition">¶</a></dt>
<dd><p>helper to hang up a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">bool</span> <span class="pre">check_clocal</span></code></dt>
<dd>hang only ttys with <code class="docutils literal notranslate"><span class="pre">CLOCAL</span></code> unset?</dd>
</dl>
<dl class="function">
<dt id="c.tty_port_tty_wakeup">
void <code class="descname">tty_port_tty_wakeup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_tty_wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>helper to wake up a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
</div>
<div class="section" id="modem-signals">
<h3><a class="toc-backref" href="#id6">Modem Signals</a><a class="headerlink" href="#modem-signals" title="Permalink to this headline">¶</a></h3>
<dl class="function">
<dt id="c.tty_port_carrier_raised">
int <code class="descname">tty_port_carrier_raised</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_carrier_raised" title="Permalink to this definition">¶</a></dt>
<dd><p>carrier raised check</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the carrier detect logic. For the moment this is used
to hide some internal details. This will eventually become entirely
internal to the tty port.</p>
<dl class="function">
<dt id="c.tty_port_raise_dtr_rts">
void <code class="descname">tty_port_raise_dtr_rts</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_raise_dtr_rts" title="Permalink to this definition">¶</a></dt>
<dd><p>Raise DTR/RTS</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the DTR/RTS raise logic. For the moment this is used to hide
some internal details. This will eventually become entirely internal to the
tty port.</p>
<dl class="function">
<dt id="c.tty_port_lower_dtr_rts">
void <code class="descname">tty_port_lower_dtr_rts</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_port_lower_dtr_rts" title="Permalink to this definition">¶</a></dt>
<dd><p>Lower DTR/RTS</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
</dl>
<p><strong>Description</strong></p>
<p>Wrapper for the DTR/RTS raise logic. For the moment this is used to hide
some internal details. This will eventually become entirely internal to the
tty port.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="tty-port-reference">
<h2><a class="toc-backref" href="#id7">TTY Port Reference</a><a class="headerlink" href="#tty-port-reference" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.tty_port">
struct <code class="descname">tty_port</code><a class="headerlink" href="#c.tty_port" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>port level information</li>
</ul>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_port {
  struct tty_bufhead      buf;
  struct tty_struct       *tty;
  struct tty_struct       *itty;
  const struct tty_port_operations *ops;
  const struct tty_port_client_operations *client_ops;
  spinlock_t lock;
  int blocked_open;
  int count;
  wait_queue_head_t open_wait;
  wait_queue_head_t delta_msr_wait;
  unsigned long           flags;
  unsigned long           iflags;
  unsigned char           console:1;
  struct mutex            mutex;
  struct mutex            buf_mutex;
  unsigned char           *xmit_buf;
  unsigned char *xmit_fifo;
  unsigned int            close_delay;
  unsigned int            closing_wait;
  int drain_delay;
  struct kref             kref;
  void *client_data;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">buf</span></code></dt>
<dd>buffer for this port, locked internally</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tty</span></code></dt>
<dd>back pointer to <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a>, valid only if the tty is open. Use
<a class="reference internal" href="#c.tty_port_tty_get" title="tty_port_tty_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_tty_get()</span></code></a> to obtain it (and <a class="reference internal" href="tty_struct.html#c.tty_kref_put" title="tty_kref_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_put()</span></code></a> to release).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">itty</span></code></dt>
<dd>internal back pointer to <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a>. Avoid this. It should be
eliminated in the long term.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt>
<dd>tty port operations (like activate, shutdown), see <a class="reference internal" href="#c.tty_port_operations" title="tty_port_operations"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">tty_port_operations</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">client_ops</span></code></dt>
<dd>tty port client operations (like receive_buf, write_wakeup).
By default, tty_port_default_client_ops is used.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt>
<dd>lock protecting <strong>tty</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">blocked_open</span></code></dt>
<dd># of procs waiting for open in <a class="reference internal" href="#c.tty_port_block_til_ready" title="tty_port_block_til_ready"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_block_til_ready()</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt>
<dd>usage count</dd>
<dt><code class="docutils literal notranslate"><span class="pre">open_wait</span></code></dt>
<dd>open waiters queue (waiting e.g. for a carrier)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">delta_msr_wait</span></code></dt>
<dd>modem status change queue (waiting for MSR changes)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt>
<dd>user TTY flags (<code class="docutils literal notranslate"><span class="pre">ASYNC_</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">iflags</span></code></dt>
<dd>internal flags (<code class="docutils literal notranslate"><span class="pre">TTY_PORT_</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">console</span></code></dt>
<dd>when set, the port is a console</dd>
<dt><code class="docutils literal notranslate"><span class="pre">mutex</span></code></dt>
<dd>locking, for open, shutdown and other port operations</dd>
<dt><code class="docutils literal notranslate"><span class="pre">buf_mutex</span></code></dt>
<dd><strong>xmit_buf</strong> alloc lock</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xmit_buf</span></code></dt>
<dd>optional xmit buffer used by some drivers</dd>
<dt><code class="docutils literal notranslate"><span class="pre">xmit_fifo</span></code></dt>
<dd>optional xmit buffer used by some drivers</dd>
<dt><code class="docutils literal notranslate"><span class="pre">close_delay</span></code></dt>
<dd>delay in jiffies to wait when closing the port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">closing_wait</span></code></dt>
<dd>delay in jiffies for output to be sent before closing</dd>
<dt><code class="docutils literal notranslate"><span class="pre">drain_delay</span></code></dt>
<dd>set to zero if no pure time based drain is needed else set to
size of fifo</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kref</span></code></dt>
<dd>references counter. Reaching zero calls <strong>ops-&gt;destruct()</strong> if non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code>
or frees the port otherwise.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">client_data</span></code></dt>
<dd>pointer to private data, for <strong>client_ops</strong></dd>
</dl>
<p><strong>Description</strong></p>
<p>Each device keeps its own port level information. <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> was
introduced as a common structure for such information. As every TTY device
shall have a backing tty_port structure, every driver can use these members.</p>
<p>The tty port has a different lifetime to the tty so must be kept apart.
In addition be careful as tty -&gt; port mappings are valid for the life
of the tty object but in many cases port -&gt; tty mappings are valid only
until a hangup so don’t use the wrong path.</p>
<p>Tty port shall be initialized by <a class="reference internal" href="#c.tty_port_init" title="tty_port_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_init()</span></code></a> and shut down either by
<a class="reference internal" href="#c.tty_port_destroy" title="tty_port_destroy"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_destroy()</span></code></a> (refcounting not used), or <a class="reference internal" href="#c.tty_port_put" title="tty_port_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_put()</span></code></a> (refcounting).</p>
<p>There is a lot of helpers around <a class="reference internal" href="#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a> too. To name the most
significant ones: <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>, <a class="reference internal" href="#c.tty_port_close" title="tty_port_close"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close()</span></code></a> (or
<a class="reference internal" href="#c.tty_port_close_start" title="tty_port_close_start"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_start()</span></code></a> and <a class="reference internal" href="#c.tty_port_close_end" title="tty_port_close_end"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_close_end()</span></code></a> separately if need be), and
<a class="reference internal" href="#c.tty_port_hangup" title="tty_port_hangup"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_hangup()</span></code></a>. These call <strong>ops-&gt;activate()</strong> and <strong>ops-&gt;shutdown()</strong> as
needed.</p>
</div>
<hr class="docutils" />
<div class="section" id="tty-port-operations-reference">
<h2><a class="toc-backref" href="#id8">TTY Port Operations Reference</a><a class="headerlink" href="#tty-port-operations-reference" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.tty_port_operations">
struct <code class="descname">tty_port_operations</code><a class="headerlink" href="#c.tty_port_operations" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li>operations on tty_port</li>
</ul>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_port_operations {
  int (*carrier_raised)(struct tty_port *port);
  void (*dtr_rts)(struct tty_port *port, int raise);
  void (*shutdown)(struct tty_port *port);
  int (*activate)(struct tty_port *port, struct tty_struct *tty);
  void (*destruct)(struct tty_port *port);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">carrier_raised</span></code></dt>
<dd>return 1 if the carrier is raised on <strong>port</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">dtr_rts</span></code></dt>
<dd>raise the DTR line if <strong>raise</strong> is nonzero, otherwise lower DTR</dd>
<dt><code class="docutils literal notranslate"><span class="pre">shutdown</span></code></dt>
<dd>called when the last close completes or a hangup finishes IFF the
port was initialized. Do not use to free resources. Turn off the device
only. Called under the port mutex to serialize against <strong>activate</strong> and
<strong>shutdown</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">activate</span></code></dt>
<dd><p class="first">called under the port mutex from <a class="reference internal" href="#c.tty_port_open" title="tty_port_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_port_open()</span></code></a>, serialized using
the port mutex. Supposed to turn on the device.</p>
<p class="last">FIXME: long term getting the tty argument <em>out</em> of this would be good
for consoles.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">destruct</span></code></dt>
<dd>called on the final put of a port. Free resources, possibly incl.
the port itself.</dd>
</dl>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tty_struct.html" class="btn btn-neutral float-right" title="TTY Struct" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tty_driver.html" class="btn btn-neutral" title="TTY Driver and TTY Operations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
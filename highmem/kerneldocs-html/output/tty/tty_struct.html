

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TTY Struct &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="TTY" href="index.html"/>
        <link rel="next" title="TTY Line Discipline" href="tty_ldisc.html"/>
        <link rel="prev" title="TTY Port" href="tty_port.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tty_driver.html">TTY Driver and TTY Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_port.html">TTY Port</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TTY Struct</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initialization">Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#name">Name</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reference-counting">Reference counting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install">Install</a></li>
<li class="toctree-l4"><a class="reference internal" href="#read-write">Read &amp; Write</a></li>
<li class="toctree-l4"><a class="reference internal" href="#start-stop">Start &amp; Stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#wakeup">Wakeup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hangup">Hangup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#misc">Misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tty-struct-flags">TTY Struct Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tty-struct-reference">TTY Struct Reference</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tty_ldisc.html">TTY Line Discipline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_buffer.html">TTY Buffer</a></li>
<li class="toctree-l3"><a class="reference internal" href="n_tty.html">N_TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_internals.html">TTY Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TTY</a> &raquo;</li>
        
      <li>TTY Struct</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tty/tty_struct.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tty-struct">
<h1>TTY Struct<a class="headerlink" href="#tty-struct" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#initialization" id="id1">Initialization</a></li>
<li><a class="reference internal" href="#name" id="id2">Name</a></li>
<li><a class="reference internal" href="#reference-counting" id="id3">Reference counting</a></li>
<li><a class="reference internal" href="#install" id="id4">Install</a></li>
<li><a class="reference internal" href="#read-write" id="id5">Read &amp; Write</a></li>
<li><a class="reference internal" href="#start-stop" id="id6">Start &amp; Stop</a></li>
<li><a class="reference internal" href="#wakeup" id="id7">Wakeup</a></li>
<li><a class="reference internal" href="#hangup" id="id8">Hangup</a></li>
<li><a class="reference internal" href="#misc" id="id9">Misc</a></li>
<li><a class="reference internal" href="#tty-struct-flags" id="id10">TTY Struct Flags</a></li>
<li><a class="reference internal" href="#tty-struct-reference" id="id11">TTY Struct Reference</a></li>
</ul>
</div>
<p><a class="reference internal" href="#c.tty_struct" title="tty_struct"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span></code></a> is allocated by the TTY layer upon the first open of the TTY
device and released after the last close. The TTY layer passes this structure
to most of struct tty_operation’s hooks. Members of tty_struct are documented
in <a class="reference internal" href="#tty-struct-reference">TTY Struct Reference</a> at the bottom.</p>
<div class="section" id="initialization">
<h2><a class="toc-backref" href="#id1">Initialization</a><a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_init_termios">
void <code class="descname">tty_init_termios</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_init_termios" title="Permalink to this definition">¶</a></dt>
<dd><p>helper for termios setup</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty to set up</dd>
</dl>
<p><strong>Description</strong></p>
<p>Initialise the termios structure for this tty. This runs under the
<code class="docutils literal notranslate"><span class="pre">tty_mutex</span></code> currently so we can be relaxed about ordering.</p>
</div>
<div class="section" id="name">
<h2><a class="toc-backref" href="#id2">Name</a><a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_name">
const char * <code class="descname">tty_name</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_name" title="Permalink to this definition">¶</a></dt>
<dd><p>return tty naming</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty structure</dd>
</dl>
<p><strong>Description</strong></p>
<p>Convert a tty structure into a name. The name reflects the kernel naming
policy and if udev is in use may not reflect user space</p>
<p>Locking: none</p>
</div>
<div class="section" id="reference-counting">
<h2><a class="toc-backref" href="#id3">Reference counting</a><a class="headerlink" href="#reference-counting" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_kref_get">
struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a> * <code class="descname">tty_kref_get</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kref_get" title="Permalink to this definition">¶</a></dt>
<dd><p>get a tty reference</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd><p class="first">tty device</p>
<p class="last">Return a new reference to a tty object. The caller must hold
sufficient locks/counts to ensure that their existing reference cannot
go away</p>
</dd>
</dl>
<dl class="function">
<dt id="c.tty_kref_put">
void <code class="descname">tty_kref_put</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_kref_put" title="Permalink to this definition">¶</a></dt>
<dd><p>release a tty kref</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Release a reference to the <strong>tty</strong> device and if need be let the kref layer
destruct the object for us.</p>
</div>
<div class="section" id="install">
<h2><a class="toc-backref" href="#id4">Install</a><a class="headerlink" href="#install" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_standard_install">
int <code class="descname">tty_standard_install</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver">tty_driver</a><em>&nbsp;*driver</em>, struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_standard_install" title="Permalink to this definition">¶</a></dt>
<dd><p>usual tty-&gt;ops-&gt;install</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span> <span class="pre">*driver</span></code></dt>
<dd>the driver for the tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>the tty</dd>
</dl>
<p><strong>Description</strong></p>
<p>If the <strong>driver</strong> overrides <strong>tty-&gt;ops-&gt;install</strong>, it still can call this function
to perform the standard install operations.</p>
</div>
<div class="section" id="read-write">
<h2><a class="toc-backref" href="#id5">Read &amp; Write</a><a class="headerlink" href="#read-write" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_put_char">
int <code class="descname">tty_put_char</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned char<em>&nbsp;ch</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_put_char" title="Permalink to this definition">¶</a></dt>
<dd><p>write one character to a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">ch</span></code></dt>
<dd>character to write</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write one byte to the <strong>tty</strong> using the provided <strong>tty-&gt;ops-&gt;put_char()</strong> method
if present.</p>
<p><strong>Note</strong></p>
<p>the specific put_char operation in the driver layer may go
away soon. Don’t call it directly, use this method</p>
<p><strong>Return</strong></p>
<p>the number of characters successfully output.</p>
</div>
<div class="section" id="start-stop">
<h2><a class="toc-backref" href="#id6">Start &amp; Stop</a><a class="headerlink" href="#start-stop" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.stop_tty">
void <code class="descname">stop_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.stop_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>propagate flow control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to stop</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform flow control to the driver. May be called on an already stopped
device and will not re-call the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver-&gt;stop()</span></code></a> method.</p>
<p>This functionality is used by both the line disciplines for halting incoming
flow and by the driver. It may therefore be called from any context, may be
under the tty <code class="docutils literal notranslate"><span class="pre">atomic_write_lock</span></code> but not always.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>flow.lock</dd>
</dl>
<dl class="function">
<dt id="c.start_tty">
void <code class="descname">start_tty</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.start_tty" title="Permalink to this definition">¶</a></dt>
<dd><p>propagate flow control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to start</dd>
</dl>
<p><strong>Description</strong></p>
<p>Start a tty that has been stopped if at all possible. If <strong>tty</strong> was previously
stopped and is now being started, the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver-&gt;start()</span></code></a> method is invoked
and the line discipline woken.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd>flow.lock</dd>
</dl>
</div>
<div class="section" id="wakeup">
<h2><a class="toc-backref" href="#id7">Wakeup</a><a class="headerlink" href="#wakeup" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_wakeup">
void <code class="descname">tty_wakeup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>request more data</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
</dl>
<p><strong>Description</strong></p>
<p>Internal and external helper for wakeups of tty. This function informs the
line discipline if present that the driver is ready to receive more output
data.</p>
</div>
<div class="section" id="hangup">
<h2><a class="toc-backref" href="#id8">Hangup</a><a class="headerlink" href="#hangup" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_hangup">
void <code class="descname">tty_hangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_hangup" title="Permalink to this definition">¶</a></dt>
<dd><p>trigger a hangup event</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to hangup</dd>
</dl>
<p><strong>Description</strong></p>
<p>A carrier loss (virtual or otherwise) has occurred on <strong>tty</strong>. Schedule a
hangup sequence to run after this event.</p>
<dl class="function">
<dt id="c.tty_vhangup">
void <code class="descname">tty_vhangup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_vhangup" title="Permalink to this definition">¶</a></dt>
<dd><p>process vhangup</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to hangup</dd>
</dl>
<p><strong>Description</strong></p>
<p>The user has asked via system call for the terminal to be hung up. We do
this synchronously so that when the syscall returns the process is complete.
That guarantee is necessary for security reasons.</p>
<dl class="function">
<dt id="c.tty_hung_up_p">
int <code class="descname">tty_hung_up_p</code><span class="sig-paren">(</span>struct file<em>&nbsp;*filp</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_hung_up_p" title="Permalink to this definition">¶</a></dt>
<dd><p>was tty hung up</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*filp</span></code></dt>
<dd>file pointer of tty</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the tty has been subject to a vhangup or a carrier loss</p>
</div>
<div class="section" id="misc">
<h2><a class="toc-backref" href="#id9">Misc</a><a class="headerlink" href="#misc" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_do_resize">
int <code class="descname">tty_do_resize</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct winsize<em>&nbsp;*ws</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_do_resize" title="Permalink to this definition">¶</a></dt>
<dd><p>resize event</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty being resized</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">winsize</span> <span class="pre">*ws</span></code></dt>
<dd>new dimensions</dd>
</dl>
<p><strong>Description</strong></p>
<p>Update the termios variables and send the necessary signals to peform a
terminal resize correctly.</p>
</div>
<div class="section" id="tty-struct-flags">
<h2><a class="toc-backref" href="#id10">TTY Struct Flags</a><a class="headerlink" href="#tty-struct-flags" title="Permalink to this headline">¶</a></h2>
<p>These bits are used in the <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_struct.flags</span></code> field.</p>
<p>So that interrupts won’t be able to mess up the queues,
copy_to_cooked must be atomic with respect to itself, as must
tty-&gt;write.  Thus, you must use the inline functions <a class="reference internal" href="../core-api/kernel-api.html#c.set_bit" title="set_bit"><code class="xref c c-func docutils literal notranslate"><span class="pre">set_bit()</span></code></a> and
<a class="reference internal" href="../core-api/kernel-api.html#c.clear_bit" title="clear_bit"><code class="xref c c-func docutils literal notranslate"><span class="pre">clear_bit()</span></code></a> to make things atomic.</p>
<dl class="docutils">
<dt>TTY_THROTTLED</dt>
<dd>Driver input is throttled. The ldisc should call
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_driver.unthrottle()</span></code> in order to resume reception when
it is ready to process more data (at threshold min).</dd>
<dt>TTY_IO_ERROR</dt>
<dd>If set, causes all subsequent userspace read/write calls on the tty to
fail, returning -<code class="docutils literal notranslate"><span class="pre">EIO</span></code>. (May be no ldisc too.)</dd>
<dt>TTY_OTHER_CLOSED</dt>
<dd>Device is a pty and the other side has closed.</dd>
<dt>TTY_EXCLUSIVE</dt>
<dd>Exclusive open mode (a single opener).</dd>
<dt>TTY_DO_WRITE_WAKEUP</dt>
<dd>If set, causes the driver to call the
<code class="xref c c-member docutils literal notranslate"><span class="pre">tty_ldisc_ops.write_wakeup()</span></code> method in order to resume
transmission when it can accept more data to transmit.</dd>
<dt>TTY_LDISC_OPEN</dt>
<dd>Indicates that a line discipline is open. For debugging purposes only.</dd>
<dt>TTY_PTY_LOCK</dt>
<dd>A flag private to pty code to implement <code class="docutils literal notranslate"><span class="pre">TIOCSPTLCK</span></code>/<code class="docutils literal notranslate"><span class="pre">TIOCGPTLCK</span></code> logic.</dd>
<dt>TTY_NO_WRITE_SPLIT</dt>
<dd>Prevent driver from splitting up writes into smaller chunks (preserve
write boundaries to driver).</dd>
<dt>TTY_HUPPED</dt>
<dd>The TTY was hung up. This is set post <code class="xref c c-member docutils literal notranslate"><span class="pre">tty_driver.hangup()</span></code>.</dd>
<dt>TTY_HUPPING</dt>
<dd>The TTY is in the process of hanging up to abort potential readers.</dd>
<dt>TTY_LDISC_CHANGING</dt>
<dd>Line discipline for this TTY is being changed. I/O should not block
when this is set. Use tty_io_nonblock() to check.</dd>
<dt>TTY_LDISC_HALTED</dt>
<dd>Line discipline for this TTY was stopped. No work should be queued to
this ldisc.</dd>
</dl>
</div>
<div class="section" id="tty-struct-reference">
<h2><a class="toc-backref" href="#id11">TTY Struct Reference</a><a class="headerlink" href="#tty-struct-reference" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="c.tty_struct">
struct <code class="descname">tty_struct</code><a class="headerlink" href="#c.tty_struct" title="Permalink to this definition">¶</a></dt>
<dd><p>state associated with a tty while open</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct tty_struct {
  int magic;
  struct kref kref;
  struct device *dev;
  struct tty_driver *driver;
  const struct tty_operations *ops;
  int index;
  struct ld_semaphore ldisc_sem;
  struct tty_ldisc *ldisc;
  struct mutex atomic_write_lock;
  struct mutex legacy_mutex;
  struct mutex throttle_mutex;
  struct rw_semaphore termios_rwsem;
  struct mutex winsize_mutex;
  struct ktermios termios, termios_locked;
  char name[64];
  unsigned long flags;
  int count;
  struct winsize winsize;
  struct {
    spinlock_t lock;
    bool stopped;
    bool tco_stopped;
    unsigned long unused[0];
  } flow;
  struct {
    spinlock_t lock;
    struct pid *pgrp;
    struct pid *session;
    unsigned char pktstatus;
    bool packet;
    unsigned long unused[0];
  } ctrl;
  int hw_stopped;
  unsigned int receive_room;
  int flow_change;
  struct tty_struct *link;
  struct fasync_struct *fasync;
  wait_queue_head_t write_wait;
  wait_queue_head_t read_wait;
  struct work_struct hangup_work;
  void *disc_data;
  void *driver_data;
  spinlock_t files_lock;
  struct list_head tty_files;
#define N_TTY_BUF_SIZE 4096;
  int closing;
  unsigned char *write_buf;
  int write_cnt;
  struct work_struct SAK_work;
  struct tty_port *port;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">magic</span></code></dt>
<dd>magic value set early in <strong>alloc_tty_struct</strong> to <code class="docutils literal notranslate"><span class="pre">TTY_MAGIC</span></code>, for
debugging purposes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">kref</span></code></dt>
<dd>reference counting by <a class="reference internal" href="#c.tty_kref_get" title="tty_kref_get"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_get()</span></code></a> and <a class="reference internal" href="#c.tty_kref_put" title="tty_kref_put"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_kref_put()</span></code></a>, reaching zero
frees the structure</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt>
<dd>class device or <code class="docutils literal notranslate"><span class="pre">NULL</span></code> (e.g. ptys, serdev)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver</span></code></dt>
<dd><a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_driver</span></code></a> operating this tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt>
<dd><a class="reference internal" href="tty_driver.html#c.tty_operations" title="tty_operations"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_operations</span></code></a> of <strong>driver</strong> for this tty (open, close, etc.)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">index</span></code></dt>
<dd>index of this tty (e.g. to construct <strong>name</strong> like tty12)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ldisc_sem</span></code></dt>
<dd>protects line discipline changes (<strong>ldisc</strong>) – lock tty not pty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ldisc</span></code></dt>
<dd>the current line discipline for this tty (n_tty by default)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">atomic_write_lock</span></code></dt>
<dd>protects against concurrent writers, i.e. locks
<strong>write_cnt</strong>, <strong>write_buf</strong> and similar</dd>
<dt><code class="docutils literal notranslate"><span class="pre">legacy_mutex</span></code></dt>
<dd>leftover from history (BKL -&gt; BTM -&gt; <strong>legacy_mutex</strong>),
protecting several operations on this tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">throttle_mutex</span></code></dt>
<dd>protects against concurrent tty_throttle_safe() and
tty_unthrottle_safe() (but not tty_unthrottle())</dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dt>
<dd>protects <strong>termios</strong> and <strong>termios_locked</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">winsize_mutex</span></code></dt>
<dd>protects <strong>winsize</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios</span></code></dt>
<dd>termios for the current tty, copied from/to <strong>driver.termios</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">termios_locked</span></code></dt>
<dd>locked termios (by <code class="docutils literal notranslate"><span class="pre">TIOCGLCKTRMIOS</span></code> and <code class="docutils literal notranslate"><span class="pre">TIOCSLCKTRMIOS</span></code>
ioctls)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>name of the tty constructed by <a class="reference internal" href="tty_internals.html#c.tty_line_name" title="tty_line_name"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_line_name()</span></code></a> (e.g. ttyS3)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flags</span></code></dt>
<dd>bitwise OR of <code class="docutils literal notranslate"><span class="pre">TTY_THROTTLED</span></code>, <code class="docutils literal notranslate"><span class="pre">TTY_IO_ERROR</span></code>, …</dd>
<dt><code class="docutils literal notranslate"><span class="pre">count</span></code></dt>
<dd>count of open processes, reaching zero cancels all the work for
this tty and drops a <strong>kref</strong> too (but does not free this tty)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">winsize</span></code></dt>
<dd>size of the terminal “window” (cf. <strong>winsize_mutex</strong>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow</span></code></dt>
<dd>flow settings grouped together, see also <strong>flow.unused</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.lock</span></code></dt>
<dd>lock for <strong>flow</strong> members</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.stopped</span></code></dt>
<dd>tty stopped/started by <a class="reference internal" href="#c.stop_tty" title="stop_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">stop_tty()</span></code></a>/<a class="reference internal" href="#c.start_tty" title="start_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">start_tty()</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.tco_stopped</span></code></dt>
<dd>tty stopped/started by <code class="docutils literal notranslate"><span class="pre">TCOOFF</span></code>/<code class="docutils literal notranslate"><span class="pre">TCOON</span></code> ioctls (it has
precedence over <strong>flow.stopped</strong>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow.unused</span></code></dt>
<dd>alignment for Alpha, so that no members other than <strong>flow</strong>.* are
modified by the same 64b word store. The <strong>flow</strong>’s __aligned is
there for the very same reason.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl</span></code></dt>
<dd>control settings grouped together, see also <strong>ctrl.unused</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.lock</span></code></dt>
<dd>lock for <strong>ctrl</strong> members</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.pgrp</span></code></dt>
<dd>process group of this tty (setpgrp(2))</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.session</span></code></dt>
<dd>session of this tty (setsid(2)). Writes are protected by both
<strong>ctrl.lock</strong> and <strong>legacy_mutex</strong>, readers must use at least one of
them.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.pktstatus</span></code></dt>
<dd>packet mode status (bitwise OR of <code class="docutils literal notranslate"><span class="pre">TIOCPKT_</span></code> constants)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.packet</span></code></dt>
<dd>packet mode enabled</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ctrl.unused</span></code></dt>
<dd>alignment for Alpha, see <strong>flow.unused</strong> for explanation</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hw_stopped</span></code></dt>
<dd>not controlled by the tty layer, under <strong>driver</strong>’s control for CTS
handling</dd>
<dt><code class="docutils literal notranslate"><span class="pre">receive_room</span></code></dt>
<dd>bytes permitted to feed to <strong>ldisc</strong> without any being lost</dd>
<dt><code class="docutils literal notranslate"><span class="pre">flow_change</span></code></dt>
<dd>controls behavior of throttling, see tty_throttle_safe() and
tty_unthrottle_safe()</dd>
<dt><code class="docutils literal notranslate"><span class="pre">link</span></code></dt>
<dd>link to another pty (master -&gt; slave and vice versa)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fasync</span></code></dt>
<dd>state for <code class="docutils literal notranslate"><span class="pre">O_ASYNC</span></code> (for <code class="docutils literal notranslate"><span class="pre">SIGIO</span></code>); managed by fasync_helper()</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_wait</span></code></dt>
<dd>concurrent writers are waiting in this queue until they are
allowed to write</dd>
<dt><code class="docutils literal notranslate"><span class="pre">read_wait</span></code></dt>
<dd>readers wait for data in this queue</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hangup_work</span></code></dt>
<dd>normally a work to perform a hangup (do_tty_hangup()); while
freeing the tty, (re)used to <a class="reference internal" href="tty_internals.html#c.release_one_tty" title="release_one_tty"><code class="xref c c-func docutils literal notranslate"><span class="pre">release_one_tty()</span></code></a></dd>
<dt><code class="docutils literal notranslate"><span class="pre">disc_data</span></code></dt>
<dd>pointer to <strong>ldisc</strong>’s private data (e.g. to <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">driver_data</span></code></dt>
<dd>pointer to <strong>driver</strong>’s private data (e.g. <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">uart_state</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">files_lock</span></code></dt>
<dd>protects <strong>tty_files</strong> list</dd>
<dt><code class="docutils literal notranslate"><span class="pre">tty_files</span></code></dt>
<dd>list of (re)openers of this tty (i.e. linked <code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span>
<span class="pre">tty_file_private</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">closing</span></code></dt>
<dd>when set during close, n_tty processes only START &amp; STOP chars</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_buf</span></code></dt>
<dd>temporary buffer used during <a class="reference internal" href="tty_internals.html#c.tty_write" title="tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_write()</span></code></a> to copy user data to</dd>
<dt><code class="docutils literal notranslate"><span class="pre">write_cnt</span></code></dt>
<dd>count of bytes written in <a class="reference internal" href="tty_internals.html#c.tty_write" title="tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_write()</span></code></a> to <strong>write_buf</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">SAK_work</span></code></dt>
<dd>if the tty has a pending do_SAK, it is queued here</dd>
<dt><code class="docutils literal notranslate"><span class="pre">port</span></code></dt>
<dd>persistent storage for this device (i.e. <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>)</dd>
</dl>
<p><strong>Description</strong></p>
<p>All of the state associated with a tty while the tty is open. Persistent
storage for tty devices is referenced here as <strong>port</strong> and is documented in
<a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span></code></a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tty_ldisc.html" class="btn btn-neutral float-right" title="TTY Line Discipline" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tty_port.html" class="btn btn-neutral" title="TTY Port" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
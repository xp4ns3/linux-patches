

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TTY Buffer &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="TTY" href="index.html"/>
        <link rel="next" title="N_TTY" href="n_tty.html"/>
        <link rel="prev" title="TTY Line Discipline" href="tty_ldisc.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tty_driver.html">TTY Driver and TTY Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_port.html">TTY Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_struct.html">TTY Struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_ldisc.html">TTY Line Discipline</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">TTY Buffer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#flip-buffer-management">Flip Buffer Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-functions">Other Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#buffer-locking">Buffer Locking</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-functions">Internal Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="n_tty.html">N_TTY</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_internals.html">TTY Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TTY</a> &raquo;</li>
        
      <li>TTY Buffer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tty/tty_buffer.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tty-buffer">
<h1>TTY Buffer<a class="headerlink" href="#tty-buffer" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#flip-buffer-management" id="id1">Flip Buffer Management</a></li>
<li><a class="reference internal" href="#other-functions" id="id2">Other Functions</a></li>
<li><a class="reference internal" href="#buffer-locking" id="id3">Buffer Locking</a></li>
<li><a class="reference internal" href="#internal-functions" id="id4">Internal Functions</a></li>
</ul>
</div>
<p>Here, we document functions for taking care of tty buffer and their flipping.
Drivers are supposed to fill the buffer by one of those functions below and
then flip the buffer, so that the data are passed to <a class="reference internal" href="tty_ldisc.html"><span class="doc">line discipline</span></a> for further processing.</p>
<div class="section" id="flip-buffer-management">
<h2><a class="toc-backref" href="#id1">Flip Buffer Management</a><a class="headerlink" href="#flip-buffer-management" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_insert_flip_string_fixed_flag">
int <code class="descname">tty_insert_flip_string_fixed_flag</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, const unsigned char<em>&nbsp;*chars</em>, char<em>&nbsp;flag</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_insert_flip_string_fixed_flag" title="Permalink to this definition">¶</a></dt>
<dd><p>add characters to the tty buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*chars</span></code></dt>
<dd>characters</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">flag</span></code></dt>
<dd>flag value for each character</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size</dd>
</dl>
<p><strong>Description</strong></p>
<p>Queue a series of bytes to the tty buffering. All the characters passed are
marked with the supplied flag.</p>
<p><strong>Return</strong></p>
<p>the number added.</p>
<dl class="function">
<dt id="c.tty_insert_flip_string_flags">
int <code class="descname">tty_insert_flip_string_flags</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, const unsigned char<em>&nbsp;*chars</em>, const char<em>&nbsp;*flags</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_insert_flip_string_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>add characters to the tty buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*chars</span></code></dt>
<dd>characters</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*flags</span></code></dt>
<dd>flag bytes</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size</dd>
</dl>
<p><strong>Description</strong></p>
<p>Queue a series of bytes to the tty buffering. For each character the flags
array indicates the status of the character.</p>
<p><strong>Return</strong></p>
<p>the number added.</p>
<dl class="function">
<dt id="c.__tty_insert_flip_char">
int <code class="descname">__tty_insert_flip_char</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, unsigned char<em>&nbsp;ch</em>, char<em>&nbsp;flag</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__tty_insert_flip_char" title="Permalink to this definition">¶</a></dt>
<dd><p>add one character to the tty buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">ch</span></code></dt>
<dd>character</dd>
<dt><code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">flag</span></code></dt>
<dd>flag byte</dd>
</dl>
<p><strong>Description</strong></p>
<p>Queue a single byte <strong>ch</strong> to the tty buffering, with an optional flag. This is
the slow path of tty_insert_flip_char().</p>
<dl class="function">
<dt id="c.tty_prepare_flip_string">
int <code class="descname">tty_prepare_flip_string</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, unsigned char<em>&nbsp;**chars</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_prepare_flip_string" title="Permalink to this definition">¶</a></dt>
<dd><p>make room for characters</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">**chars</span></code></dt>
<dd>return pointer for character write area</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>desired size</dd>
</dl>
<p><strong>Description</strong></p>
<p>Prepare a block of space in the buffer for data.</p>
<p>This is used for drivers that need their own block copy routines into the
buffer. There is no guarantee the buffer is a DMA target!</p>
<p><strong>Return</strong></p>
<p>the length available and buffer pointer (<strong>chars</strong>) to the space which
is now allocated and accounted for as ready for normal characters.</p>
<dl class="function">
<dt id="c.tty_ldisc_receive_buf">
int <code class="descname">tty_ldisc_receive_buf</code><span class="sig-paren">(</span>struct tty_ldisc<em>&nbsp;*ld</em>, const unsigned char<em>&nbsp;*p</em>, const char<em>&nbsp;*f</em>, int<em>&nbsp;count</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_ldisc_receive_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>forward data to line discipline</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc</span> <span class="pre">*ld</span></code></dt>
<dd>line discipline to process input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*p</span></code></dt>
<dd>char buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*f</span></code></dt>
<dd><code class="docutils literal notranslate"><span class="pre">TTY_NORMAL</span></code>, <code class="docutils literal notranslate"><span class="pre">TTY_BREAK</span></code>, etc. flags buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">count</span></code></dt>
<dd>number of bytes to process</dd>
</dl>
<p><strong>Description</strong></p>
<p>Callers other than <a class="reference internal" href="#c.flush_to_ldisc" title="flush_to_ldisc"><code class="xref c c-func docutils literal notranslate"><span class="pre">flush_to_ldisc()</span></code></a> need to exclude the kworker from
concurrent use of the line discipline, see paste_selection().</p>
<p><strong>Return</strong></p>
<p>the number of bytes processed.</p>
<dl class="function">
<dt id="c.tty_flip_buffer_push">
void <code class="descname">tty_flip_buffer_push</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_flip_buffer_push" title="Permalink to this definition">¶</a></dt>
<dd><p>push terminal buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to push</dd>
</dl>
<p><strong>Description</strong></p>
<p>Queue a push of the terminal flip buffers to the line discipline. Can be
called from IRQ/atomic context.</p>
<p>In the event of the queue being busy for flipping the work will be held off
and retried later.</p>
</div>
<hr class="docutils" />
<div class="section" id="other-functions">
<h2><a class="toc-backref" href="#id2">Other Functions</a><a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_buffer_space_avail">
unsigned int <code class="descname">tty_buffer_space_avail</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_space_avail" title="Permalink to this definition">¶</a></dt>
<dd><p>return unused buffer space</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port owning the flip buffer</dd>
</dl>
<p><strong>Return</strong></p>
<p>the # of bytes which can be written by the driver without reaching
the buffer limit.</p>
<p><strong>Note</strong></p>
<p>this does not guarantee that memory is available to write the returned
# of bytes (use <a class="reference internal" href="#c.tty_prepare_flip_string" title="tty_prepare_flip_string"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_prepare_flip_string()</span></code></a> to pre-allocate if memory
guarantee is required).</p>
<dl class="function">
<dt id="c.tty_buffer_set_limit">
int <code class="descname">tty_buffer_set_limit</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, int<em>&nbsp;limit</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_set_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>change the tty buffer memory limit</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to change</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">limit</span></code></dt>
<dd>memory limit to set</dd>
</dl>
<p><strong>Description</strong></p>
<p>Change the tty buffer memory limit.</p>
<p>Must be called before the other tty buffer functions are used.</p>
</div>
<hr class="docutils" />
<div class="section" id="buffer-locking">
<h2><a class="toc-backref" href="#id3">Buffer Locking</a><a class="headerlink" href="#buffer-locking" title="Permalink to this headline">¶</a></h2>
<p>These are used only in special circumstances. Avoid them.</p>
<dl class="function">
<dt id="c.tty_buffer_lock_exclusive">
void <code class="descname">tty_buffer_lock_exclusive</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_lock_exclusive" title="Permalink to this definition">¶</a></dt>
<dd><p>gain exclusive access to buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port owning the flip buffer</dd>
</dl>
<p><strong>Description</strong></p>
<p>Guarantees safe use of the <a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_ldisc_ops.receive_buf()</span></code></a> method by excluding
the buffer work and any pending flush from using the flip buffer. Data can
continue to be added concurrently to the flip buffer from the driver side.</p>
<p>See also <a class="reference internal" href="#c.tty_buffer_unlock_exclusive" title="tty_buffer_unlock_exclusive"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_buffer_unlock_exclusive()</span></code></a>.</p>
<dl class="function">
<dt id="c.tty_buffer_unlock_exclusive">
void <code class="descname">tty_buffer_unlock_exclusive</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_unlock_exclusive" title="Permalink to this definition">¶</a></dt>
<dd><p>release exclusive access</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port owning the flip buffer</dd>
</dl>
<p><strong>Description</strong></p>
<p>The buffer work is restarted if there is data in the flip buffer.</p>
<p>See also <a class="reference internal" href="#c.tty_buffer_lock_exclusive" title="tty_buffer_lock_exclusive"><code class="xref c c-func docutils literal notranslate"><span class="pre">tty_buffer_lock_exclusive()</span></code></a>.</p>
</div>
<hr class="docutils" />
<div class="section" id="internal-functions">
<h2><a class="toc-backref" href="#id4">Internal Functions</a><a class="headerlink" href="#internal-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.tty_buffer_free_all">
void <code class="descname">tty_buffer_free_all</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_free_all" title="Permalink to this definition">¶</a></dt>
<dd><p>free buffers used by a tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to free from</dd>
</dl>
<p><strong>Description</strong></p>
<p>Remove all the buffers pending on a tty whether queued with data or in the
free ring. Must be called when the tty is no longer in use.</p>
<dl class="function">
<dt id="c.tty_buffer_alloc">
struct tty_buffer * <code class="descname">tty_buffer_alloc</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, size_t<em>&nbsp;size</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_alloc" title="Permalink to this definition">¶</a></dt>
<dd><p>allocate a tty buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>desired size (characters)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Allocate a new tty buffer to hold the desired number of characters. We
round our buffers off in 256 character chunks to get better allocation
behaviour.</p>
<p><strong>Return</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">NULL</span></code> if out of memory or the allocation would exceed the per
device queue.</p>
<dl class="function">
<dt id="c.tty_buffer_free">
void <code class="descname">tty_buffer_free</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, struct tty_buffer<em>&nbsp;*b</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_free" title="Permalink to this definition">¶</a></dt>
<dd><p>free a tty buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port owning the buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_buffer</span> <span class="pre">*b</span></code></dt>
<dd>the buffer to free</dd>
</dl>
<p><strong>Description</strong></p>
<p>Free a tty buffer, or add it to the free list according to our internal
strategy.</p>
<dl class="function">
<dt id="c.tty_buffer_flush">
void <code class="descname">tty_buffer_flush</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct tty_ldisc<em>&nbsp;*ld</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_flush" title="Permalink to this definition">¶</a></dt>
<dd><p>flush full tty buffers</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty to flush</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc</span> <span class="pre">*ld</span></code></dt>
<dd>optional ldisc ptr (must be referenced)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Flush all the buffers containing receive data. If <strong>ld</strong> != <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, flush the
ldisc input buffer.</p>
<p>Locking: takes buffer lock to ensure single-threaded flip buffer ‘consumer’.</p>
<dl class="function">
<dt id="c.__tty_buffer_request_room">
int <code class="descname">__tty_buffer_request_room</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em>, size_t<em>&nbsp;size</em>, int<em>&nbsp;flags</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__tty_buffer_request_room" title="Permalink to this definition">¶</a></dt>
<dd><p>grow tty buffer if needed</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">size</span></code></dt>
<dd>size desired</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flags</span></code></dt>
<dd>buffer flags if new buffer allocated (default = 0)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Make at least <strong>size</strong> bytes of linear space available for the tty buffer.</p>
<p>Will change over to a new buffer if the current buffer is encoded as
<code class="docutils literal notranslate"><span class="pre">TTY_NORMAL</span></code> (so has no flags buffer) and the new buffer requires a flags
buffer.</p>
<p><strong>Return</strong></p>
<p>the size we managed to find.</p>
<dl class="function">
<dt id="c.flush_to_ldisc">
void <code class="descname">flush_to_ldisc</code><span class="sig-paren">(</span>struct work_struct<em>&nbsp;*work</em><span class="sig-paren">)</span><a class="headerlink" href="#c.flush_to_ldisc" title="Permalink to this definition">¶</a></dt>
<dd><p>flush data from buffer to ldisc</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">work_struct</span> <span class="pre">*work</span></code></dt>
<dd>tty structure passed from work queue.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This routine is called out of the software interrupt to flush data from the
buffer chain to the line discipline.</p>
<p>The receive_buf() method is single threaded for each tty instance.</p>
<p>Locking: takes buffer lock to ensure single-threaded flip buffer ‘consumer’.</p>
<dl class="function">
<dt id="c.tty_buffer_init">
void <code class="descname">tty_buffer_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_port.html#c.tty_port" title="tty_port">tty_port</a><em>&nbsp;*port</em><span class="sig-paren">)</span><a class="headerlink" href="#c.tty_buffer_init" title="Permalink to this definition">¶</a></dt>
<dd><p>prepare a tty buffer structure</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_port</span> <span class="pre">*port</span></code></dt>
<dd>tty port to initialise</dd>
</dl>
<p><strong>Description</strong></p>
<p>Set up the initial state of the buffer management for a tty device. Must be
called before the other tty buffer functions are used.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="n_tty.html" class="btn btn-neutral float-right" title="N_TTY" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tty_ldisc.html" class="btn btn-neutral" title="TTY Line Discipline" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>N_TTY &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="TTY" href="index.html"/>
        <link rel="next" title="TTY Internals" href="tty_internals.html"/>
        <link rel="prev" title="TTY Buffer" href="tty_buffer.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">TTY</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#tty-structures">TTY structures</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="tty_driver.html">TTY Driver and TTY Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_port.html">TTY Port</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_struct.html">TTY Struct</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_ldisc.html">TTY Line Discipline</a></li>
<li class="toctree-l3"><a class="reference internal" href="tty_buffer.html">TTY Buffer</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">N_TTY</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#external-functions">External Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-functions">Internal Functions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tty_internals.html">TTY Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#writing-tty-driver">Writing TTY Driver</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">TTY</a> &raquo;</li>
        
      <li>N_TTY</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tty/n_tty.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="n-tty">
<h1>N_TTY<a class="headerlink" href="#n-tty" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#external-functions" id="id1">External Functions</a></li>
<li><a class="reference internal" href="#internal-functions" id="id2">Internal Functions</a></li>
</ul>
</div>
<p>The default (and fallback) <a class="reference internal" href="tty_ldisc.html"><span class="doc">TTY line discipline</span></a>. It tries to
handle characters as per POSIX.</p>
<div class="section" id="external-functions">
<h2><a class="toc-backref" href="#id1">External Functions</a><a class="headerlink" href="#external-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.n_tty_inherit_ops">
void <code class="descname">n_tty_inherit_ops</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops">tty_ldisc_ops</a><em>&nbsp;*ops</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_inherit_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>inherit N_TTY methods</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span> <span class="pre">*ops</span></code></dt>
<dd><p class="first"><a class="reference internal" href="tty_ldisc.html#c.tty_ldisc_ops" title="tty_ldisc_ops"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_ldisc_ops</span></code></a> where to save N_TTY methods</p>
<p class="last">Enables a ‘subclass’ line discipline to ‘inherit’ N_TTY methods.</p>
</dd>
</dl>
</div>
<div class="section" id="internal-functions">
<h2><a class="toc-backref" href="#id2">Internal Functions</a><a class="headerlink" href="#internal-functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="c.n_tty_kick_worker">
void <code class="descname">n_tty_kick_worker</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_kick_worker" title="Permalink to this definition">¶</a></dt>
<dd><p>start input worker (if required)</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
</dl>
<p><strong>Description</strong></p>
<p>Re-schedules the flip buffer work if it may have stopped.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>Caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</li>
<li><dl class="first docutils">
<dt>n_tty_read()/consumer path:</dt>
<dd>holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dd>
</dl>
</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_write_wakeup">
void <code class="descname">n_tty_write_wakeup</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write_wakeup" title="Permalink to this definition">¶</a></dt>
<dd><p>asynchronous I/O notifier</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Required for the ptys, serial driver etc. since processes that attach
themselves to the master and rely on ASYNC IO must be woken up.</p>
<dl class="function">
<dt id="c.put_tty_queue">
void <code class="descname">put_tty_queue</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.put_tty_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>add character to tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character to the tty read_buf queue.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li><dl class="first docutils">
<dt>n_tty_receive_buf()/producer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dd>
</dl>
</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="c.reset_buffer_flags">
void <code class="descname">reset_buffer_flags</code><span class="sig-paren">(</span>struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.reset_buffer_flags" title="Permalink to this definition">¶</a></dt>
<dd><p>reset buffer state</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>line disc data to reset</dd>
</dl>
<p><strong>Description</strong></p>
<p>Reset the read buffer counters and clear the flags. Called from
<a class="reference internal" href="#c.n_tty_open" title="n_tty_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_open()</span></code></a> and <a class="reference internal" href="#c.n_tty_flush_buffer" title="n_tty_flush_buffer"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_flush_buffer()</span></code></a>.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>caller holds exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>, or</li>
<li>(locking is not required)</li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_flush_buffer">
void <code class="descname">n_tty_flush_buffer</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_flush_buffer" title="Permalink to this definition">¶</a></dt>
<dd><p>clean input queue</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Flush the input buffer. Called when the tty layer wants the buffer flushed
(eg at hangup) or when the <code class="docutils literal notranslate"><span class="pre">N_TTY</span></code> line discipline internally has to clean
the pending queue (for example some signals).</p>
<p>Holds <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> to exclude producer/consumer while buffer indices are
reset.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock, exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></p>
<dl class="function">
<dt id="c.is_utf8_continuation">
int <code class="descname">is_utf8_continuation</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.is_utf8_continuation" title="Permalink to this definition">¶</a></dt>
<dd><p>utf8 multibyte check</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>byte to check</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation
character. We use this to correctly compute the on-screen size of the
character when printing.</p>
<dl class="function">
<dt id="c.is_continuation">
int <code class="descname">is_continuation</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.is_continuation" title="Permalink to this definition">¶</a></dt>
<dd><p>multibyte check</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>byte to check</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if the utf8 character <strong>c</strong> is a multibyte continuation character
and the terminal is in unicode mode.</p>
<dl class="function">
<dt id="c.do_output_char">
int <code class="descname">do_output_char</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, int<em>&nbsp;space</em><span class="sig-paren">)</span><a class="headerlink" href="#c.do_output_char" title="Permalink to this definition">¶</a></dt>
<dd><p>output one character</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character (or partial unicode symbol)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">space</span></code></dt>
<dd>space available in tty driver write buffer</dd>
</dl>
<p><strong>Description</strong></p>
<p>This is a helper function that handles one output character (including
special characters like TAB, CR, LF, etc.), doing OPOST processing and
putting the results in the tty driver’s write buffer.</p>
<p>Note that Linux currently ignores TABDLY, CRDLY, VTDLY, FFDLY and NLDLY.
They simply aren’t relevant in the world today. If you ever need them, add
them here.</p>
<p>Locking: should be called under the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect the column state
and space left in the buffer.</p>
<p><strong>Return</strong></p>
<p>the number of bytes of buffer space used or -1 if no space left.</p>
<dl class="function">
<dt id="c.process_output">
int <code class="descname">process_output</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output" title="Permalink to this definition">¶</a></dt>
<dd><p>output post processor</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character (or partial unicode symbol)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output one character with OPOST processing.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>-1 when the output device is full and the character must be
retried.</p>
<dl class="function">
<dt id="c.process_output_block">
ssize_t <code class="descname">process_output_block</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, const unsigned char<em>&nbsp;*buf</em>, unsigned int<em>&nbsp;nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.process_output_block" title="Permalink to this definition">¶</a></dt>
<dd><p>block post processor</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*buf</span></code></dt>
<dd>character buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">nr</span></code></dt>
<dd>number of bytes to output</dd>
</dl>
<p><strong>Description</strong></p>
<p>Output a block of characters with OPOST processing.</p>
<p>This path is used to speed up block console writes, among other things when
processing blocks of output data. It handles only the simple cases normally
found and helps to generate blocks of symbols for the console driver and
thus improve performance.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> to protect column state and space left (also, this is
called from <a class="reference internal" href="#c.n_tty_write" title="n_tty_write"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_write()</span></code></a> under the tty layer write lock).</p>
<p><strong>Return</strong></p>
<p>the number of characters output.</p>
<dl class="function">
<dt id="c.__process_echoes">
size_t <code class="descname">__process_echoes</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.__process_echoes" title="Permalink to this definition">¶</a></dt>
<dd><p>write pending echo characters</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write previously buffered echo (and other ldisc-generated) characters to the
tty.</p>
<p>Characters generated by the ldisc (including echoes) need to be buffered
because the driver’s write buffer can fill during heavy program output.
Echoing straight to the driver will often fail under these conditions,
causing lost characters and resulting mismatches of ldisc state information.</p>
<p>Since the ldisc state must represent the characters actually sent to the
driver at the time of the write, operations like certain changes in column
state are also saved in the buffer and executed here.</p>
<p>A circular fifo buffer is used so that the most recent characters are
prioritized. Also, when control characters are echoed with a prefixed “^”,
the pair is treated atomically and thus not separated.</p>
<p>Locking: callers must hold <code class="docutils literal notranslate"><span class="pre">output_lock</span></code>.</p>
<dl class="function">
<dt id="c.add_echo_byte">
void <code class="descname">add_echo_byte</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.add_echo_byte" title="Permalink to this definition">¶</a></dt>
<dd><p>add a byte to the echo buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>unicode byte to echo</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add a character or operation byte to the echo buffer.</p>
<dl class="function">
<dt id="c.echo_move_back_col">
void <code class="descname">echo_move_back_col</code><span class="sig-paren">(</span>struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_move_back_col" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to move back a column</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to move back one column.</p>
<dl class="function">
<dt id="c.echo_set_canon_col">
void <code class="descname">echo_set_canon_col</code><span class="sig-paren">(</span>struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_set_canon_col" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to set the canon column</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to set the canon column to the current
column.</p>
<dl class="function">
<dt id="c.echo_erase_tab">
void <code class="descname">echo_erase_tab</code><span class="sig-paren">(</span>unsigned int<em>&nbsp;num_chars</em>, int<em>&nbsp;after_tab</em>, struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_erase_tab" title="Permalink to this definition">¶</a></dt>
<dd><p>add operation to erase a tab</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">num_chars</span></code></dt>
<dd>number of character columns already used</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">after_tab</span></code></dt>
<dd>true if num_chars starts after a previous tab</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add an operation to the echo buffer to erase a tab.</p>
<p>Called by the eraser function, which knows how many character columns have
been used since either a previous tab or the start of input. This
information will be used later, along with canon column (if applicable), to
go back the correct number of columns.</p>
<dl class="function">
<dt id="c.echo_char_raw">
void <code class="descname">echo_char_raw</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char_raw" title="Permalink to this definition">¶</a></dt>
<dd><p>echo a character raw</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>unicode byte to echo</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>line disc data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant does not treat control characters specially.</p>
<dl class="function">
<dt id="c.echo_char">
void <code class="descname">echo_char</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.echo_char" title="Permalink to this definition">¶</a></dt>
<dd><p>echo a character</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>unicode byte to echo</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Echo user input back onto the screen. This must be called only when
L_ECHO(tty) is true. Called from the <a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path.</p>
<p>This variant tags control characters to be echoed as “^X” (where X is the
letter representing the control char).</p>
<dl class="function">
<dt id="c.finish_erasing">
void <code class="descname">finish_erasing</code><span class="sig-paren">(</span>struct n_tty_data<em>&nbsp;*ldata</em><span class="sig-paren">)</span><a class="headerlink" href="#c.finish_erasing" title="Permalink to this definition">¶</a></dt>
<dd><p>complete erase</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">n_tty_data</span> <span class="pre">*ldata</span></code></dt>
<dd>n_tty data</dd>
</dl>
<dl class="function">
<dt id="c.eraser">
void <code class="descname">eraser</code><span class="sig-paren">(</span>unsigned char<em>&nbsp;c</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.eraser" title="Permalink to this definition">¶</a></dt>
<dd><p>handle erase function</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform erase and necessary output when an erase character is present in the
stream from the driver layer. Handles the complexities of UTF-8 multibyte
symbols.</p>
<dl class="docutils">
<dt>Locking: n_tty_receive_buf()/producer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dd>
</dl>
<dl class="function">
<dt id="c.isig">
void <code class="descname">isig</code><span class="sig-paren">(</span>int<em>&nbsp;sig</em>, struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.isig" title="Permalink to this definition">¶</a></dt>
<dd><p>handle the ISIG optio</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">sig</span></code></dt>
<dd>signal</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when a signal is being sent due to terminal input. Called from the
<a class="reference internal" href="tty_driver.html#c.tty_driver" title="tty_driver"><code class="xref c c-type docutils literal notranslate"><span class="pre">tty_driver.receive_buf()</span></code></a> path, so serialized.</p>
<p>Performs input and output flush if !NOFLSH. In this context, the echo
buffer is ‘output’. The signal is processed first to alert any current
readers or writers to discontinue and exit their i/o loops.</p>
<p>Locking: <code class="docutils literal notranslate"><span class="pre">ctrl</span></code>.lock</p>
<dl class="function">
<dt id="c.n_tty_receive_break">
void <code class="descname">n_tty_receive_break</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_break" title="Permalink to this definition">¶</a></dt>
<dd><p>handle break</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
</dl>
<p><strong>Description</strong></p>
<p>An RS232 break event has been hit in the incoming bitstream. This can cause
a variety of events depending upon the termios settings.</p>
<dl class="docutils">
<dt>Locking: n_tty_receive_buf()/producer path:</dt>
<dd>caller holds non-exclusive termios_rwsem</dd>
</dl>
<p><strong>Note</strong></p>
<p>may get exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code> if flushing input buffer</p>
<dl class="function">
<dt id="c.n_tty_receive_overrun">
void <code class="descname">n_tty_receive_overrun</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_overrun" title="Permalink to this definition">¶</a></dt>
<dd><p>handle overrun reporting</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
</dl>
<p><strong>Description</strong></p>
<p>Data arrived faster than we could process it. While the tty driver has
flagged this the bits that were missed are gone forever.</p>
<p>Called from the receive_buf path so single threaded. Does not need locking
as num_overrun and overrun_time are function private.</p>
<dl class="function">
<dt id="c.n_tty_receive_parity_error">
void <code class="descname">n_tty_receive_parity_error</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned char<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_parity_error" title="Permalink to this definition">¶</a></dt>
<dd><p>error notifier</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process a parity error and queue the right data to indicate the error case
if necessary.</p>
<dl class="docutils">
<dt>Locking: n_tty_receive_buf()/producer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code></dd>
</dl>
<dl class="function">
<dt id="c.n_tty_receive_char">
void <code class="descname">n_tty_receive_char</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned char<em>&nbsp;c</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_char" title="Permalink to this definition">¶</a></dt>
<dd><p>perform processing</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">c</span></code></dt>
<dd>character</dd>
</dl>
<p><strong>Description</strong></p>
<p>Process an individual character of input received from the driver.  This is
serialized with respect to itself by the rules for the driver above.</p>
<dl class="docutils">
<dt>Locking: n_tty_receive_buf()/producer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes canon_head if canonical mode is active</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_receive_buf_common">
int <code class="descname">n_tty_receive_buf_common</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, const unsigned char<em>&nbsp;*cp</em>, const char<em>&nbsp;*fp</em>, int<em>&nbsp;count</em>, int<em>&nbsp;flow</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_receive_buf_common" title="Permalink to this definition">¶</a></dt>
<dd><p>process input</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>device to receive input</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*cp</span></code></dt>
<dd>input chars</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*fp</span></code></dt>
<dd>flags for each char (if <code class="docutils literal notranslate"><span class="pre">NULL</span></code>, all chars are <code class="docutils literal notranslate"><span class="pre">TTY_NORMAL</span></code>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">count</span></code></dt>
<dd>number of input chars in <strong>cp</strong></dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">flow</span></code></dt>
<dd>enable flow control</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the terminal driver when a block of characters has been received.
This function must be called from soft contexts not from interrupt context.
The driver is responsible for making calls one at a time and in order (or
using <a class="reference internal" href="tty_buffer.html#c.flush_to_ldisc" title="flush_to_ldisc"><code class="xref c c-func docutils literal notranslate"><span class="pre">flush_to_ldisc()</span></code></a>).</p>
<p>In canonical mode, the maximum line length is 4096 chars (including the line
termination char); lines longer than 4096 chars are truncated. After 4095
chars, input data is still processed but not stored. Overflow processing
ensures the tty can always receive more input until at least one line can be
read.</p>
<p>In non-canonical mode, the read buffer will only accept 4095 chars; this
provides the necessary space for a newline char if the input mode is
switched to canonical.</p>
<p>Note it is possible for the read buffer to _contain_ 4096 chars in
non-canonical mode: the read buffer could already contain the maximum canon
line of 4096 chars when the mode is switched to non-canonical.</p>
<dl class="docutils">
<dt>Locking: n_tty_receive_buf()/producer path:</dt>
<dd>claims non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>
publishes commit_head or canon_head</dd>
</dl>
<p><strong>Return</strong></p>
<p>the # of input chars from <strong>cp</strong> which were processed.</p>
<dl class="function">
<dt id="c.n_tty_set_termios">
void <code class="descname">n_tty_set_termios</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct ktermios<em>&nbsp;*old</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_set_termios" title="Permalink to this definition">¶</a></dt>
<dd><p>termios data changed</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">ktermios</span> <span class="pre">*old</span></code></dt>
<dd>previous data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called by the tty layer when the user changes termios flags so that the line
discipline can plan ahead. This function cannot sleep and is protected from
re-entry by the tty layer. The user is guaranteed that this function will
not be re-entered or in progress when the ldisc is closed.</p>
<p>Locking: Caller holds <strong>tty-&gt;termios_rwsem</strong></p>
<dl class="function">
<dt id="c.n_tty_close">
void <code class="descname">n_tty_close</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_close" title="Permalink to this definition">¶</a></dt>
<dd><p>close the ldisc for this tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called from the terminal layer when this line discipline is being shut down,
either because of a close or becsuse of a discipline change. The function
will not be called while other ldisc methods are in progress.</p>
<dl class="function">
<dt id="c.n_tty_open">
int <code class="descname">n_tty_open</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_open" title="Permalink to this definition">¶</a></dt>
<dd><p>open an ldisc</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal to open</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when this line discipline is being attached to the terminal device.
Can sleep. Called serialized so that no other events will occur in parallel.
No further open will occur until a close.</p>
<dl class="function">
<dt id="c.copy_from_read_buf">
bool <code class="descname">copy_from_read_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned char<em>&nbsp;**kbp</em>, size_t<em>&nbsp;*nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.copy_from_read_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>copy read data directly</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">**kbp</span></code></dt>
<dd>data</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt>
<dd>size of data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function to speed up <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is
off; it copies characters straight from the tty queue.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>called under the <strong>ldata-&gt;atomic_read_lock</strong> sem</li>
<li><dl class="first docutils">
<dt>n_tty_read()/consumer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Return</strong></p>
<p>true if it successfully copied data, but there is still more data
to be had.</p>
<dl class="function">
<dt id="c.canon_copy_from_read_buf">
bool <code class="descname">canon_copy_from_read_buf</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, unsigned char<em>&nbsp;**kbp</em>, size_t<em>&nbsp;*nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.canon_copy_from_read_buf" title="Permalink to this definition">¶</a></dt>
<dd><p>copy read data in canonical mode</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">**kbp</span></code></dt>
<dd>data</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">*nr</span></code></dt>
<dd>size of data</dd>
</dl>
<p><strong>Description</strong></p>
<p>Helper function for <a class="reference internal" href="#c.n_tty_read" title="n_tty_read"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_read()</span></code></a>. It is only called when <code class="docutils literal notranslate"><span class="pre">ICANON</span></code> is on; it
copies one line of input up to and including the line-delimiting character
into the result buffer.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>called under the <code class="docutils literal notranslate"><span class="pre">atomic_read_lock</span></code> mutex</li>
<li><dl class="first docutils">
<dt>n_tty_read()/consumer path:</dt>
<dd>caller holds non-exclusive <code class="docutils literal notranslate"><span class="pre">termios_rwsem</span></code>;
read_tail published</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p><strong>Note</strong></p>
<p>When termios is changed from non-canonical to canonical mode and the
read buffer contains data, <a class="reference internal" href="#c.n_tty_set_termios" title="n_tty_set_termios"><code class="xref c c-func docutils literal notranslate"><span class="pre">n_tty_set_termios()</span></code></a> simulates an EOF push (as if
C-d were input) _without_ the <code class="docutils literal notranslate"><span class="pre">DISABLED_CHAR</span></code> in the buffer. This causes data
already processed as input to be immediately available as input although a
newline has not been received.</p>
<dl class="function">
<dt id="c.job_control">
int <code class="descname">job_control</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*file</em><span class="sig-paren">)</span><a class="headerlink" href="#c.job_control" title="Permalink to this definition">¶</a></dt>
<dd><p>check job control</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>file handle</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform job control management checks on this <strong>file</strong>/<strong>tty</strong> descriptor and if
appropriate send any needed signals and return a negative error code if
action should be taken.</p>
<dl class="docutils">
<dt>Locking:</dt>
<dd><ul class="first last simple">
<li>redirected write test is safe</li>
<li>current-&gt;signal-&gt;tty check is safe</li>
<li>ctrl.lock to safely reference <strong>tty-&gt;ctrl.pgrp</strong></li>
</ul>
</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_read">
ssize_t <code class="descname">n_tty_read</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*file</em>, unsigned char<em>&nbsp;*kbuf</em>, size_t<em>&nbsp;nr</em>, void<em>&nbsp;**cookie</em>, unsigned long<em>&nbsp;offset</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_read" title="Permalink to this definition">¶</a></dt>
<dd><p>read function for tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>file object</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*kbuf</span></code></dt>
<dd>kernelspace buffer pointer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt>
<dd>size of I/O</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">**cookie</span></code></dt>
<dd>if non-<code class="docutils literal notranslate"><span class="pre">NULL</span></code>, this is a continuation read</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">offset</span></code></dt>
<dd>where to continue reading from (unused in n_tty)</dd>
</dl>
<p><strong>Description</strong></p>
<p>Perform reads for the line discipline. We are guaranteed that the line
discipline will not be closed under us but we may get multiple parallel
readers and must handle this ourselves. We may also get a hangup. Always
called in user context, may sleep.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="docutils">
<dt>Locking: n_tty_read()/consumer path:</dt>
<dd>claims non-exclusive termios_rwsem;
publishes read_tail</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_write">
ssize_t <code class="descname">n_tty_write</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*file</em>, const unsigned char<em>&nbsp;*buf</em>, size_t<em>&nbsp;nr</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_write" title="Permalink to this definition">¶</a></dt>
<dd><p>write function for tty</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>tty device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>file object</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">*buf</span></code></dt>
<dd>userspace buffer pointer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">size_t</span> <span class="pre">nr</span></code></dt>
<dd>size of I/O</dd>
</dl>
<p><strong>Description</strong></p>
<p>Write function of the terminal device. This is serialized with respect to
other write callers but not to termios changes, reads and other such events.
Since the receive code will echo characters, thus calling driver write
methods, the <code class="docutils literal notranslate"><span class="pre">output_lock</span></code> is used in the output processing functions called
here as well as in the echo processing function to protect the column state
and space left in the buffer.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<dl class="docutils">
<dt>Locking: output_lock to protect column state and space left</dt>
<dd>(note that the process_output*() functions take this lock themselves)</dd>
</dl>
<dl class="function">
<dt id="c.n_tty_poll">
__poll_t <code class="descname">n_tty_poll</code><span class="sig-paren">(</span>struct <a class="reference internal" href="tty_struct.html#c.tty_struct" title="tty_struct">tty_struct</a><em>&nbsp;*tty</em>, struct file<em>&nbsp;*file</em>, poll_table<em>&nbsp;*wait</em><span class="sig-paren">)</span><a class="headerlink" href="#c.n_tty_poll" title="Permalink to this definition">¶</a></dt>
<dd><p>poll method for N_TTY</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">tty_struct</span> <span class="pre">*tty</span></code></dt>
<dd>terminal device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">file</span> <span class="pre">*file</span></code></dt>
<dd>file accessing it</dd>
<dt><code class="docutils literal notranslate"><span class="pre">poll_table</span> <span class="pre">*wait</span></code></dt>
<dd>poll table</dd>
</dl>
<p><strong>Description</strong></p>
<p>Called when the line discipline is asked to poll() for data or for special
events. This code is not serialized with respect to other events save
open/close.</p>
<p>This code must be sure never to sleep through a hangup.</p>
<p>Locking: called without the kernel lock held – fine.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tty_internals.html" class="btn btn-neutral float-right" title="TTY Internals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tty_buffer.html" class="btn btn-neutral" title="TTY Buffer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
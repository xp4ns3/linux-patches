

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Kernel clients &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Linux GPU Driver Developer’s Guide" href="index.html"/>
        <link rel="next" title="GPU Driver Documentation" href="drivers.html"/>
        <link rel="prev" title="DRM Driver uAPI" href="driver-uapi.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux GPU Driver Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-internals.html">DRM Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-mm.html">DRM Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms.html">Kernel Mode Setting (KMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms-helpers.html">Mode Setting Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-uapi.html">Userland interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="driver-uapi.html">DRM Driver uAPI</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Kernel clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">GPU Driver Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="backlight.html">Backlight support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-switcheroo.html">VGA Switcheroo</a></li>
<li class="toctree-l2"><a class="reference internal" href="vgaarbiter.html">VGA Arbiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="todo.html">TODO list</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc/index.html">GPU RFC Section</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Linux GPU Driver Developer’s Guide</a> &raquo;</li>
        
      <li>Kernel clients</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gpu/drm-client.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="kernel-clients">
<h1>Kernel clients<a class="headerlink" href="#kernel-clients" title="Permalink to this headline">¶</a></h1>
<p>This library provides support for clients running in the kernel like fbdev and bootsplash.</p>
<p>GEM drivers which provide a GEM based dumb buffer with a virtual address are supported.</p>
<dl class="type">
<dt id="c.drm_client_funcs">
struct <code class="descname">drm_client_funcs</code><a class="headerlink" href="#c.drm_client_funcs" title="Permalink to this definition">¶</a></dt>
<dd><p>DRM client callbacks</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct drm_client_funcs {
  struct module *owner;
  void (*unregister)(struct drm_client_dev *client);
  int (*restore)(struct drm_client_dev *client);
  int (*hotplug)(struct drm_client_dev *client);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">owner</span></code></dt>
<dd>The module owner</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unregister</span></code></dt>
<dd><p class="first">Called when <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_device</span></code></a> is unregistered. The client should respond by
releasing its resources using <a class="reference internal" href="#c.drm_client_release" title="drm_client_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_release()</span></code></a>.</p>
<p class="last">This callback is optional.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">restore</span></code></dt>
<dd><p class="first">Called on drm_lastclose(). The first client instance in the list that
returns zero gets the privilege to restore and no more clients are
called. This callback is not called after <strong>unregister</strong> has been called.</p>
<p>Note that the core does not guarantee exclusion against concurrent
<a class="reference internal" href="drm-internals.html#c.drm_open" title="drm_open"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_open()</span></code></a>. Clients need to ensure this themselves, for example by
using drm_master_internal_acquire() and
drm_master_internal_release().</p>
<p class="last">This callback is optional.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hotplug</span></code></dt>
<dd><p class="first">Called on <a class="reference internal" href="drm-kms-helpers.html#c.drm_kms_helper_hotplug_event" title="drm_kms_helper_hotplug_event"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_kms_helper_hotplug_event()</span></code></a>.
This callback is not called after <strong>unregister</strong> has been called.</p>
<p class="last">This callback is optional.</p>
</dd>
</dl>
<dl class="type">
<dt id="c.drm_client_dev">
struct <code class="descname">drm_client_dev</code><a class="headerlink" href="#c.drm_client_dev" title="Permalink to this definition">¶</a></dt>
<dd><p>DRM client instance</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct drm_client_dev {
  struct drm_device *dev;
  const char *name;
  struct list_head list;
  const struct drm_client_funcs *funcs;
  struct drm_file *file;
  struct mutex modeset_mutex;
  struct drm_mode_set *modesets;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt>
<dd>DRM device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt>
<dd>Name of the client.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">list</span></code></dt>
<dd>List of all clients of a DRM device, linked into
<a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_device.clientlist</span></code></a>. Protected by <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_device.clientlist_mutex</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">funcs</span></code></dt>
<dd>DRM client functions (optional)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">file</span></code></dt>
<dd>DRM file</dd>
<dt><code class="docutils literal notranslate"><span class="pre">modeset_mutex</span></code></dt>
<dd>Protects <strong>modesets</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">modesets</span></code></dt>
<dd>CRTC configurations</dd>
</dl>
<dl class="type">
<dt id="c.drm_client_buffer">
struct <code class="descname">drm_client_buffer</code><a class="headerlink" href="#c.drm_client_buffer" title="Permalink to this definition">¶</a></dt>
<dd><p>DRM client buffer</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct drm_client_buffer {
  struct drm_client_dev *client;
  u32 handle;
  u32 pitch;
  struct drm_gem_object *gem;
  struct iosys_map map;
  struct drm_framebuffer *fb;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">client</span></code></dt>
<dd>DRM client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">handle</span></code></dt>
<dd>Buffer handle</dd>
<dt><code class="docutils literal notranslate"><span class="pre">pitch</span></code></dt>
<dd>Buffer pitch</dd>
<dt><code class="docutils literal notranslate"><span class="pre">gem</span></code></dt>
<dd>GEM object backing this buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">map</span></code></dt>
<dd>Virtual address for the buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fb</span></code></dt>
<dd>DRM framebuffer</dd>
</dl>
<dl class="function">
<dt id="c.drm_client_for_each_modeset">
<code class="descname">drm_client_for_each_modeset</code><span class="sig-paren">(</span><em>modeset</em>, <em>client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_for_each_modeset" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over client modesets</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">modeset</span></code></dt>
<dd><a class="reference internal" href="drm-kms.html#c.drm_mode_set" title="drm_mode_set"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_mode_set</span></code></a> loop cursor</dd>
<dt><code class="docutils literal notranslate"><span class="pre">client</span></code></dt>
<dd>DRM client</dd>
</dl>
<dl class="function">
<dt id="c.drm_client_for_each_connector_iter">
<code class="descname">drm_client_for_each_connector_iter</code><span class="sig-paren">(</span><em>connector</em>, <em>iter</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_for_each_connector_iter" title="Permalink to this definition">¶</a></dt>
<dd><p>connector_list iterator macro</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">connector</span></code></dt>
<dd><a class="reference internal" href="drm-kms.html#c.drm_connector" title="drm_connector"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_connector</span></code></a> pointer used as cursor</dd>
<dt><code class="docutils literal notranslate"><span class="pre">iter</span></code></dt>
<dd><a class="reference internal" href="drm-kms.html#c.drm_connector_list_iter" title="drm_connector_list_iter"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_connector_list_iter</span></code></a></dd>
</dl>
<p><strong>Description</strong></p>
<p>This iterates the connectors that are useable for internal clients (excludes
writeback connectors).</p>
<p>For more info see <a class="reference internal" href="drm-kms.html#c.drm_for_each_connector_iter" title="drm_for_each_connector_iter"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_for_each_connector_iter()</span></code></a>.</p>
<dl class="function">
<dt id="c.drm_client_init">
int <code class="descname">drm_client_init</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device">drm_device</a><em>&nbsp;*dev</em>, struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em>, const char<em>&nbsp;*name</em>, const struct <a class="reference internal" href="#c.drm_client_funcs" title="drm_client_funcs">drm_client_funcs</a><em>&nbsp;*funcs</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialise a DRM client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*dev</span></code></dt>
<dd>DRM device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name</span></code></dt>
<dd>Client name</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">drm_client_funcs</span> <span class="pre">*funcs</span></code></dt>
<dd>DRM client functions (optional)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This initialises the client and opens a <a class="reference internal" href="drm-internals.html#c.drm_file" title="drm_file"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_file</span></code></a>.
Use <a class="reference internal" href="#c.drm_client_register" title="drm_client_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_register()</span></code></a> to complete the process.
The caller needs to hold a reference on <strong>dev</strong> before calling this function.
The client is freed when the <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_device</span></code></a> is unregistered. See <a class="reference internal" href="#c.drm_client_release" title="drm_client_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_release()</span></code></a>.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_register">
void <code class="descname">drm_client_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register client</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
</dl>
<p><strong>Description</strong></p>
<p>Add the client to the <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_device</span></code></a> client list to activate its callbacks.
<strong>client</strong> must be initialized by a call to <a class="reference internal" href="#c.drm_client_init" title="drm_client_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_init()</span></code></a>. After
<a class="reference internal" href="#c.drm_client_register" title="drm_client_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_register()</span></code></a> it is no longer permissible to call <a class="reference internal" href="#c.drm_client_release" title="drm_client_release"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_release()</span></code></a>
directly (outside the unregister callback), instead cleanup will happen
automatically on driver unload.</p>
<dl class="function">
<dt id="c.drm_client_release">
void <code class="descname">drm_client_release</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_release" title="Permalink to this definition">¶</a></dt>
<dd><p>Release DRM client resources</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
</dl>
<p><strong>Description</strong></p>
<p>Releases resources by closing the <a class="reference internal" href="drm-internals.html#c.drm_file" title="drm_file"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_file</span></code></a> that was opened by <a class="reference internal" href="#c.drm_client_init" title="drm_client_init"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_init()</span></code></a>.
It is called automatically if the <a class="reference internal" href="#c.drm_client_funcs" title="drm_client_funcs"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_client_funcs.unregister</span></code></a> callback is _not_ set.</p>
<p>This function should only be called from the unregister callback. An exception
is fbdev which cannot free the buffer if userspace has open file descriptors.</p>
<p><strong>Note</strong></p>
<p>Clients cannot initiate a release by themselves. This is done to keep the code simple.
The driver has to be unloaded before the client can be unloaded.</p>
<dl class="function">
<dt id="c.drm_client_dev_hotplug">
void <code class="descname">drm_client_dev_hotplug</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-internals.html#c.drm_device" title="drm_device">drm_device</a><em>&nbsp;*dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_dev_hotplug" title="Permalink to this definition">¶</a></dt>
<dd><p>Send hotplug event to clients</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_device</span> <span class="pre">*dev</span></code></dt>
<dd>DRM device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function calls the <a class="reference internal" href="#c.drm_client_funcs" title="drm_client_funcs"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_client_funcs.hotplug</span></code></a> callback on the attached clients.</p>
<p><a class="reference internal" href="drm-kms-helpers.html#c.drm_kms_helper_hotplug_event" title="drm_kms_helper_hotplug_event"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_kms_helper_hotplug_event()</span></code></a> calls this function, so drivers that use it
don’t need to call this function themselves.</p>
<dl class="function">
<dt id="c.drm_client_buffer_vmap">
int <code class="descname">drm_client_buffer_vmap</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer">drm_client_buffer</a><em>&nbsp;*buffer</em>, struct <a class="reference internal" href="../driver-api/device-io.html#c.iosys_map" title="iosys_map">iosys_map</a><em>&nbsp;*map_copy</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_buffer_vmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Map DRM client buffer into address space</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_buffer</span> <span class="pre">*buffer</span></code></dt>
<dd>DRM client buffer</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">iosys_map</span> <span class="pre">*map_copy</span></code></dt>
<dd>Returns the mapped memory’s address</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function maps a client buffer into kernel address space. If the
buffer is already mapped, it returns the existing mapping’s address.</p>
<p>Client buffer mappings are not ref’counted. Each call to
<a class="reference internal" href="#c.drm_client_buffer_vmap" title="drm_client_buffer_vmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_buffer_vmap()</span></code></a> should be followed by a call to
<a class="reference internal" href="#c.drm_client_buffer_vunmap" title="drm_client_buffer_vunmap"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_buffer_vunmap()</span></code></a>; or the client buffer should be mapped
throughout its lifetime.</p>
<p>The returned address is a copy of the internal value. In contrast to
other vmap interfaces, you don’t need it for the client’s vunmap
function. So you can modify it at will during blit and draw operations.</p>
<p><strong>Return</strong></p>
<blockquote>
<div>0 on success, or a negative errno code otherwise.</div></blockquote>
<dl class="function">
<dt id="c.drm_client_buffer_vunmap">
void <code class="descname">drm_client_buffer_vunmap</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer">drm_client_buffer</a><em>&nbsp;*buffer</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_buffer_vunmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Unmap DRM client buffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_buffer</span> <span class="pre">*buffer</span></code></dt>
<dd>DRM client buffer</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function removes a client buffer’s memory mapping. Calling this
function is only required by clients that manage their buffer mappings
by themselves.</p>
<dl class="function">
<dt id="c.drm_client_framebuffer_create">
struct <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer">drm_client_buffer</a> * <code class="descname">drm_client_framebuffer_create</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em>, u32<em>&nbsp;width</em>, u32<em>&nbsp;height</em>, u32<em>&nbsp;format</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_framebuffer_create" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a client framebuffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">width</span></code></dt>
<dd>Framebuffer width</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">height</span></code></dt>
<dd>Framebuffer height</dd>
<dt><code class="docutils literal notranslate"><span class="pre">u32</span> <span class="pre">format</span></code></dt>
<dd>Buffer format</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function creates a <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_client_buffer</span></code></a> which consists of a
<a class="reference internal" href="drm-kms.html#c.drm_framebuffer" title="drm_framebuffer"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_framebuffer</span></code></a> backed by a dumb buffer.
Call <a class="reference internal" href="#c.drm_client_framebuffer_delete" title="drm_client_framebuffer_delete"><code class="xref c c-func docutils literal notranslate"><span class="pre">drm_client_framebuffer_delete()</span></code></a> to free the buffer.</p>
<p><strong>Return</strong></p>
<p>Pointer to a client buffer or an error pointer on failure.</p>
<dl class="function">
<dt id="c.drm_client_framebuffer_delete">
void <code class="descname">drm_client_framebuffer_delete</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer">drm_client_buffer</a><em>&nbsp;*buffer</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_framebuffer_delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete a client framebuffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_buffer</span> <span class="pre">*buffer</span></code></dt>
<dd>DRM client buffer (can be NULL)</dd>
</dl>
<dl class="function">
<dt id="c.drm_client_framebuffer_flush">
int <code class="descname">drm_client_framebuffer_flush</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_buffer" title="drm_client_buffer">drm_client_buffer</a><em>&nbsp;*buffer</em>, struct <a class="reference internal" href="drm-kms-helpers.html#c.drm_rect" title="drm_rect">drm_rect</a><em>&nbsp;*rect</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_framebuffer_flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Manually flush client framebuffer</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_buffer</span> <span class="pre">*buffer</span></code></dt>
<dd>DRM client buffer (can be NULL)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_rect</span> <span class="pre">*rect</span></code></dt>
<dd>Damage rectangle (if NULL flushes all)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This calls <a class="reference internal" href="drm-kms.html#c.drm_framebuffer_funcs" title="drm_framebuffer_funcs"><code class="xref c c-type docutils literal notranslate"><span class="pre">drm_framebuffer_funcs-&gt;dirty</span></code></a> (if present) to flush buffer changes
for drivers that need it.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_modeset_probe">
int <code class="descname">drm_client_modeset_probe</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em>, unsigned int<em>&nbsp;width</em>, unsigned int<em>&nbsp;height</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_modeset_probe" title="Permalink to this definition">¶</a></dt>
<dd><p>Probe for displays</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">width</span></code></dt>
<dd>Maximum display mode width (optional)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">height</span></code></dt>
<dd>Maximum display mode height (optional)</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function sets up display pipelines for enabled connectors and stores the
config in the client’s modeset array.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_rotation">
bool <code class="descname">drm_client_rotation</code><span class="sig-paren">(</span>struct <a class="reference internal" href="drm-kms.html#c.drm_mode_set" title="drm_mode_set">drm_mode_set</a><em>&nbsp;*modeset</em>, unsigned int<em>&nbsp;*rotation</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_rotation" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the initial rotation value</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_mode_set</span> <span class="pre">*modeset</span></code></dt>
<dd>DRM modeset</dd>
<dt><code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span> <span class="pre">*rotation</span></code></dt>
<dd>Returned rotation value</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function checks if the primary plane in <strong>modeset</strong> can hw rotate
to match the rotation needed on its connector.</p>
<p><strong>Note</strong></p>
<p>Currently only 0 and 180 degrees are supported.</p>
<p><strong>Return</strong></p>
<p>True if the plane can do the rotation, false otherwise.</p>
<dl class="function">
<dt id="c.drm_client_modeset_check">
int <code class="descname">drm_client_modeset_check</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_modeset_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Check modeset configuration</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
</dl>
<p><strong>Description</strong></p>
<p>Check modeset configuration.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_modeset_commit_locked">
int <code class="descname">drm_client_modeset_commit_locked</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_modeset_commit_locked" title="Permalink to this definition">¶</a></dt>
<dd><p>Force commit CRTC configuration</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
</dl>
<p><strong>Description</strong></p>
<p>Commit modeset configuration to crtcs without checking if there is a DRM
master. The assumption is that the caller already holds an internal DRM
master reference acquired with drm_master_internal_acquire().</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_modeset_commit">
int <code class="descname">drm_client_modeset_commit</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_modeset_commit" title="Permalink to this definition">¶</a></dt>
<dd><p>Commit CRTC configuration</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
</dl>
<p><strong>Description</strong></p>
<p>Commit modeset configuration to crtcs.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
<dl class="function">
<dt id="c.drm_client_modeset_dpms">
int <code class="descname">drm_client_modeset_dpms</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.drm_client_dev" title="drm_client_dev">drm_client_dev</a><em>&nbsp;*client</em>, int<em>&nbsp;mode</em><span class="sig-paren">)</span><a class="headerlink" href="#c.drm_client_modeset_dpms" title="Permalink to this definition">¶</a></dt>
<dd><p>Set DPMS mode</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">drm_client_dev</span> <span class="pre">*client</span></code></dt>
<dd>DRM client</dd>
<dt><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">mode</span></code></dt>
<dd>DPMS mode</dd>
</dl>
<p><strong>Note</strong></p>
<p>For atomic drivers <strong>mode</strong> is reduced to on/off.</p>
<p><strong>Return</strong></p>
<p>Zero on success or negative error code on failure.</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="drivers.html" class="btn btn-neutral float-right" title="GPU Driver Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="driver-uapi.html" class="btn btn-neutral" title="DRM Driver uAPI" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
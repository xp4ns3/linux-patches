

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Backlight support &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Linux GPU Driver Developer’s Guide" href="index.html"/>
        <link rel="next" title="VGA Switcheroo" href="vga-switcheroo.html"/>
        <link rel="prev" title="drm/komeda Arm display driver" href="komeda-kms.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Linux GPU Driver Developer’s Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-internals.html">DRM Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-mm.html">DRM Memory Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms.html">Kernel Mode Setting (KMS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-kms-helpers.html">Mode Setting Helper Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-uapi.html">Userland interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="driver-uapi.html">DRM Driver uAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="drm-client.html">Kernel clients</a></li>
<li class="toctree-l2"><a class="reference internal" href="drivers.html">GPU Driver Documentation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Backlight support</a></li>
<li class="toctree-l2"><a class="reference internal" href="vga-switcheroo.html">VGA Switcheroo</a></li>
<li class="toctree-l2"><a class="reference internal" href="vgaarbiter.html">VGA Arbiter</a></li>
<li class="toctree-l2"><a class="reference internal" href="todo.html">TODO list</a></li>
<li class="toctree-l2"><a class="reference internal" href="rfc/index.html">GPU RFC Section</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Linux GPU Driver Developer’s Guide</a> &raquo;</li>
        
      <li>Backlight support</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/gpu/backlight.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="backlight-support">
<h1>Backlight support<a class="headerlink" href="#backlight-support" title="Permalink to this headline">¶</a></h1>
<p>The backlight core supports implementing backlight drivers.</p>
<p>A backlight driver registers a driver using
<a class="reference internal" href="#c.devm_backlight_device_register" title="devm_backlight_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_backlight_device_register()</span></code></a>. The properties of the backlight
driver such as type and max_brightness must be specified.
When the core detect changes in for example brightness or power state
the update_status() operation is called. The backlight driver shall
implement this operation and use it to adjust backlight.</p>
<p>Several sysfs attributes are provided by the backlight core:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- brightness         R/W, set the requested brightness level
- actual_brightness  RO, the brightness level used by the HW
- max_brightness     RO, the maximum  brightness level supported
</pre></div>
</div>
<p>See Documentation/ABI/stable/sysfs-class-backlight for the full list.</p>
<p>The backlight can be adjusted using the sysfs interface, and
the backlight driver may also support adjusting backlight using
a hot-key or some other platform or firmware specific way.</p>
<p>The driver must implement the get_brightness() operation if
the HW do not support all the levels that can be specified in
brightness, thus providing user-space access to the actual level
via the actual_brightness attribute.</p>
<p>When the backlight changes this is reported to user-space using
an uevent connected to the actual_brightness attribute.
When brightness is set by platform specific means, for example
a hot-key to adjust backlight, the driver must notify the backlight
core that brightness has changed using <a class="reference internal" href="#c.backlight_force_update" title="backlight_force_update"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_force_update()</span></code></a>.</p>
<p>The backlight driver core receives notifications from fbdev and
if the event is FB_EVENT_BLANK and if the value of blank, from the
FBIOBLANK ioctrl, results in a change in the backlight state the
update_status() operation is called.</p>
<dl class="type">
<dt id="c.backlight_update_reason">
enum <code class="descname">backlight_update_reason</code><a class="headerlink" href="#c.backlight_update_reason" title="Permalink to this definition">¶</a></dt>
<dd><p>what method was used to update backlight</p>
</dd></dl>

<p><strong>Constants</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_UPDATE_HOTKEY</span></code></dt>
<dd>The backlight was updated using a hot-key.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_UPDATE_SYSFS</span></code></dt>
<dd>The backlight was updated using sysfs.</dd>
</dl>
<p><strong>Description</strong></p>
<p>A driver indicates the method (reason) used for updating the backlight
when calling <a class="reference internal" href="#c.backlight_force_update" title="backlight_force_update"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_force_update()</span></code></a>.</p>
<dl class="type">
<dt id="c.backlight_type">
enum <code class="descname">backlight_type</code><a class="headerlink" href="#c.backlight_type" title="Permalink to this definition">¶</a></dt>
<dd><p>the type of backlight control</p>
</dd></dl>

<p><strong>Constants</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_RAW</span></code></dt>
<dd>The backlight is controlled using hardware registers.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_PLATFORM</span></code></dt>
<dd>The backlight is controlled using a platform-specific interface.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_FIRMWARE</span></code></dt>
<dd>The backlight is controlled using a standard firmware interface.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_TYPE_MAX</span></code></dt>
<dd>Number of entries.</dd>
</dl>
<p><strong>Description</strong></p>
<p>The type of interface used to control the backlight.</p>
<dl class="type">
<dt id="c.backlight_notification">
enum <code class="descname">backlight_notification</code><a class="headerlink" href="#c.backlight_notification" title="Permalink to this definition">¶</a></dt>
<dd><p>the type of notification</p>
</dd></dl>

<p><strong>Constants</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_REGISTERED</span></code></dt>
<dd>The backlight device is registered.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">BACKLIGHT_UNREGISTERED</span></code></dt>
<dd>The backlight revice is unregistered.</dd>
</dl>
<p><strong>Description</strong></p>
<p>The notifications that is used for notification sent to the receiver
that registered notifications using <a class="reference internal" href="#c.backlight_register_notifier" title="backlight_register_notifier"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_register_notifier()</span></code></a>.</p>
<dl class="type">
<dt id="c.backlight_ops">
struct <code class="descname">backlight_ops</code><a class="headerlink" href="#c.backlight_ops" title="Permalink to this definition">¶</a></dt>
<dd><p>backlight operations</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct backlight_ops {
  unsigned int options;
#define BL_CORE_SUSPENDRESUME   (1 &lt;&lt; 0);
  int (*update_status)(struct backlight_device *);
  int (*get_brightness)(struct backlight_device *);
  int (*check_fb)(struct backlight_device *bd, struct fb_info *info);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">options</span></code></dt>
<dd><p class="first">Configure how operations are called from the core.</p>
<p class="last">The options parameter is used to adjust the behaviour of the core.
Set BL_CORE_SUSPENDRESUME to get the update_status() operation called
upon suspend and resume.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">update_status</span></code></dt>
<dd><p class="first">Operation called when properties have changed.</p>
<p>Notify the backlight driver some property has changed.
The update_status operation is protected by the update_lock.</p>
<p>The backlight driver is expected to use <a class="reference internal" href="#c.backlight_is_blank" title="backlight_is_blank"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_is_blank()</span></code></a>
to check if the display is blanked and set brightness accordingly.
update_status() is called when any of the properties has changed.</p>
<p>RETURNS:</p>
<p class="last">0 on success, negative error code if any failure occurred.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">get_brightness</span></code></dt>
<dd><p class="first">Return the current backlight brightness.</p>
<p>The driver may implement this as a readback from the HW.
This operation is optional and if not present then the current
brightness property value is used.</p>
<p>RETURNS:</p>
<p class="last">A brightness value which is 0 or a positive number.
On failure a negative error code is returned.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">check_fb</span></code></dt>
<dd><p class="first">Check the framebuffer device.</p>
<p>Check if given framebuffer device is the one bound to this backlight.
This operation is optional and if not implemented it is assumed that the
fbdev is always the one bound to the backlight.</p>
<p>RETURNS:</p>
<p class="last">If info is NULL or the info matches the fbdev bound to the backlight return true.
If info does not match the fbdev bound to the backlight return false.</p>
</dd>
</dl>
<p><strong>Description</strong></p>
<p>The backlight operations are specified when the backlight device is registered.</p>
<dl class="type">
<dt id="c.backlight_properties">
struct <code class="descname">backlight_properties</code><a class="headerlink" href="#c.backlight_properties" title="Permalink to this definition">¶</a></dt>
<dd><p>backlight properties</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct backlight_properties {
  int brightness;
  int max_brightness;
  int power;
  int fb_blank;
  enum backlight_type type;
  unsigned int state;
#define BL_CORE_SUSPENDED       (1 &lt;&lt; 0)        ;
#define BL_CORE_FBBLANK         (1 &lt;&lt; 1)        ;
  enum backlight_scale scale;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">brightness</span></code></dt>
<dd><p class="first">The current brightness requested by the user.</p>
<p>The backlight core makes sure the range is (0 to max_brightness)
when the brightness is set via the sysfs attribute:
/sys/class/backlight/&lt;backlight&gt;/brightness.</p>
<p class="last">This value can be set in the backlight_properties passed
to <a class="reference internal" href="#c.devm_backlight_device_register" title="devm_backlight_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_backlight_device_register()</span></code></a> to set a default brightness
value.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">max_brightness</span></code></dt>
<dd><p class="first">The maximum brightness value.</p>
<p class="last">This value must be set in the backlight_properties passed to
<a class="reference internal" href="#c.devm_backlight_device_register" title="devm_backlight_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_backlight_device_register()</span></code></a> and shall not be modified by the
driver after registration.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">power</span></code></dt>
<dd><p class="first">The current power mode.</p>
<p>User space can configure the power mode using the sysfs
attribute: /sys/class/backlight/&lt;backlight&gt;/bl_power
When the power property is updated update_status() is called.</p>
<p>The possible values are: (0: full on, 1 to 3: power saving
modes; 4: full off), see FB_BLANK_XXX.</p>
<p class="last">When the backlight device is enabled <strong>power</strong> is set
to FB_BLANK_UNBLANK. When the backlight device is disabled
<strong>power</strong> is set to FB_BLANK_POWERDOWN.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fb_blank</span></code></dt>
<dd><p class="first">The power state from the FBIOBLANK ioctl.</p>
<p>When the FBIOBLANK ioctl is called <strong>fb_blank</strong> is set to the
blank parameter and the update_status() operation is called.</p>
<p>When the backlight device is enabled <strong>fb_blank</strong> is set
to FB_BLANK_UNBLANK. When the backlight device is disabled
<strong>fb_blank</strong> is set to FB_BLANK_POWERDOWN.</p>
<p>Backlight drivers should avoid using this property. It has been
replaced by state &amp; BL_CORE_FBLANK (although most drivers should
use <a class="reference internal" href="#c.backlight_is_blank" title="backlight_is_blank"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_is_blank()</span></code></a> as the preferred means to get the blank
state).</p>
<p class="last">fb_blank is deprecated and will be removed.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">type</span></code></dt>
<dd><p class="first">The type of backlight supported.</p>
<p>The backlight type allows userspace to make appropriate
policy decisions based on the backlight type.</p>
<p class="last">This value must be set in the backlight_properties
passed to <a class="reference internal" href="#c.devm_backlight_device_register" title="devm_backlight_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_backlight_device_register()</span></code></a>.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">state</span></code></dt>
<dd><p class="first">The state of the backlight core.</p>
<p>The state is a bitmask. BL_CORE_FBBLANK is set when the display
is expected to be blank. BL_CORE_SUSPENDED is set when the
driver is suspended.</p>
<p>backlight drivers are expected to use <a class="reference internal" href="#c.backlight_is_blank" title="backlight_is_blank"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_is_blank()</span></code></a>
in their update_status() operation rather than reading the
state property.</p>
<p class="last">The state is maintained by the core and drivers may not modify it.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">scale</span></code></dt>
<dd>The type of the brightness scale.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This structure defines all the properties of a backlight.</p>
<dl class="type">
<dt id="c.backlight_device">
struct <code class="descname">backlight_device</code><a class="headerlink" href="#c.backlight_device" title="Permalink to this definition">¶</a></dt>
<dd><p>backlight device data</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct backlight_device {
  struct backlight_properties props;
  struct mutex update_lock;
  struct mutex ops_lock;
  const struct backlight_ops *ops;
  struct notifier_block fb_notif;
  struct list_head entry;
  struct device dev;
  bool fb_bl_on[FB_MAX];
  int use_count;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">props</span></code></dt>
<dd>Backlight properties</dd>
<dt><code class="docutils literal notranslate"><span class="pre">update_lock</span></code></dt>
<dd><p class="first">The lock used when calling the update_status() operation.</p>
<p class="last">update_lock is an internal backlight lock that serialise access
to the update_status() operation. The backlight core holds the update_lock
when calling the update_status() operation. The update_lock shall not
be used by backlight drivers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops_lock</span></code></dt>
<dd><p class="first">The lock used around everything related to backlight_ops.</p>
<p class="last">ops_lock is an internal backlight lock that protects the ops pointer
and is used around all accesses to ops and when the operations are
invoked. The ops_lock shall not be used by backlight drivers.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">ops</span></code></dt>
<dd><p class="first">Pointer to the backlight operations.</p>
<p class="last">If ops is NULL, the driver that registered this device has been unloaded,
and if class_get_devdata() points to something in the body of that driver,
it is also invalid.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fb_notif</span></code></dt>
<dd>The framebuffer notifier block</dd>
<dt><code class="docutils literal notranslate"><span class="pre">entry</span></code></dt>
<dd>List entry of all registered backlight devices</dd>
<dt><code class="docutils literal notranslate"><span class="pre">dev</span></code></dt>
<dd>Parent device.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fb_bl_on</span></code></dt>
<dd><p class="first">The state of individual fbdev’s.</p>
<p class="last">Multiple fbdev’s may share one backlight device. The fb_bl_on
records the state of the individual fbdev.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">use_count</span></code></dt>
<dd>The number of uses of fb_bl_on.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This structure holds all data required by a backlight device.</p>
<dl class="function">
<dt id="c.backlight_update_status">
int <code class="descname">backlight_update_status</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_update_status" title="Permalink to this definition">¶</a></dt>
<dd><p>force an update of the backlight device status</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device</dd>
</dl>
<dl class="function">
<dt id="c.backlight_enable">
int <code class="descname">backlight_enable</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_enable" title="Permalink to this definition">¶</a></dt>
<dd><p>Enable backlight</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device to enable</dd>
</dl>
<dl class="function">
<dt id="c.backlight_disable">
int <code class="descname">backlight_disable</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_disable" title="Permalink to this definition">¶</a></dt>
<dd><p>Disable backlight</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device to disable</dd>
</dl>
<dl class="function">
<dt id="c.backlight_is_blank">
bool <code class="descname">backlight_is_blank</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_is_blank" title="Permalink to this definition">¶</a></dt>
<dd><p>Return true if display is expected to be blank</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Display is expected to be blank if any of these is true:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1) if power in not UNBLANK
2) if fb_blank is not UNBLANK
3) if state indicate BLANK or SUSPENDED
</pre></div>
</div>
<p>Returns true if display is expected to be blank, false otherwise.</p>
<dl class="function">
<dt id="c.backlight_get_brightness">
int <code class="descname">backlight_get_brightness</code><span class="sig-paren">(</span>const struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_get_brightness" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the current brightness value</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns the current brightness value, taking in consideration the current
state. If <a class="reference internal" href="#c.backlight_is_blank" title="backlight_is_blank"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_is_blank()</span></code></a> returns true then return 0 as brightness
otherwise return the current brightness property value.</p>
<p>Backlight drivers are expected to use this function in their update_status()
operation to get the brightness value.</p>
<dl class="function">
<dt id="c.bl_get_data">
void * <code class="descname">bl_get_data</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bl_dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.bl_get_data" title="Permalink to this definition">¶</a></dt>
<dd><p>access devdata</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bl_dev</span></code></dt>
<dd>pointer to backlight device</dd>
</dl>
<p><strong>Description</strong></p>
<p>When a backlight device is registered the driver has the possibility
to supply a void * devdata. <a class="reference internal" href="#c.bl_get_data" title="bl_get_data"><code class="xref c c-func docutils literal notranslate"><span class="pre">bl_get_data()</span></code></a> return a pointer to the
devdata.</p>
<p>pointer to devdata stored while registering the backlight device.</p>
<p><strong>Return</strong></p>
<dl class="function">
<dt id="c.backlight_force_update">
void <code class="descname">backlight_force_update</code><span class="sig-paren">(</span>struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em>, enum <a class="reference internal" href="#c.backlight_update_reason" title="backlight_update_reason">backlight_update_reason</a><em>&nbsp;reason</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_force_update" title="Permalink to this definition">¶</a></dt>
<dd><p>tell the backlight subsystem that hardware state has changed</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device to update</dd>
<dt><code class="docutils literal notranslate"><span class="pre">enum</span> <span class="pre">backlight_update_reason</span> <span class="pre">reason</span></code></dt>
<dd>reason for update</dd>
</dl>
<p><strong>Description</strong></p>
<p>Updates the internal state of the backlight in response to a hardware event,
and generates an uevent to notify userspace. A backlight driver shall call
<a class="reference internal" href="#c.backlight_force_update" title="backlight_force_update"><code class="xref c c-func docutils literal notranslate"><span class="pre">backlight_force_update()</span></code></a> when the backlight is changed using, for example,
a hot-key. The updated brightness is read using get_brightness() and the
brightness value is reported using an uevent.</p>
<dl class="function">
<dt id="c.backlight_device_get_by_name">
struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a> * <code class="descname">backlight_device_get_by_name</code><span class="sig-paren">(</span>const char<em>&nbsp;*name</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_device_get_by_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Get backlight device by name</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name</span></code></dt>
<dd>Device name</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function looks up a backlight device by its name. It obtains a reference
on the backlight device and it is the caller’s responsibility to drop the
reference by calling backlight_put().</p>
<p><strong>Return</strong></p>
<p>A pointer to the backlight device if found, otherwise NULL.</p>
<dl class="function">
<dt id="c.backlight_register_notifier">
int <code class="descname">backlight_register_notifier</code><span class="sig-paren">(</span>struct notifier_block<em>&nbsp;*nb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_register_notifier" title="Permalink to this definition">¶</a></dt>
<dd><p>get notified of backlight (un)registration</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">notifier_block</span> <span class="pre">*nb</span></code></dt>
<dd>notifier block with the notifier to call on backlight (un)registration</dd>
</dl>
<p><strong>Description</strong></p>
<p>Register a notifier to get notified when backlight devices get registered
or unregistered.</p>
<p>0 on success, otherwise a negative error code</p>
<p><strong>Return</strong></p>
<dl class="function">
<dt id="c.backlight_unregister_notifier">
int <code class="descname">backlight_unregister_notifier</code><span class="sig-paren">(</span>struct notifier_block<em>&nbsp;*nb</em><span class="sig-paren">)</span><a class="headerlink" href="#c.backlight_unregister_notifier" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister a backlight notifier</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">notifier_block</span> <span class="pre">*nb</span></code></dt>
<dd>notifier block to unregister</dd>
</dl>
<p><strong>Description</strong></p>
<p>Register a notifier to get notified when backlight devices get registered
or unregistered.</p>
<p>0 on success, otherwise a negative error code</p>
<p><strong>Return</strong></p>
<dl class="function">
<dt id="c.devm_backlight_device_register">
struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a> * <code class="descname">devm_backlight_device_register</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a><em>&nbsp;*dev</em>, const char<em>&nbsp;*name</em>, struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a><em>&nbsp;*parent</em>, void<em>&nbsp;*devdata</em>, const struct <a class="reference internal" href="#c.backlight_ops" title="backlight_ops">backlight_ops</a><em>&nbsp;*ops</em>, const struct <a class="reference internal" href="#c.backlight_properties" title="backlight_properties">backlight_properties</a><em>&nbsp;*props</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_backlight_device_register" title="Permalink to this definition">¶</a></dt>
<dd><p>register a new backlight device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt>
<dd>the device to register</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">char</span> <span class="pre">*name</span></code></dt>
<dd>the name of the device</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*parent</span></code></dt>
<dd>a pointer to the parent device (often the same as <strong>dev</strong>)</dd>
<dt><code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*devdata</span></code></dt>
<dd>an optional pointer to be stored for private driver use</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">backlight_ops</span> <span class="pre">*ops</span></code></dt>
<dd>the backlight operations structure</dd>
<dt><code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">backlight_properties</span> <span class="pre">*props</span></code></dt>
<dd>the backlight properties</dd>
</dl>
<p><strong>Description</strong></p>
<p>Creates and registers new backlight device. When a backlight device
is registered the configuration must be specified in the <strong>props</strong>
parameter. See description of <a class="reference internal" href="#c.backlight_properties" title="backlight_properties"><code class="xref c c-type docutils literal notranslate"><span class="pre">backlight_properties</span></code></a>.</p>
<p>struct backlight on success, or an ERR_PTR on error</p>
<p><strong>Return</strong></p>
<dl class="function">
<dt id="c.devm_backlight_device_unregister">
void <code class="descname">devm_backlight_device_unregister</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a><em>&nbsp;*dev</em>, struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a><em>&nbsp;*bd</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_backlight_device_unregister" title="Permalink to this definition">¶</a></dt>
<dd><p>unregister backlight device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt>
<dd>the device to unregister</dd>
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">backlight_device</span> <span class="pre">*bd</span></code></dt>
<dd>the backlight device to unregister</dd>
</dl>
<p><strong>Description</strong></p>
<p>Deallocates a backlight allocated with <a class="reference internal" href="#c.devm_backlight_device_register" title="devm_backlight_device_register"><code class="xref c c-func docutils literal notranslate"><span class="pre">devm_backlight_device_register()</span></code></a>.
Normally this function will not need to be called and the resource management
code will ensure that the resources are freed.</p>
<dl class="function">
<dt id="c.of_find_backlight_by_node">
struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a> * <code class="descname">of_find_backlight_by_node</code><span class="sig-paren">(</span>struct device_node<em>&nbsp;*node</em><span class="sig-paren">)</span><a class="headerlink" href="#c.of_find_backlight_by_node" title="Permalink to this definition">¶</a></dt>
<dd><p>find backlight device by device-tree node</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device_node</span> <span class="pre">*node</span></code></dt>
<dd>device-tree node of the backlight device</dd>
</dl>
<p><strong>Description</strong></p>
<p>Returns a pointer to the backlight device corresponding to the given DT
node or NULL if no such backlight device exists or if the device hasn’t
been probed yet.</p>
<p>This function obtains a reference on the backlight device and it is the
caller’s responsibility to drop the reference by calling <a class="reference internal" href="../driver-api/infrastructure.html#c.put_device" title="put_device"><code class="xref c c-func docutils literal notranslate"><span class="pre">put_device()</span></code></a> on
the backlight device’s .dev field.</p>
<dl class="function">
<dt id="c.devm_of_find_backlight">
struct <a class="reference internal" href="#c.backlight_device" title="backlight_device">backlight_device</a> * <code class="descname">devm_of_find_backlight</code><span class="sig-paren">(</span>struct <a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device">device</a><em>&nbsp;*dev</em><span class="sig-paren">)</span><a class="headerlink" href="#c.devm_of_find_backlight" title="Permalink to this definition">¶</a></dt>
<dd><p>find backlight for a device</p>
</dd></dl>

<p><strong>Parameters</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span> <span class="pre">*dev</span></code></dt>
<dd>the device</dd>
</dl>
<p><strong>Description</strong></p>
<p>This function looks for a property named ‘backlight’ on the DT node
connected to <strong>dev</strong> and looks up the backlight device. The lookup is
device managed so the reference to the backlight device is automatically
dropped on driver detach.</p>
<p>A pointer to the backlight device if found.
Error pointer -EPROBE_DEFER if the DT property is set, but no backlight
device is found. NULL if there’s no backlight property.</p>
<p><strong>Return</strong></p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="vga-switcheroo.html" class="btn btn-neutral float-right" title="VGA Switcheroo" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="komeda-kms.html" class="btn btn-neutral" title="drm/komeda Arm display driver" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CoreSight System Configuration Manager &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../index.html"/>
        <link rel="up" title="CoreSight - ARM Hardware Trace" href="index.html"/>
        <link rel="next" title="Coresight CPU Debug Module" href="coresight-cpu-debug.html"/>
        <link rel="prev" title="Coresight - HW Assisted Tracing on ARM" href="coresight.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Linux Tracing Technologies</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../ftrace-design.html">Function Tracer Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracepoint-analysis.html">Notes on Analysing Behaviour Using Events and Tracepoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ftrace.html">ftrace - Function Tracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ftrace-uses.html">Using ftrace to hook to functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../fprobe.html">Fprobe - Function entry/exit probe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kprobes.html">Kernel Probes (Kprobes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kprobetrace.html">Kprobe-based Event Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uprobetracer.html">Uprobe-tracer: Uprobe-based Event Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tracepoints.html">Using the Linux Kernel Tracepoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events.html">Event Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events-kmem.html">Subsystem Trace Points: kmem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events-power.html">Subsystem Trace Points: power</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events-nmi.html">NMI Trace Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../events-msr.html">MSR Trace Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mmiotrace.html">In-kernel memory-mapped I/O tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../histogram.html">Event Histograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../histogram-design.html">Histogram Design Notes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../boottime-trace.html">Boot-time tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hwlat_detector.html">Hardware Latency Detector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../osnoise-tracer.html">OSNOISE Tracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../timerlat-tracer.html">Timerlat tracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../intel_th.html">Intel(R) Trace Hub (TH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ring-buffer-design.html">Lockless Ring Buffer Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../stm.html">System Trace Module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sys-t.html">MIPI SyS-T over STP</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">CoreSight - ARM Hardware Trace</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="coresight.html">Coresight - HW Assisted Tracing on ARM</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">CoreSight System Configuration Manager</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-concepts">Basic Concepts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#viewing-configurations-and-features">Viewing Configurations and Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-configurations-in-perf">Using Configurations in perf</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-configurations-in-sysfs">Using Configurations in sysfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-and-loading-custom-configurations">Creating and Loading Custom Configurations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="coresight-cpu-debug.html">Coresight CPU Debug Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="coresight-ect.html">CoreSight Embedded Cross Trigger (CTI &amp; CTM).</a></li>
<li class="toctree-l3"><a class="reference internal" href="coresight-etm4x-reference.html">ETMv4 sysfs linux driver programming reference.</a></li>
<li class="toctree-l3"><a class="reference internal" href="coresight-trbe.html">Trace Buffer Extension (TRBE).</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user_events.html">user_events: User-based Event Tracing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Linux Tracing Technologies</a> &raquo;</li>
        
          <li><a href="index.html">CoreSight - ARM Hardware Trace</a> &raquo;</li>
        
      <li>CoreSight System Configuration Manager</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/trace/coresight/coresight-config.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="coresight-system-configuration-manager">
<h1>CoreSight System Configuration Manager<a class="headerlink" href="#coresight-system-configuration-manager" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Mike Leach &lt;<a class="reference external" href="mailto:mike&#46;leach&#37;&#52;&#48;linaro&#46;org">mike<span>&#46;</span>leach<span>&#64;</span>linaro<span>&#46;</span>org</a>&gt;</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">October 2020</td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>The CoreSight System Configuration manager is an API that allows the
programming of the CoreSight system with pre-defined configurations that
can then be easily enabled from sysfs or perf.</p>
<p>Many CoreSight components can be programmed in complex ways - especially ETMs.
In addition, components can interact across the CoreSight system, often via
the cross trigger components such as CTI and CTM. These system settings can
be defined and enabled as named configurations.</p>
</div>
<div class="section" id="basic-concepts">
<h2>Basic Concepts<a class="headerlink" href="#basic-concepts" title="Permalink to this headline">¶</a></h2>
<p>This section introduces the basic concepts of a CoreSight system configuration.</p>
<div class="section" id="features">
<h3>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h3>
<p>A feature is a named set of programming for a CoreSight device. The programming
is device dependent, and can be defined in terms of absolute register values,
resource usage and parameter values.</p>
<p>The feature is defined using a descriptor. This descriptor is used to load onto
a matching device, either when the feature is loaded into the system, or when the
CoreSight device is registered with the configuration manager.</p>
<p>The load process involves interpreting the descriptor into a set of register
accesses in the driver - the resource usage and parameter descriptions
translated into appropriate register accesses. This interpretation makes it easy
and efficient for the feature to be programmed onto the device when required.</p>
<p>The feature will not be active on the device until the feature is enabled, and
the device itself is enabled. When the device is enabled then enabled features
will be programmed into the device hardware.</p>
<p>A feature is enabled as part of a configuration being enabled on the system.</p>
<div class="section" id="parameter-value">
<h4>Parameter Value<a class="headerlink" href="#parameter-value" title="Permalink to this headline">¶</a></h4>
<p>A parameter value is a named value that may be set by the user prior to the
feature being enabled that can adjust the behaviour of the operation programmed
by the feature.</p>
<p>For example, this could be a count value in a programmed operation that repeats
at a given rate. When the feature is enabled then the current value of the
parameter is used in programming the device.</p>
<p>The feature descriptor defines a default value for a parameter, which is used
if the user does not supply a new value.</p>
<p>Users can update parameter values using the configfs API for the CoreSight
system - which is described below.</p>
<p>The current value of the parameter is loaded into the device when the feature
is enabled on that device.</p>
</div>
</div>
<div class="section" id="configurations">
<h3>Configurations<a class="headerlink" href="#configurations" title="Permalink to this headline">¶</a></h3>
<p>A configuration defines a set of features that are to be used in a trace
session where the configuration is selected. For any trace session only one
configuration may be selected.</p>
<p>The features defined may be on any type of device that is registered
to support system configuration. A configuration may select features to be
enabled on a class of devices - i.e. any ETMv4, or specific devices, e.g. a
specific CTI on the system.</p>
<p>As with the feature, a descriptor is used to define the configuration.
This will define the features that must be enabled as part of the configuration
as well as any preset values that can be used to override default parameter
values.</p>
<div class="section" id="preset-values">
<h4>Preset Values<a class="headerlink" href="#preset-values" title="Permalink to this headline">¶</a></h4>
<p>Preset values are easily selectable sets of parameter values for the features
that the configuration uses. The number of values in a single preset set, equals
the sum of parameter values in the features used by the configuration.</p>
<p>e.g. a configuration consists of 3 features, one has 2 parameters, one has
a single parameter, and another has no parameters. A single preset set will
therefore have 3 values.</p>
<p>Presets are optionally defined by the configuration, up to 15 can be defined.
If no preset is selected, then the parameter values defined in the feature
are used as normal.</p>
</div>
<div class="section" id="operation">
<h4>Operation<a class="headerlink" href="#operation" title="Permalink to this headline">¶</a></h4>
<p>The following steps take place in the operation of a configuration.</p>
<ol class="arabic">
<li><p class="first">In this example, the configuration is ‘autofdo’, which has an
associated feature ‘strobing’ that works on ETMv4 CoreSight Devices.</p>
</li>
<li><p class="first">The configuration is enabled. For example ‘perf’ may select the
configuration as part of its command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>perf record -e cs_etm/autofdo/ myapp
</pre></div>
</div>
<p>which will enable the ‘autofdo’ configuration.</p>
</li>
<li><p class="first">perf starts tracing on the system. As each ETMv4 that perf uses for
trace is enabled,  the configuration manager will check if the ETMv4
has a feature that relates to the currently active configuration.
In this case ‘strobing’ is enabled &amp; programmed into the ETMv4.</p>
</li>
<li><p class="first">When the ETMv4 is disabled, any registers marked as needing to be
saved will be read back.</p>
</li>
<li><p class="first">At the end of the perf session, the configuration will be disabled.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="viewing-configurations-and-features">
<h2>Viewing Configurations and Features<a class="headerlink" href="#viewing-configurations-and-features" title="Permalink to this headline">¶</a></h2>
<p>The set of configurations and features that are currently loaded into the
system can be viewed using the configfs API.</p>
<p>Mount configfs as normal and the ‘cs-syscfg’ subsystem will appear:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ls /config
cs-syscfg  stp-policy
</pre></div>
</div>
<p>This has two sub-directories:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd cs-syscfg/
$ ls
configurations  features
</pre></div>
</div>
<p>The system has the configuration ‘autofdo’ built in. It may be examined as
follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd configurations/
$ ls
autofdo
$ cd autofdo/
$ ls
description  feature_refs  preset1  preset3  preset5  preset7  preset9
enable       preset        preset2  preset4  preset6  preset8
$ cat description
Setup ETMs with strobing for autofdo
$ cat feature_refs
strobing
</pre></div>
</div>
<p>Each preset declared has a ‘preset&lt;n&gt;’ subdirectory declared. The values for
the preset can be examined:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cat preset1/values
strobing.window = 0x1388 strobing.period = 0x2
$ cat preset2/values
strobing.window = 0x1388 strobing.period = 0x4
</pre></div>
</div>
<p>The ‘enable’ and ‘preset’ files allow the control of a configuration when
using CoreSight with sysfs.</p>
<p>The features referenced by the configuration can be examined in the features
directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd ../../features/strobing/
$ ls
description  matches  nr_params  params
$ cat description
Generate periodic trace capture windows.
parameter &#39;window&#39;: a number of CPU cycles (W)
parameter &#39;period&#39;: trace enabled for W cycles every period x W cycles
$ cat matches
SRC_ETMV4
$ cat nr_params
2
</pre></div>
</div>
<p>Move to the params directory to examine and adjust parameters:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cd params
$ ls
period  window
$ cd period
$ ls
value
$ cat value
0x2710
# echo 15000 &gt; value
# cat value
0x3a98
</pre></div>
</div>
<p>Parameters adjusted in this way are reflected in all device instances that have
loaded the feature.</p>
</div>
<div class="section" id="using-configurations-in-perf">
<h2>Using Configurations in perf<a class="headerlink" href="#using-configurations-in-perf" title="Permalink to this headline">¶</a></h2>
<p>The configurations loaded into the CoreSight configuration management are
also declared in the perf ‘cs_etm’ event infrastructure so that they can
be selected when running trace under perf:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ls /sys/devices/cs_etm
cpu0  cpu2  events  nr_addr_filters         power  subsystem  uevent
cpu1  cpu3  format  perf_event_mux_interval_ms      sinks  type
</pre></div>
</div>
<p>The key directory here is ‘events’ - a generic perf directory which allows
selection on the perf command line. As with the sinks entries, this provides
a hash of the configuration name.</p>
<p>The entry in the ‘events’ directory uses perfs built in syntax generator
to substitute the syntax for the name when evaluating the command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ ls events/
autofdo
$ cat events/autofdo
configid=0xa7c3dddd
</pre></div>
</div>
<p>The ‘autofdo’ configuration may be selected on the perf command line:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ perf record -e cs_etm/autofdo/u --per-thread &lt;application&gt;
</pre></div>
</div>
<p>A preset to override the current parameter values can also be selected:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ perf record -e cs_etm/autofdo,preset=1/u --per-thread &lt;application&gt;
</pre></div>
</div>
<p>When configurations are selected in this way, then the trace sink used is
automatically selected.</p>
</div>
<div class="section" id="using-configurations-in-sysfs">
<h2>Using Configurations in sysfs<a class="headerlink" href="#using-configurations-in-sysfs" title="Permalink to this headline">¶</a></h2>
<p>Coresight can be controlled using sysfs. When this is in use then a configuration
can be made active for the devices that are used in the sysfs session.</p>
<p>In a configuration there are ‘enable’ and ‘preset’ files.</p>
<p>To enable a configuration for use with sysfs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ cd configurations/autofdo
$ echo 1 &gt; enable
</pre></div>
</div>
<p>This will then use any default parameter values in the features - which can be
adjusted as described above.</p>
<p>To use a preset&lt;n&gt; set of parameter values:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ echo 3 &gt; preset
</pre></div>
</div>
<p>This will select preset3 for the configuration.
The valid values for preset are 0 - to deselect presets, and any value of
&lt;n&gt; where a preset&lt;n&gt; sub-directory is present.</p>
<p>Note that the active sysfs configuration is a global parameter, therefore
only a single configuration can be active for sysfs at any one time.
Attempting to enable a second configuration will result in an error.
Additionally, attempting to disable the configuration while in use will
also result in an error.</p>
<p>The use of the active configuration by sysfs is independent of the configuration
used in perf.</p>
</div>
<div class="section" id="creating-and-loading-custom-configurations">
<h2>Creating and Loading Custom Configurations<a class="headerlink" href="#creating-and-loading-custom-configurations" title="Permalink to this headline">¶</a></h2>
<p>Custom configurations and / or features can be dynamically loaded into the
system by using a loadable module.</p>
<p>An example of a custom configuration is found in ./samples/coresight.</p>
<p>This creates a new configuration that uses the existing built in
strobing feature, but provides a different set of presets.</p>
<p>When the module is loaded, then the configuration appears in the configfs
file system and is selectable in the same way as the built in configuration
described above.</p>
<p>Configurations can use previously loaded features. The system will ensure
that it is not possible to unload a feature that is currently in use, by
enforcing the unload order as the strict reverse of the load order.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="coresight-cpu-debug.html" class="btn btn-neutral float-right" title="Coresight CPU Debug Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="coresight.html" class="btn btn-neutral" title="Coresight - HW Assisted Tracing on ARM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
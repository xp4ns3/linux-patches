

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>KSMBD - SMB3 Kernel Server &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../index.html"/>
        <link rel="up" title="CIFS" href="index.html"/>
        <link rel="next" title="Mounting root file system via SMB (cifs.ko)" href="cifsroot.html"/>
        <link rel="prev" title="CIFS" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Filesystems in the Linux kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#core-vfs-documentation">Core VFS documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#filesystem-support-layers">Filesystem support layers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#filesystems">Filesystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../9p.html">v9fs: Plan 9 Resource Sharing for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../adfs.html">Acorn Disc Filing System - ADFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../affs.html">Overview of Amiga Filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="../afs.html">kAFS: AFS FILESYSTEM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autofs.html">autofs - how it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="../autofs-mount-control.html">Miscellaneous Device control operations for the autofs kernel module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../befs.html">BeOS filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../bfs.html">BFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../btrfs.html">BTRFS</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">CIFS</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">KSMBD - SMB3 Kernel Server</a></li>
<li class="toctree-l4"><a class="reference internal" href="cifsroot.html">Mounting root file system via SMB (cifs.ko)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ceph.html">Ceph Distributed File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../coda.html">Coda Kernel-Venus Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../configfs.html">Configfs - Userspace-driven Kernel Object Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cramfs.html">Cramfs - cram a filesystem onto a small ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dax.html">Direct Access for files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../debugfs.html">DebugFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dlmfs.html">DLMFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ecryptfs.html">eCryptfs: A stacked cryptographic filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../efivarfs.html">efivarfs - a (U)EFI variable filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../erofs.html">Enhanced Read-Only File System - EROFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ext2.html">The Second Extended Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ext3.html">Ext3 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ext4/index.html">ext4 Data Structures and Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../f2fs.html">WHAT IS Flash-Friendly File System (F2FS)?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gfs2.html">Global File System 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gfs2-uevents.html">uevents and GFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gfs2-glocks.html">Glock internal locking rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hfs.html">Macintosh HFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hfsplus.html">Macintosh HFSPlus Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../hpfs.html">Read/Write HPFS 2.09</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fuse.html">FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fuse-io.html">Fuse I/O Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../inotify.html">Inotify - A Powerful yet Simple File Change Notification System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../isofs.html">ISO9660 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nilfs2.html">NILFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../nfs/index.html">NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntfs.html">The Linux NTFS filesystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ntfs3.html">NTFS3</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ocfs2.html">OCFS2 filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ocfs2-online-filecheck.html">OCFS2 file system - online file check</a></li>
<li class="toctree-l3"><a class="reference internal" href="../omfs.html">Optimized MPEG Filesystem (OMFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../orangefs.html">ORANGEFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../overlayfs.html">Overlay Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../proc.html">The /proc Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../qnx6.html">The QNX6 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ramfs-rootfs-initramfs.html">Ramfs, rootfs and initramfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../relay.html">relay interface (formerly relayfs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../romfs.html">ROMFS - ROM File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../spufs/index.html">SPU Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../squashfs.html">Squashfs 4.0 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sysfs.html">sysfs - _The_ filesystem for exporting kernel objects</a></li>
<li class="toctree-l3"><a class="reference internal" href="../sysv-fs.html">SystemV Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tmpfs.html">Tmpfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubifs.html">UBI File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ubifs-authentication.html">UBIFS Authentication Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="../udf.html">UDF file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../virtiofs.html">virtiofs: virtio-fs host&lt;-&gt;guest shared file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="../vfat.html">VFAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xfs-delayed-logging-design.html">XFS Delayed Logging Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../xfs-self-describing-metadata.html">XFS Self Describing Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../zonefs.html">ZoneFS - Zone filesystem for Zoned block devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Filesystems in the Linux kernel</a> &raquo;</li>
        
          <li><a href="index.html">CIFS</a> &raquo;</li>
        
      <li>KSMBD - SMB3 Kernel Server</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/filesystems/cifs/ksmbd.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="ksmbd-smb3-kernel-server">
<h1>KSMBD - SMB3 Kernel Server<a class="headerlink" href="#ksmbd-smb3-kernel-server" title="Permalink to this headline">¶</a></h1>
<p>KSMBD is a linux kernel server which implements SMB3 protocol in kernel space
for sharing files over network.</p>
<div class="section" id="ksmbd-architecture">
<h2>KSMBD architecture<a class="headerlink" href="#ksmbd-architecture" title="Permalink to this headline">¶</a></h2>
<p>The subset of performance related operations belong in kernelspace and
the other subset which belong to operations which are not really related with
performance in userspace. So, DCE/RPC management that has historically resulted
into number of buffer overflow issues and dangerous security bugs and user
account management are implemented in user space as ksmbd.mountd.
File operations that are related with performance (open/read/write/close etc.)
in kernel space (ksmbd). This also allows for easier integration with VFS
interface for all file operations.</p>
<div class="section" id="ksmbd-kernel-daemon">
<h3>ksmbd (kernel daemon)<a class="headerlink" href="#ksmbd-kernel-daemon" title="Permalink to this headline">¶</a></h3>
<p>When the server daemon is started, It starts up a forker thread
(ksmbd/interface name) at initialization time and open a dedicated port 445
for listening to SMB requests. Whenever new clients make request, Forker
thread will accept the client connection and fork a new thread for dedicated
communication channel between the client and the server. It allows for parallel
processing of SMB requests(commands) from clients as well as allowing for new
clients to make new connections. Each instance is named ksmbd/1~n(port number)
to indicate connected clients. Depending on the SMB request types, each new
thread can decide to pass through the commands to the user space (ksmbd.mountd),
currently DCE/RPC commands are identified to be handled through the user space.
To further utilize the linux kernel, it has been chosen to process the commands
as workitems and to be executed in the handlers of the ksmbd-io kworker threads.
It allows for multiplexing of the handlers as the kernel take care of initiating
extra worker threads if the load is increased and vice versa, if the load is
decreased it destroys the extra worker threads. So, after connection is
established with client. Dedicated ksmbd/1..n(port number) takes complete
ownership of receiving/parsing of SMB commands. Each received command is worked
in parallel i.e., There can be multiple clients commands which are worked in
parallel. After receiving each command a separated kernel workitem is prepared
for each command which is further queued to be handled by ksmbd-io kworkers.
So, each SMB workitem is queued to the kworkers. This allows the benefit of load
sharing to be managed optimally by the default kernel and optimizing client
performance by handling client commands in parallel.</p>
</div>
<div class="section" id="ksmbd-mountd-user-space-daemon">
<h3>ksmbd.mountd (user space daemon)<a class="headerlink" href="#ksmbd-mountd-user-space-daemon" title="Permalink to this headline">¶</a></h3>
<p>ksmbd.mountd is userspace process to, transfer user account and password that
are registered using ksmbd.adduser (part of utils for user space). Further it
allows sharing information parameters that parsed from smb.conf to ksmbd in
kernel. For the execution part it has a daemon which is continuously running
and connected to the kernel interface using netlink socket, it waits for the
requests (dcerpc and share/user info). It handles RPC calls (at a minimum few
dozen) that are most important for file server from NetShareEnum and
NetServerGetInfo. Complete DCE/RPC response is prepared from the user space
and passed over to the associated kernel thread for the client.</p>
</div>
</div>
<div class="section" id="ksmbd-feature-status">
<h2>KSMBD Feature Status<a class="headerlink" href="#ksmbd-feature-status" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feature name</th>
<th class="head">Status</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Dialects</td>
<td>Supported. SMB2.1 SMB3.0, SMB3.1.1 dialects
(intentionally excludes security vulnerable SMB1
dialect).</td>
</tr>
<tr class="row-odd"><td>Auto Negotiation</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>Compound Request</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>Oplock Cache Mechanism</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>SMB2 leases(v1 lease)</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>Directory leases(v2 lease)</td>
<td>Planned for future.</td>
</tr>
<tr class="row-even"><td>Multi-credits</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>NTLM/NTLMv2</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>HMAC-SHA256 Signing</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>Secure negotiate</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>Signing Update</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>Pre-authentication integrity</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>SMB3 encryption(CCM, GCM)</td>
<td>Supported. (CCM and GCM128 supported, GCM256 in
progress)</td>
</tr>
<tr class="row-odd"><td>SMB direct(RDMA)</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>SMB3 Multi-channel</td>
<td>Partially Supported. Planned to implement
replay/retry mechanisms for future.</td>
</tr>
<tr class="row-odd"><td>Receive Side Scaling mode</td>
<td>Supported.</td>
</tr>
<tr class="row-even"><td>SMB3.1.1 POSIX extension</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>ACLs</td>
<td>Partially Supported. only DACLs available, SACLs
(auditing) is planned for the future. For
ownership (SIDs) ksmbd generates random subauth
values(then store it to disk) and use uid/gid
get from inode as RID for local domain SID.
The current acl implementation is limited to
standalone server, not a domain member.
Integration with Samba tools is being worked on
to allow future support for running as a domain
member.</td>
</tr>
<tr class="row-even"><td>Kerberos</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>Durable handle v1,v2</td>
<td>Planned for future.</td>
</tr>
<tr class="row-even"><td>Persistent handle</td>
<td>Planned for future.</td>
</tr>
<tr class="row-odd"><td>SMB2 notify</td>
<td>Planned for future.</td>
</tr>
<tr class="row-even"><td>Sparse file support</td>
<td>Supported.</td>
</tr>
<tr class="row-odd"><td>DCE/RPC support</td>
<td>Partially Supported. a few calls(NetShareEnumAll,
NetServerGetInfo, SAMR, LSARPC) that are needed
for file server handled via netlink interface
from ksmbd.mountd. Additional integration with
Samba tools and libraries via upcall is being
investigated to allow support for additional
DCE/RPC management calls (and future support
for Witness protocol e.g.)</td>
</tr>
<tr class="row-even"><td>ksmbd/nfsd interoperability</td>
<td>Planned for future. The features that ksmbd
support are Leases, Notify, ACLs and Share modes.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="how-to-run">
<h2>How to run<a class="headerlink" href="#how-to-run" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><dl class="first docutils">
<dt>Download ksmbd-tools and compile them.</dt>
<dd><ul class="first last simple">
<li><a class="reference external" href="https://github.com/cifsd-team/ksmbd-tools">https://github.com/cifsd-team/ksmbd-tools</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Create user/password for SMB share.</p>
<blockquote>
<div><p># mkdir /etc/ksmbd/
# ksmbd.adduser -a &lt;Enter USERNAME for SMB share access&gt;</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Create /etc/ksmbd/smb.conf file, add SMB share in smb.conf file</dt>
<dd><ul class="first last simple">
<li>Refer smb.conf.example and
<a class="reference external" href="https://github.com/cifsd-team/ksmbd-tools/blob/master/Documentation/configuration.txt">https://github.com/cifsd-team/ksmbd-tools/blob/master/Documentation/configuration.txt</a></li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Insert ksmbd.ko module</p>
<blockquote>
<div><p># insmod ksmbd.ko</p>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Start ksmbd user space daemon</dt>
<dd><p class="first last"># ksmbd.mountd</p>
</dd>
</dl>
</li>
<li><p class="first">Access share from Windows or Linux using CIFS</p>
</li>
</ol>
</div>
<div class="section" id="shutdown-ksmbd">
<h2>Shutdown KSMBD<a class="headerlink" href="#shutdown-ksmbd" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>kill user and kernel space daemon</dt>
<dd># sudo ksmbd.control -s</dd>
</dl>
</li>
</ol>
</div>
<div class="section" id="how-to-turn-debug-print-on">
<h2>How to turn debug print on<a class="headerlink" href="#how-to-turn-debug-print-on" title="Permalink to this headline">¶</a></h2>
<p>Each layer
/sys/class/ksmbd-control/debug</p>
<ol class="arabic simple">
<li><dl class="first docutils">
<dt>Enable all component prints</dt>
<dd># sudo ksmbd.control -d “all”</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Enable one of components (smb, auth, vfs, oplock, ipc, conn, rdma)</dt>
<dd># sudo ksmbd.control -d “smb”</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Show what prints are enabled.</dt>
<dd><dl class="first last docutils">
<dt># cat /sys/class/ksmbd-control/debug</dt>
<dd>[smb] auth vfs oplock ipc conn [rdma]</dd>
</dl>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Disable prints:</dt>
<dd>If you try the selected component once more, It is disabled without brackets.</dd>
</dl>
</li>
</ol>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cifsroot.html" class="btn btn-neutral float-right" title="Mounting root file system via SMB (cifs.ko)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="CIFS" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
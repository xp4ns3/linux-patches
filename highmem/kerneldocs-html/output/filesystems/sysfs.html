

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>sysfs - _The_ filesystem for exporting kernel objects &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Filesystems in the Linux kernel" href="index.html"/>
        <link rel="next" title="SystemV Filesystem" href="sysv-fs.html"/>
        <link rel="prev" title="Squashfs 4.0 Filesystem" href="squashfs.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Filesystems in the Linux kernel</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#core-vfs-documentation">Core VFS documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#filesystem-support-layers">Filesystem support layers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#filesystems">Filesystems</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="9p.html">v9fs: Plan 9 Resource Sharing for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="adfs.html">Acorn Disc Filing System - ADFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="affs.html">Overview of Amiga Filesystems</a></li>
<li class="toctree-l3"><a class="reference internal" href="afs.html">kAFS: AFS FILESYSTEM</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofs.html">autofs - how it works</a></li>
<li class="toctree-l3"><a class="reference internal" href="autofs-mount-control.html">Miscellaneous Device control operations for the autofs kernel module</a></li>
<li class="toctree-l3"><a class="reference internal" href="befs.html">BeOS filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="bfs.html">BFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="btrfs.html">BTRFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="cifs/index.html">CIFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ceph.html">Ceph Distributed File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="coda.html">Coda Kernel-Venus Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="configfs.html">Configfs - Userspace-driven Kernel Object Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cramfs.html">Cramfs - cram a filesystem onto a small ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="dax.html">Direct Access for files</a></li>
<li class="toctree-l3"><a class="reference internal" href="debugfs.html">DebugFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="dlmfs.html">DLMFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ecryptfs.html">eCryptfs: A stacked cryptographic filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="efivarfs.html">efivarfs - a (U)EFI variable filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="erofs.html">Enhanced Read-Only File System - EROFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext2.html">The Second Extended Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext3.html">Ext3 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ext4/index.html">ext4 Data Structures and Algorithms</a></li>
<li class="toctree-l3"><a class="reference internal" href="f2fs.html">WHAT IS Flash-Friendly File System (F2FS)?</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2.html">Global File System 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2-uevents.html">uevents and GFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="gfs2-glocks.html">Glock internal locking rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="hfs.html">Macintosh HFS Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="hfsplus.html">Macintosh HFSPlus Filesystem for Linux</a></li>
<li class="toctree-l3"><a class="reference internal" href="hpfs.html">Read/Write HPFS 2.09</a></li>
<li class="toctree-l3"><a class="reference internal" href="fuse.html">FUSE</a></li>
<li class="toctree-l3"><a class="reference internal" href="fuse-io.html">Fuse I/O Modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="inotify.html">Inotify - A Powerful yet Simple File Change Notification System</a></li>
<li class="toctree-l3"><a class="reference internal" href="isofs.html">ISO9660 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="nilfs2.html">NILFS2</a></li>
<li class="toctree-l3"><a class="reference internal" href="nfs/index.html">NFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntfs.html">The Linux NTFS filesystem driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="ntfs3.html">NTFS3</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocfs2.html">OCFS2 filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ocfs2-online-filecheck.html">OCFS2 file system - online file check</a></li>
<li class="toctree-l3"><a class="reference internal" href="omfs.html">Optimized MPEG Filesystem (OMFS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="orangefs.html">ORANGEFS</a></li>
<li class="toctree-l3"><a class="reference internal" href="overlayfs.html">Overlay Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="proc.html">The /proc Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="qnx6.html">The QNX6 Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="ramfs-rootfs-initramfs.html">Ramfs, rootfs and initramfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="relay.html">relay interface (formerly relayfs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="romfs.html">ROMFS - ROM File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="spufs/index.html">SPU Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="squashfs.html">Squashfs 4.0 Filesystem</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">sysfs - _The_ filesystem for exporting kernel objects</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#what-it-is">What it is:</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-sysfs">Using sysfs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#directory-creation">Directory Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#attributes">Attributes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#subsystem-specific-callbacks">Subsystem-Specific Callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reading-writing-attribute-data">Reading/Writing Attribute Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#top-level-directory-layout">Top Level Directory Layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#current-interfaces">Current Interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sysv-fs.html">SystemV Filesystem</a></li>
<li class="toctree-l3"><a class="reference internal" href="tmpfs.html">Tmpfs</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubifs.html">UBI File System</a></li>
<li class="toctree-l3"><a class="reference internal" href="ubifs-authentication.html">UBIFS Authentication Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="udf.html">UDF file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="virtiofs.html">virtiofs: virtio-fs host&lt;-&gt;guest shared file system</a></li>
<li class="toctree-l3"><a class="reference internal" href="vfat.html">VFAT</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfs-delayed-logging-design.html">XFS Delayed Logging Design</a></li>
<li class="toctree-l3"><a class="reference internal" href="xfs-self-describing-metadata.html">XFS Self Describing Metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="zonefs.html">ZoneFS - Zone filesystem for Zoned block devices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Filesystems in the Linux kernel</a> &raquo;</li>
        
      <li>sysfs - _The_ filesystem for exporting kernel objects</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/filesystems/sysfs.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sysfs-the-filesystem-for-exporting-kernel-objects">
<h1>sysfs - _The_ filesystem for exporting kernel objects<a class="headerlink" href="#sysfs-the-filesystem-for-exporting-kernel-objects" title="Permalink to this headline">¶</a></h1>
<p>Patrick Mochel  &lt;<a class="reference external" href="mailto:mochel&#37;&#52;&#48;osdl&#46;org">mochel<span>&#64;</span>osdl<span>&#46;</span>org</a>&gt;</p>
<p>Mike Murphy &lt;<a class="reference external" href="mailto:mamurph&#37;&#52;&#48;cs&#46;clemson&#46;edu">mamurph<span>&#64;</span>cs<span>&#46;</span>clemson<span>&#46;</span>edu</a>&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Revised:</th><td class="field-body">16 August 2011</td>
</tr>
<tr class="field-even field"><th class="field-name">Original:</th><td class="field-body">10 January 2003</td>
</tr>
</tbody>
</table>
<div class="section" id="what-it-is">
<h2>What it is:<a class="headerlink" href="#what-it-is" title="Permalink to this headline">¶</a></h2>
<p>sysfs is a ram-based filesystem initially based on ramfs. It provides
a means to export kernel data structures, their attributes, and the
linkages between them to userspace.</p>
<p>sysfs is tied inherently to the kobject infrastructure. Please read
<a class="reference internal" href="../core-api/kobject.html"><span class="doc">Everything you never wanted to know about kobjects, ksets, and ktypes</span></a> for more information concerning the kobject
interface.</p>
</div>
<div class="section" id="using-sysfs">
<h2>Using sysfs<a class="headerlink" href="#using-sysfs" title="Permalink to this headline">¶</a></h2>
<p>sysfs is always compiled in if CONFIG_SYSFS is defined. You can access
it by doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mount -t sysfs sysfs /sys
</pre></div>
</div>
</div>
<div class="section" id="directory-creation">
<h2>Directory Creation<a class="headerlink" href="#directory-creation" title="Permalink to this headline">¶</a></h2>
<p>For every kobject that is registered with the system, a directory is
created for it in sysfs. That directory is created as a subdirectory
of the kobject’s parent, expressing internal object hierarchies to
userspace. Top-level directories in sysfs represent the common
ancestors of object hierarchies; i.e. the subsystems the objects
belong to.</p>
<p>Sysfs internally stores a pointer to the kobject that implements a
directory in the kernfs_node object associated with the directory. In
the past this kobject pointer has been used by sysfs to do reference
counting directly on the kobject whenever the file is opened or closed.
With the current sysfs implementation the kobject reference count is
only modified directly by the function sysfs_schedule_callback().</p>
</div>
<div class="section" id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>Attributes can be exported for kobjects in the form of regular files in
the filesystem. Sysfs forwards file I/O operations to methods defined
for the attributes, providing a means to read and write kernel
attributes.</p>
<p>Attributes should be ASCII text files, preferably with only one value
per file. It is noted that it may not be efficient to contain only one
value per file, so it is socially acceptable to express an array of
values of the same type.</p>
<p>Mixing types, expressing multiple lines of data, and doing fancy
formatting of data is heavily frowned upon. Doing these things may get
you publicly humiliated and your code rewritten without notice.</p>
<p>An attribute definition is simply:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct attribute {
        char                    * name;
        struct module               *owner;
        umode_t                 mode;
};


int sysfs_create_file(struct kobject * kobj, const struct attribute * attr);
void sysfs_remove_file(struct kobject * kobj, const struct attribute * attr);
</pre></div>
</div>
<p>A bare attribute contains no means to read or write the value of the
attribute. Subsystems are encouraged to define their own attribute
structure and wrapper functions for adding and removing attributes for
a specific object type.</p>
<p>For example, the driver model defines struct device_attribute like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct device_attribute {
        struct attribute    attr;
        ssize_t (*show)(struct device *dev, struct device_attribute *attr,
                        char *buf);
        ssize_t (*store)(struct device *dev, struct device_attribute *attr,
                        const char *buf, size_t count);
};

int device_create_file(struct device *, const struct device_attribute *);
void device_remove_file(struct device *, const struct device_attribute *);
</pre></div>
</div>
<p>It also defines this helper for defining device attributes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define DEVICE_ATTR(_name, _mode, _show, _store) \
struct device_attribute dev_attr_##_name = __ATTR(_name, _mode, _show, _store)
</pre></div>
</div>
<p>For example, declaring:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static DEVICE_ATTR(foo, S_IWUSR | S_IRUGO, show_foo, store_foo);
</pre></div>
</div>
<p>is equivalent to doing:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static struct device_attribute dev_attr_foo = {
        .attr = {
                .name = &quot;foo&quot;,
                .mode = S_IWUSR | S_IRUGO,
        },
        .show = show_foo,
        .store = store_foo,
};
</pre></div>
</div>
<p>Note as stated in include/linux/kernel.h “OTHER_WRITABLE?  Generally
considered a bad idea.” so trying to set a sysfs file writable for
everyone will fail reverting to RO mode for “Others”.</p>
<p>For the common cases sysfs.h provides convenience macros to make
defining attributes easier as well as making code more concise and
readable. The above case could be shortened to:</p>
<p>static struct device_attribute dev_attr_foo = __ATTR_RW(foo);</p>
<p>the list of helpers available to define your wrapper function is:</p>
<dl class="docutils">
<dt>__ATTR_RO(name):</dt>
<dd>assumes default name_show and mode 0444</dd>
<dt>__ATTR_WO(name):</dt>
<dd>assumes a name_store only and is restricted to mode
0200 that is root write access only.</dd>
<dt>__ATTR_RO_MODE(name, mode):</dt>
<dd>fore more restrictive RO access currently
only use case is the EFI System Resource Table
(see drivers/firmware/efi/esrt.c)</dd>
<dt>__ATTR_RW(name):</dt>
<dd>assumes default name_show, name_store and setting
mode to 0644.</dd>
<dt>__ATTR_NULL:</dt>
<dd>which sets the name to NULL and is used as end of list
indicator (see: kernel/workqueue.c)</dd>
</dl>
</div>
<div class="section" id="subsystem-specific-callbacks">
<h2>Subsystem-Specific Callbacks<a class="headerlink" href="#subsystem-specific-callbacks" title="Permalink to this headline">¶</a></h2>
<p>When a subsystem defines a new attribute type, it must implement a
set of sysfs operations for forwarding read and write calls to the
show and store methods of the attribute owners:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct sysfs_ops {
        ssize_t (*show)(struct kobject *, struct attribute *, char *);
        ssize_t (*store)(struct kobject *, struct attribute *, const char *, size_t);
};
</pre></div>
</div>
<p>[ Subsystems should have already defined a struct kobj_type as a
descriptor for this type, which is where the sysfs_ops pointer is
stored. See the kobject documentation for more information. ]</p>
<p>When a file is read or written, sysfs calls the appropriate method
for the type. The method then translates the generic struct kobject
and struct attribute pointers to the appropriate pointer types, and
calls the associated methods.</p>
<p>To illustrate:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#define to_dev_attr(_attr) container_of(_attr, struct device_attribute, attr)

static ssize_t dev_attr_show(struct kobject *kobj, struct attribute *attr,
                            char *buf)
{
        struct device_attribute *dev_attr = to_dev_attr(attr);
        struct device *dev = kobj_to_dev(kobj);
        ssize_t ret = -EIO;

        if (dev_attr-&gt;show)
                ret = dev_attr-&gt;show(dev, dev_attr, buf);
        if (ret &gt;= (ssize_t)PAGE_SIZE) {
                printk(&quot;dev_attr_show: %pS returned bad count\n&quot;,
                                dev_attr-&gt;show);
        }
        return ret;
}
</pre></div>
</div>
</div>
<div class="section" id="reading-writing-attribute-data">
<h2>Reading/Writing Attribute Data<a class="headerlink" href="#reading-writing-attribute-data" title="Permalink to this headline">¶</a></h2>
<p>To read or write attributes, show() or store() methods must be
specified when declaring the attribute. The method types should be as
simple as those defined for device attributes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ssize_t (*show)(struct device *dev, struct device_attribute *attr, char *buf);
ssize_t (*store)(struct device *dev, struct device_attribute *attr,
                const char *buf, size_t count);
</pre></div>
</div>
<p>IOW, they should take only an object, an attribute, and a buffer as parameters.</p>
<p>sysfs allocates a buffer of size (PAGE_SIZE) and passes it to the
method. Sysfs will call the method exactly once for each read or
write. This forces the following behavior on the method
implementations:</p>
<ul>
<li><p class="first">On read(2), the show() method should fill the entire buffer.
Recall that an attribute should only be exporting one value, or an
array of similar values, so this shouldn’t be that expensive.</p>
<p>This allows userspace to do partial reads and forward seeks
arbitrarily over the entire file at will. If userspace seeks back to
zero or does a pread(2) with an offset of ‘0’ the show() method will
be called again, rearmed, to fill the buffer.</p>
</li>
<li><p class="first">On write(2), sysfs expects the entire buffer to be passed during the
first write. Sysfs then passes the entire buffer to the store() method.
A terminating null is added after the data on stores. This makes
functions like <a class="reference internal" href="../core-api/kernel-api.html#c.sysfs_streq" title="sysfs_streq"><code class="xref c c-func docutils literal notranslate"><span class="pre">sysfs_streq()</span></code></a> safe to use.</p>
<p>When writing sysfs files, userspace processes should first read the
entire file, modify the values it wishes to change, then write the
entire buffer back.</p>
<p>Attribute method implementations should operate on an identical
buffer when reading and writing values.</p>
</li>
</ul>
<p>Other notes:</p>
<ul class="simple">
<li>Writing causes the show() method to be rearmed regardless of current
file position.</li>
<li>The buffer will always be PAGE_SIZE bytes in length. On i386, this
is 4096.</li>
<li>show() methods should return the number of bytes printed into the
buffer.</li>
<li>show() should only use <a class="reference internal" href="api-summary.html#c.sysfs_emit" title="sysfs_emit"><code class="xref c c-func docutils literal notranslate"><span class="pre">sysfs_emit()</span></code></a> or <a class="reference internal" href="api-summary.html#c.sysfs_emit_at" title="sysfs_emit_at"><code class="xref c c-func docutils literal notranslate"><span class="pre">sysfs_emit_at()</span></code></a> when formatting
the value to be returned to user space.</li>
<li>store() should return the number of bytes used from the buffer. If the
entire buffer has been used, just return the count argument.</li>
<li>show() or store() can always return errors. If a bad value comes
through, be sure to return an error.</li>
<li>The object passed to the methods will be pinned in memory via sysfs
referencing counting its embedded object. However, the physical
entity (e.g. device) the object represents may not be present. Be
sure to have a way to check this, if necessary.</li>
</ul>
<p>A very simple (and naive) implementation of a device attribute is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static ssize_t show_name(struct device *dev, struct device_attribute *attr,
                        char *buf)
{
        return scnprintf(buf, PAGE_SIZE, &quot;%s\n&quot;, dev-&gt;name);
}

static ssize_t store_name(struct device *dev, struct device_attribute *attr,
                        const char *buf, size_t count)
{
        snprintf(dev-&gt;name, sizeof(dev-&gt;name), &quot;%.*s&quot;,
                (int)min(count, sizeof(dev-&gt;name) - 1), buf);
        return count;
}

static DEVICE_ATTR(name, S_IRUGO, show_name, store_name);
</pre></div>
</div>
<p>(Note that the real implementation doesn’t allow userspace to set the
name for a device.)</p>
</div>
<div class="section" id="top-level-directory-layout">
<h2>Top Level Directory Layout<a class="headerlink" href="#top-level-directory-layout" title="Permalink to this headline">¶</a></h2>
<p>The sysfs directory arrangement exposes the relationship of kernel
data structures.</p>
<p>The top level sysfs directory looks like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>block/
bus/
class/
dev/
devices/
firmware/
net/
fs/
</pre></div>
</div>
<p>devices/ contains a filesystem representation of the device tree. It maps
directly to the internal kernel device tree, which is a hierarchy of
<a class="reference internal" href="../driver-api/infrastructure.html#c.device" title="device"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">device</span></code></a>.</p>
<p>bus/ contains flat directory layout of the various bus types in the
kernel. Each bus’s directory contains two subdirectories:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>devices/
drivers/
</pre></div>
</div>
<p>devices/ contains symlinks for each device discovered in the system
that point to the device’s directory under root/.</p>
<p>drivers/ contains a directory for each device driver that is loaded
for devices on that particular bus (this assumes that drivers do not
span multiple bus types).</p>
<p>fs/ contains a directory for some filesystems.  Currently each
filesystem wanting to export attributes must create its own hierarchy
below fs/ (see ./fuse.txt for an example).</p>
<p>dev/ contains two directories char/ and block/. Inside these two
directories there are symlinks named &lt;major&gt;:&lt;minor&gt;.  These symlinks
point to the sysfs directory for the given device.  /sys/dev provides a
quick way to lookup the sysfs interface for a device from the result of
a stat(2) operation.</p>
<p>More information can driver-model specific features can be found in
Documentation/driver-api/driver-model/.</p>
<p>TODO: Finish this section.</p>
</div>
<div class="section" id="current-interfaces">
<h2>Current Interfaces<a class="headerlink" href="#current-interfaces" title="Permalink to this headline">¶</a></h2>
<p>The following interface layers currently exist in sysfs:</p>
<div class="section" id="devices-include-linux-device-h">
<h3>devices (include/linux/device.h)<a class="headerlink" href="#devices-include-linux-device-h" title="Permalink to this headline">¶</a></h3>
<p>Structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct device_attribute {
        struct attribute    attr;
        ssize_t (*show)(struct device *dev, struct device_attribute *attr,
                        char *buf);
        ssize_t (*store)(struct device *dev, struct device_attribute *attr,
                        const char *buf, size_t count);
};
</pre></div>
</div>
<p>Declaring:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DEVICE_ATTR(_name, _mode, _show, _store);
</pre></div>
</div>
<p>Creation/Removal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int device_create_file(struct device *dev, const struct device_attribute * attr);
void device_remove_file(struct device *dev, const struct device_attribute * attr);
</pre></div>
</div>
</div>
<div class="section" id="bus-drivers-include-linux-device-h">
<h3>bus drivers (include/linux/device.h)<a class="headerlink" href="#bus-drivers-include-linux-device-h" title="Permalink to this headline">¶</a></h3>
<p>Structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct bus_attribute {
        struct attribute        attr;
        ssize_t (*show)(struct bus_type *, char * buf);
        ssize_t (*store)(struct bus_type *, const char * buf, size_t count);
};
</pre></div>
</div>
<p>Declaring:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static BUS_ATTR_RW(name);
static BUS_ATTR_RO(name);
static BUS_ATTR_WO(name);
</pre></div>
</div>
<p>Creation/Removal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int bus_create_file(struct bus_type *, struct bus_attribute *);
void bus_remove_file(struct bus_type *, struct bus_attribute *);
</pre></div>
</div>
</div>
<div class="section" id="device-drivers-include-linux-device-h">
<h3>device drivers (include/linux/device.h)<a class="headerlink" href="#device-drivers-include-linux-device-h" title="Permalink to this headline">¶</a></h3>
<p>Structure:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct driver_attribute {
        struct attribute        attr;
        ssize_t (*show)(struct device_driver *, char * buf);
        ssize_t (*store)(struct device_driver *, const char * buf,
                        size_t count);
};
</pre></div>
</div>
<p>Declaring:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DRIVER_ATTR_RO(_name)
DRIVER_ATTR_RW(_name)
</pre></div>
</div>
<p>Creation/Removal:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>int driver_create_file(struct device_driver *, const struct driver_attribute *);
void driver_remove_file(struct device_driver *, const struct driver_attribute *);
</pre></div>
</div>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>The sysfs directory structure and the attributes in each directory define an
ABI between the kernel and user space. As for any ABI, it is important that
this ABI is stable and properly documented. All new sysfs attributes must be
documented in Documentation/ABI. See also Documentation/ABI/README for more
information.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="sysv-fs.html" class="btn btn-neutral float-right" title="SystemV Filesystem" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="squashfs.html" class="btn btn-neutral" title="Squashfs 4.0 Filesystem" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>详细用法 &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../../../../index.html"/>
        <link rel="up" title="监测数据访问" href="index.html"/>
        <link rel="next" title="基于DAMON的回收" href="reclaim.html"/>
        <link rel="prev" title="入门指南" href="start.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../../index.html">Translations</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html">中文翻译</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id2">许可证文档</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../index.html#id3">用户文档</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="../../index.html">Linux 内核用户和管理员指南</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id4">固件相关文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id5">应用程序开发人员文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id6">内核开发简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#api">内核API文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id7">体系结构无关文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id8">特定体系结构文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id9">其他文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../index.html#id10">目录和表格</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../../zh_TW/index.html">繁體中文翻譯</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../it_IT/index.html">Traduzione italiana</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ko_KR/index.html">한국어 번역</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../ja_JP/index.html">Japanese translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../../index.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../../index.html">Translations</a> &raquo;</li>
        
          <li><a href="../../../index.html">中文翻译</a> &raquo;</li>
        
          <li><a href="../../index.html">Linux 内核用户和管理员指南</a> &raquo;</li>
        
          <li><a href="../index.html">内存管理</a> &raquo;</li>
        
          <li><a href="index.html">监测数据访问</a> &raquo;</li>
        
      <li>详细用法</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../../../_sources/translations/zh_CN/admin-guide/mm/damon/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">此文件的目的是为让中文读者更容易阅读和理解，而不是作为一个分支。 因此，
如果您对此文件有任何意见或更新，请先尝试更新原始英文文件。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果您发现本文档与原始文件有任何不同或者有翻译问题，请联系该文件的译者，
或者请求时奎亮的帮助：&lt;<a class="reference external" href="mailto:alexs&#37;&#52;&#48;kernel&#46;org">alexs<span>&#64;</span>kernel<span>&#46;</span>org</a>&gt;。</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Original:</th><td class="field-body"><a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html"><span class="doc">Detailed Usages</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">翻译:</th><td class="field-body">司延腾 Yanteng Si &lt;<a class="reference external" href="mailto:siyanteng&#37;&#52;&#48;loongson&#46;cn">siyanteng<span>&#64;</span>loongson<span>&#46;</span>cn</a>&gt;</td>
</tr>
<tr class="field-odd field"><th class="field-name">校译:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
<div class="section" id="id1">
<h1>详细用法<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>DAMON 为不同的用户提供了下面三种接口。</p>
<ul class="simple">
<li><em>DAMON用户空间工具。</em>
<a class="reference external" href="https://github.com/awslabs/damo">这</a> 为有这特权的人， 如系统管理员，希望有一个刚好
可以工作的人性化界面。
使用它，用户可以以人性化的方式使用DAMON的主要功能。不过，它可能不会为特殊情况进行高度调整。
它同时支持虚拟和物理地址空间的监测。更多细节，请参考它的 <a class="reference external" href="https://github.com/awslabs/damo/blob/next/USAGE.md">使用文档</a>。</li>
<li><em>debugfs接口。</em>
<a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#debugfs-interface"><span class="std std-ref">这</span></a> 是为那些希望更高级的使用DAMON的特权用户空间程序员准备的。
使用它，用户可以通过读取和写入特殊的debugfs文件来使用DAMON的主要功能。因此，你可以编写和使
用你个性化的DAMON debugfs包装程序，代替你读/写debugfs文件。  <a class="reference external" href="https://github.com/awslabs/damo">DAMON用户空间工具</a> 就是这种程序的一个例子  它同时支持虚拟和物理地址
空间的监测。注意，这个界面只提供简单的监测结果 <a class="reference internal" href="../../../../../admin-guide/mm/damon/usage.html#damos-stats"><span class="std std-ref">统计</span></a>。对于详细的监测
结果，DAMON提供了一个:ref:<cite>跟踪点 &lt;tracepoint&gt;</cite>。</li>
<li><em>内核空间编程接口。</em>
<a class="reference internal" href="../../../../../vm/damon/api.html"><span class="doc">This</span></a> 这是为内核空间程序员准备的。使用它，用户可以通过为你编写内
核空间的DAMON应用程序，最灵活有效地利用DAMON的每一个功能。你甚至可以为各种地址空间扩展DAMON。
详细情况请参考接口 <a class="reference internal" href="../../../../../vm/damon/api.html"><span class="doc">文件</span></a>。</li>
</ul>
<div class="section" id="debugfs">
<h2>debugfs接口<a class="headerlink" href="#debugfs" title="Permalink to this headline">¶</a></h2>
<p>DAMON导出了八个文件, <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, <code class="docutils literal notranslate"><span class="pre">target_ids</span></code>, <code class="docutils literal notranslate"><span class="pre">init_regions</span></code>,
<code class="docutils literal notranslate"><span class="pre">schemes</span></code>, <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code>, <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code>, <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 和
<code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> under its debugfs directory, <code class="docutils literal notranslate"><span class="pre">&lt;debugfs&gt;/damon/</span></code>.</p>
<div class="section" id="id4">
<h3>属性<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>用户可以通过读取和写入 <code class="docutils literal notranslate"><span class="pre">attrs</span></code> 文件获得和设置 <code class="docutils literal notranslate"><span class="pre">采样间隔</span></code> 、 <code class="docutils literal notranslate"><span class="pre">聚集间隔</span></code> 、 <code class="docutils literal notranslate"><span class="pre">区域更新间隔</span></code>
以及监测目标区域的最小/最大数量。要详细了解监测属性，请参考 <cite>:doc:/vm/damon/design</cite> 。例如，
下面的命令将这些值设置为5ms、100ms、1000ms、10和1000，然后再次检查:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 5000 100000 1000000 10 1000 &gt; attrs
# cat attrs
5000 100000 1000000 10 1000
</pre></div>
</div>
</div>
<div class="section" id="id">
<h3>目标ID<a class="headerlink" href="#id" title="Permalink to this headline">¶</a></h3>
<p>一些类型的地址空间支持多个监测目标。例如，虚拟内存地址空间的监测可以有多个进程作为监测目标。用户
可以通过写入目标的相关id值来设置目标，并通过读取 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 文件来获得当前目标的id。在监
测虚拟地址空间的情况下，这些值应该是监测目标进程的pid。例如，下面的命令将pid为42和4242的进程设
为监测目标，并再次检查:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo 42 4242 &gt; target_ids
# cat target_ids
42 4242
</pre></div>
</div>
<p>用户还可以通过在文件中写入一个特殊的关键字 “paddrn” 来监测系统的物理内存地址空间。因为物理地
址空间监测不支持多个目标，读取文件会显示一个假值，即 <code class="docutils literal notranslate"><span class="pre">42</span></code> ，如下图所示:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo paddr &gt; target_ids
# cat target_ids
42
</pre></div>
</div>
<p>请注意，设置目标ID并不启动监测。</p>
</div>
<div class="section" id="id5">
<h3>初始监测目标区域<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>在虚拟地址空间监测的情况下，DAMON自动设置和更新监测的目标区域，这样就可以覆盖目标进程的整个
内存映射。然而，用户可能希望将监测区域限制在特定的地址范围内，如堆、栈或特定的文件映射区域。
或者，一些用户可以知道他们工作负载的初始访问模式，因此希望为“自适应区域调整”设置最佳初始区域。</p>
<p>相比之下，DAMON在物理内存监测的情况下不会自动设置和更新监测目标区域。因此，用户应该自己设置
监测目标区域。</p>
<p>在这种情况下，用户可以通过在 <code class="docutils literal notranslate"><span class="pre">init_regions</span></code> 文件中写入适当的值，明确地设置他们想要的初
始监测目标区域。输入的每一行应代表一个区域，形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target idx&gt; &lt;start address&gt; &lt;end address&gt;
</pre></div>
</div>
<p>目标idx应该是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 文件中目标的索引，从 <code class="docutils literal notranslate"><span class="pre">0</span></code> 开始，区域应该按照地址顺序传递。
例如，下面的命令将设置几个地址范围， <code class="docutils literal notranslate"><span class="pre">1-100</span></code> 和 <code class="docutils literal notranslate"><span class="pre">100-200</span></code> 作为pid 42的初始监测目标
区域，这是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 中的第一个（索引 <code class="docutils literal notranslate"><span class="pre">0</span></code> ），另外几个地址范围， <code class="docutils literal notranslate"><span class="pre">20-40</span></code> 和
<code class="docutils literal notranslate"><span class="pre">50-100</span></code> 作为pid 4242的地址，这是 <code class="docutils literal notranslate"><span class="pre">target_ids</span></code> 中的第二个（索引 <code class="docutils literal notranslate"><span class="pre">1</span></code> ）:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat target_ids
42 4242
# echo &quot;0   1       100
        0   100     200
        1   20      40
        1   50      100&quot; &gt; init_regions
</pre></div>
</div>
<p>请注意，这只是设置了初始的监测目标区域。在虚拟内存监测的情况下，DAMON会在一个 <code class="docutils literal notranslate"><span class="pre">区域更新间隔</span></code>
后自动更新区域的边界。因此，在这种情况下，如果用户不希望更新的话，应该把 <code class="docutils literal notranslate"><span class="pre">区域的更新间隔</span></code> 设
置得足够大。</p>
</div>
<div class="section" id="id6">
<h3>方案<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>对于通常的基于DAMON的数据访问感知的内存管理优化，用户只是希望系统对特定访问模式的内存区域应用内
存管理操作。DAMON从用户那里接收这种形式化的操作方案，并将这些方案应用到目标进程中。</p>
<p>用户可以通过读取和写入 <code class="docutils literal notranslate"><span class="pre">scheme</span></code> debugfs文件来获得和设置这些方案。读取该文件还可以显示每个
方案的统计数据。在文件中，每一个方案都应该在每一行中以下列形式表示出来:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;target access pattern&gt; &lt;action&gt; &lt;quota&gt; &lt;watermarks&gt;
</pre></div>
</div>
<p>你可以通过简单地在文件中写入一个空字符串来禁用方案。</p>
<div class="section" id="id7">
<h4>目标访问模式<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&lt;目标访问模式&gt;</span></code> 是由三个范围构成的，形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>min-size max-size min-acc max-acc min-age max-age
</pre></div>
</div>
<p>具体来说，区域大小的字节数（ <cite>min-size</cite> 和 <cite>max-size</cite> ），访问频率的每聚合区间的监测访问次
数（ <cite>min-acc</cite> 和 <cite>max-acc</cite> ），区域年龄的聚合区间数（ <cite>min-age</cite> 和 <cite>max-age</cite> ）都被指定。
请注意，这些范围是封闭区间。</p>
</div>
<div class="section" id="id8">
<h4>动作<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">&lt;action&gt;</span></code> 是一个预定义的内存管理动作的整数，DAMON将应用于具有目标访问模式的区域。支持
的数字和它们的含义如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>- 0: Call ``madvise()`` for the region with ``MADV_WILLNEED``
- 1: Call ``madvise()`` for the region with ``MADV_COLD``
- 2: Call ``madvise()`` for the region with ``MADV_PAGEOUT``
- 3: Call ``madvise()`` for the region with ``MADV_HUGEPAGE``
- 4: Call ``madvise()`` for the region with ``MADV_NOHUGEPAGE``
- 5: Do nothing but count the statistics
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>配额<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>每个 <code class="docutils literal notranslate"><span class="pre">动作</span></code> 的最佳 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 取决于工作负载，所以不容易找到。更糟糕的是，将某个
动作的方案设置得过于激进会导致严重的开销。为了避免这种开销，用户可以通过下面表格中的 <code class="docutils literal notranslate"><span class="pre">&lt;quota&gt;</span></code>
来限制方案的时间和大小配额:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;ms&gt; &lt;sz&gt; &lt;reset interval&gt; &lt;priority weights&gt;
</pre></div>
</div>
<p>这使得DAMON在 <code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code> 毫秒内，尽量只用 <code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> 毫秒的时间对 <code class="docutils literal notranslate"><span class="pre">目标访</span>
<span class="pre">问模式</span></code> 的内存区域应用动作，并在 <code class="docutils literal notranslate"><span class="pre">&lt;reset</span> <span class="pre">interval&gt;</span></code> 内只对最多&lt;sz&gt;字节的内存区域应
用动作。将 <code class="docutils literal notranslate"><span class="pre">&lt;ms&gt;</span></code> 和 <code class="docutils literal notranslate"><span class="pre">&lt;sz&gt;</span></code> 都设置为零，可以禁用配额限制。</p>
<p>当预计超过配额限制时，DAMON会根据 <code class="docutils literal notranslate"><span class="pre">目标访问模式</span></code> 的大小、访问频率和年龄，对发现的内存
区域进行优先排序。为了实现个性化的优先级，用户可以在 <code class="docutils literal notranslate"><span class="pre">&lt;优先级权重&gt;</span></code> 中设置这三个属性的
权重，具体形式如下:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;size weight&gt; &lt;access frequency weight&gt; &lt;age weight&gt;
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>水位<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>有些方案需要根据系统特定指标的当前值来运行，如自由内存比率。对于这种情况，用户可以为该条
件指定水位。:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;metric&gt; &lt;check interval&gt; &lt;high mark&gt; &lt;middle mark&gt; &lt;low mark&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;metric&gt;</span></code> 是一个预定义的整数，用于要检查的度量。支持的数字和它们的含义如下。</p>
<blockquote>
<div><ul class="simple">
<li>0: 忽视水位</li>
<li>1: 系统空闲内存率 (千分比)</li>
</ul>
</div></blockquote>
<p>每隔 <code class="docutils literal notranslate"><span class="pre">&lt;检查间隔&gt;</span></code> 微秒检查一次公制的值。</p>
<p>如果该值高于 <code class="docutils literal notranslate"><span class="pre">&lt;高标&gt;</span></code> 或低于 <code class="docutils literal notranslate"><span class="pre">&lt;低标&gt;</span></code> ，该方案被停用。如果该值低于 <code class="docutils literal notranslate"><span class="pre">&lt;中标&gt;</span></code> ，
该方案将被激活。</p>
</div>
<div class="section" id="id11">
<h4>统计数据<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>它还统计每个方案被尝试应用的区域的总数量和字节数，每个方案被成功应用的区域的两个数量，以
及超过配额限制的总数量。这些统计数据可用于在线分析或调整方案。</p>
<p>统计数据可以通过读取方案文件来显示。读取该文件将显示你在每一行中输入的每个 <code class="docutils literal notranslate"><span class="pre">方案</span></code> ，
统计的五个数字将被加在每一行的末尾。</p>
</div>
<div class="section" id="id12">
<h4>例子<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>下面的命令应用了一个方案：”如果一个大小为[4KiB, 8KiB]的内存区域在[10, 20]的聚合时间
间隔内显示出每一个聚合时间间隔[0, 5]的访问量，请分页出该区域。对于分页，每秒最多只能使
用10ms，而且每秒分页不能超过1GiB。在这一限制下，首先分页出具有较长年龄的内存区域。另外，
每5秒钟检查一次系统的可用内存率，当可用内存率低于50%时开始监测和分页，但如果可用内存率
大于60%，或低于30%，则停止监测“:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# scheme=&quot;4096 8192  0 5    10 20    2&quot;  # target access pattern and action
# scheme+=&quot; 10 $((1024*1024*1024)) 1000&quot; # quotas
# scheme+=&quot; 0 0 100&quot;                     # prioritization weights
# scheme+=&quot; 1 5000000 600 500 300&quot;       # watermarks
# echo &quot;$scheme&quot; &gt; schemes
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3>开关<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>除非你明确地启动监测，否则如上所述的文件设置不会产生效果。你可以通过写入和读取 <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code>
文件来启动、停止和检查监测的当前状态。写入 <code class="docutils literal notranslate"><span class="pre">on</span></code> 该文件可以启动对有属性的目标的监测。写入
<code class="docutils literal notranslate"><span class="pre">off</span></code> 该文件则停止这些目标。如果每个目标进程被终止，DAMON也会停止。下面的示例命令开启、关
闭和检查DAMON的状态:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# echo on &gt; monitor_on
# echo off &gt; monitor_on
# cat monitor_on
off
</pre></div>
</div>
<p>请注意，当监测开启时，你不能写到上述的debugfs文件。如果你在DAMON运行时写到这些文件，将会返
回一个错误代码，如 <code class="docutils literal notranslate"><span class="pre">-EBUSY</span></code> 。</p>
</div>
<div class="section" id="pid">
<h3>监测线程PID<a class="headerlink" href="#pid" title="Permalink to this headline">¶</a></h3>
<p>DAMON通过一个叫做kdamond的内核线程来进行请求监测。你可以通过读取 <code class="docutils literal notranslate"><span class="pre">kdamond_pid</span></code> 文件获
得该线程的 <code class="docutils literal notranslate"><span class="pre">pid</span></code> 。当监测被 <code class="docutils literal notranslate"><span class="pre">关闭</span></code> 时，读取该文件不会返回任何信息:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# cat monitor_on
off
# cat kdamond_pid
none
# echo on &gt; monitor_on
# cat kdamond_pid
18594
</pre></div>
</div>
</div>
<div class="section" id="id14">
<h3>使用多个监测线程<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>每个监测上下文都会创建一个 <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> 线程。你可以使用 <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code>
文件为多个 <code class="docutils literal notranslate"><span class="pre">kdamond</span></code> 需要的用例创建和删除监测上下文。</p>
<p>将新上下文的名称写入 <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 文件，在 <code class="docutils literal notranslate"><span class="pre">DAMON</span> <span class="pre">debugfs</span></code> 目录上创建一个该名称的目录。
该目录将有该上下文的 <code class="docutils literal notranslate"><span class="pre">DAMON</span> <span class="pre">debugfs</span></code> 文件:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># cd &lt;debugfs&gt;/damon
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
# echo foo &gt; mk_contexts
# ls foo
# attrs  init_regions  kdamond_pid  schemes  target_ids
</pre></div>
</div>
<p>如果不再需要上下文，你可以通过把上下文的名字放到 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> 文件中来删除它和相应的目录:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo foo &gt; rm_contexts
# ls foo
# ls: cannot access &#39;foo&#39;: No such file or directory
</pre></div>
</div>
<p>注意， <code class="docutils literal notranslate"><span class="pre">mk_contexts</span></code> 、 <code class="docutils literal notranslate"><span class="pre">rm_contexts</span></code> 和 <code class="docutils literal notranslate"><span class="pre">monitor_on</span></code> 文件只在根目录下。</p>
</div>
</div>
<div class="section" id="id15">
<h2>监测结果的监测点<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h2>
<p>DAMON通过一个tracepoint <code class="docutils literal notranslate"><span class="pre">damon:damon_aggregated</span></code> 提供监测结果.  当监测开启时，你可
以记录追踪点事件，并使用追踪点支持工具如perf显示结果。比如说:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># echo on &gt; monitor_on
# perf record -e damon:damon_aggregated &amp;
# sleep 5
# kill 9 $(pidof perf)
# echo off &gt; monitor_on
# perf script
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reclaim.html" class="btn btn-neutral float-right" title="基于DAMON的回收" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="start.html" class="btn btn-neutral" title="入门指南" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
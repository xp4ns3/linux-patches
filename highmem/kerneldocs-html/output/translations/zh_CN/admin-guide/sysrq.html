

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Linux 魔法系统请求键骇客 &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../../index.html"/>
        <link rel="up" title="Linux 内核用户和管理员指南" href="index.html"/>
        <link rel="next" title="内存管理" href="mm/index.html"/>
        <link rel="prev" title="Unicode（统一码）支持" href="unicode.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Translations</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">中文翻译</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#id2">许可证文档</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#id3">用户文档</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Linux 内核用户和管理员指南</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id4">固件相关文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id5">应用程序开发人员文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id6">内核开发简介</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#api">内核API文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id7">体系结构无关文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id8">特定体系结构文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id9">其他文档</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#id10">目录和表格</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../zh_TW/index.html">繁體中文翻譯</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../it_IT/index.html">Traduzione italiana</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ko_KR/index.html">한국어 번역</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ja_JP/index.html">Japanese translations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../index.html#disclaimer">Disclaimer</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Translations</a> &raquo;</li>
        
          <li><a href="../index.html">中文翻译</a> &raquo;</li>
        
          <li><a href="index.html">Linux 内核用户和管理员指南</a> &raquo;</li>
        
      <li>Linux 魔法系统请求键骇客</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/translations/zh_CN/admin-guide/sysrq.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">此文件的目的是为让中文读者更容易阅读和理解，而不是作为一个分支。 因此，
如果您对此文件有任何意见或更新，请先尝试更新原始英文文件。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">如果您发现本文档与原始文件有任何不同或者有翻译问题，请联系该文件的译者，
或者请求时奎亮的帮助：&lt;<a class="reference external" href="mailto:alexs&#37;&#52;&#48;kernel&#46;org">alexs<span>&#64;</span>kernel<span>&#46;</span>org</a>&gt;。</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Original:</th><td class="field-body"><a class="reference internal" href="../../../admin-guide/sysrq.html"><span class="doc">Linux Magic System Request Key Hacks</span></a></td>
</tr>
<tr class="field-even field"><th class="field-name">翻译:</th><td class="field-body">黄军华 Junhua Huang &lt;<a class="reference external" href="mailto:huang&#46;junhua&#37;&#52;&#48;zte&#46;com&#46;cn">huang<span>&#46;</span>junhua<span>&#64;</span>zte<span>&#46;</span>com<span>&#46;</span>cn</a>&gt;</td>
</tr>
<tr class="field-odd field"><th class="field-name">校译:</th><td class="field-body">司延腾 Yanteng Si &lt;<a class="reference external" href="mailto:siyanteng&#37;&#52;&#48;loongson&#46;cn">siyanteng<span>&#64;</span>loongson<span>&#46;</span>cn</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="section" id="linux">
<span id="cn-admin-guide-sysrq"></span><h1>Linux 魔法系统请求键骇客<a class="headerlink" href="#linux" title="Permalink to this headline">¶</a></h1>
<p>针对 sysrq.c 的文档说明</p>
<div class="section" id="sysrq">
<h2>什么是魔法 SysRq 键？<a class="headerlink" href="#sysrq" title="Permalink to this headline">¶</a></h2>
<p>它是一个你可以输入的具有魔法般的组合键。
无论内核在做什么，内核都会响应 SysRq 键的输入，除非内核完全卡死。</p>
</div>
<div class="section" id="id1">
<h2>如何使能魔法 SysRq 键？<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>在配置内核时，我们需要设置 ‘Magic SysRq key (CONFIG_MAGIC_SYSRQ)’ 为 ‘Y’。
当运行一个编译进 sysrq 功能的内核时，/proc/sys/kernel/sysrq 控制着被
SysRq 键调用的功能许可。这个文件的默认值由 CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE
配置符号设定，文件本身默认设置为 1。以下是 /proc/sys/kernel/sysrq 中可能的
值列表：</p>
<blockquote>
<div><ul>
<li><p class="first">0 - 完全不使能 SysRq 键</p>
</li>
<li><p class="first">1 - 使能 SysRq 键的全部功能</p>
</li>
<li><p class="first">&gt;1 - 对于允许的 SysRq 键功能的比特掩码（参见下面更详细的功能描述）:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  2 =   0x2 - 使能对控制台日志记录级别的控制
  4 =   0x4 - 使能对键盘的控制 (SAK, unraw)
  8 =   0x8 - 使能对进程的调试导出等
 16 =  0x10 - 使能同步命令
 32 =  0x20 - 使能重新挂载只读
 64 =  0x40 - 使能对进程的信号操作 (term, kill, oom-kill)
128 =  0x80 - 允许重启、断电
256 = 0x100 - 允许让所有实时任务变普通任务
</pre></div>
</div>
</li>
</ul>
</div></blockquote>
<p>你可以通过如下命令把值设置到这个文件中:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo &quot;number&quot; &gt;/proc/sys/kernel/sysrq
</pre></div>
</div>
<p>这里被写入的 number 可以是 10 进制数，或者是带着 0x 前缀的 16 进制数。
CONFIG_MAGIC_SYSRQ_DEFAULT_ENABLE 必须是以 16 进制数写入。</p>
<p>注意，<code class="docutils literal notranslate"><span class="pre">/proc/sys/kernel/sysrq</span></code> 的值只影响通过键盘触发 SySRq 的调用，对于
通过 <code class="docutils literal notranslate"><span class="pre">/proc/sysrq-trigger</span></code> 的任何操作调用都是允许的
（通过具有系统权限的用户）。</p>
</div>
<div class="section" id="id2">
<h2>如何使用魔法 SysRq 键？<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>在 x86 架构上</dt>
<dd><p class="first">你可以按下键盘组合键 <kbd class="kbd docutils literal notranslate">ALT-SysRq-&lt;command key&gt;</kbd>。</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">一些键盘可能没有标识 ‘SySRq’ 键。’SySRq’ 键也被当做 ‘Print Screen’键。
同时有些键盘无法处理同时按下这么多键，因此你可以先按下键盘 <kbd class="kbd docutils literal notranslate">Alt</kbd> 键，
然后按下键盘 <kbd class="kbd docutils literal notranslate">SysRq</kbd> 键，再释放键盘 <kbd class="kbd docutils literal notranslate">SysRq</kbd> 键，之后按下键盘上命令键
<kbd class="kbd docutils literal notranslate">&lt;command key&gt;</kbd>，最后释放所有键。</p>
</div>
</dd>
<dt>在 SPARC 架构上</dt>
<dd>你可以按下键盘组合键 <kbd class="kbd docutils literal notranslate">ALT-STOP-&lt;command key&gt;</kbd> 。</dd>
<dt>在串行控制台（只针对 PC 类型的标准串口）</dt>
<dd>你可以发一个 <code class="docutils literal notranslate"><span class="pre">BREAK</span></code> ，然后在 5 秒内发送一个命令键，
发送 <code class="docutils literal notranslate"><span class="pre">BREAK</span></code> 两次将被翻译为一个正常的 BREAK 操作。</dd>
<dt>在 PowerPC 架构上</dt>
<dd>按下键盘组合键 <kbd class="kbd docutils literal notranslate">ALT - Print Screen</kbd> （或者 <kbd class="kbd docutils literal notranslate">F13</kbd>） - <kbd class="kbd docutils literal notranslate">&lt;命令键&gt;</kbd> 。
<kbd class="kbd docutils literal notranslate">Print Screen</kbd> （或者 <kbd class="kbd docutils literal notranslate">F13</kbd>） - <kbd class="kbd docutils literal notranslate">&lt;命令键&gt;</kbd> 或许也能实现。</dd>
<dt>在其他架构上</dt>
<dd>如果你知道其他架构的组合键，请告诉我，我可以把它们添加到这部分。</dd>
<dt>在所有架构上</dt>
<dd><p class="first">写一个字符到 /proc/sysrq-trigger 文件，例如:</p>
<div class="last highlight-none notranslate"><div class="highlight"><pre><span></span>echo t &gt; /proc/sysrq-trigger
</pre></div>
</div>
</dd>
</dl>
<p>这个命令键 <kbd class="kbd docutils literal notranslate">&lt;command key&gt;</kbd> 是区分大小写的。</p>
</div>
<div class="section" id="id3">
<h2>什么是命令键？<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">命令键</th>
<th class="head">功能</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">b</span></code></td>
<td>将立即重启系统，不会同步或者卸载磁盘。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">c</span></code></td>
<td>将执行系统 crash，如果配置了系统 crashdump，将执行 crashdump。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">d</span></code></td>
<td>显示所有持有的锁。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">e</span></code></td>
<td>发送 SIGTERM 信号给所有进程，除了 init 进程。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">f</span></code></td>
<td>将调用 oom killer 杀掉一个过度占用内存的进程，如果什么任务都没杀，
也不会 panic。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">g</span></code></td>
<td>kgdb 使用（内核调试器）。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">h</span></code></td>
<td>将会显示帮助。（实际上除了这里列举的键，其他的都将显示帮助，
但是 <code class="docutils literal notranslate"><span class="pre">h</span></code> 容易记住）:-)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">i</span></code></td>
<td>发送 SIGKILL 给所有进程，除了 init 进程。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">j</span></code></td>
<td>强制性的 “解冻它” - 用于被 FIFREEZE ioctl 操作冻住的文件系统。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">k</span></code></td>
<td>安全访问秘钥(SAK)杀掉在当前虚拟控制台的所有程序，注意：参考
下面 SAK 节重要论述。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">l</span></code></td>
<td>显示所有活动 cpu 的栈回溯。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">m</span></code></td>
<td>将导出当前内存信息到你的控制台。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">n</span></code></td>
<td>用于使所有实时任务变成普通任务。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">o</span></code></td>
<td>将关闭系统（如果配置和支持的话）。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">p</span></code></td>
<td>将导出当前寄存器和标志位到控制台。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">q</span></code></td>
<td>将导出每个 cpu 上所有已装备的高精度定时器（不是完整的
time_list 文件显示的 timers）和所有时钟事件设备的详细信息。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">r</span></code></td>
<td>关闭键盘的原始模式，设置为转换模式。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">s</span></code></td>
<td>将尝试同步所有的已挂载文件系统。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">t</span></code></td>
<td>将导出当前所有任务列表和它们的信息到控制台。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">u</span></code></td>
<td>将尝试重新挂载已挂载文件系统为只读。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">v</span></code></td>
<td>强制恢复帧缓存控制台。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">v</span></code></td>
<td>触发 ETM 缓存导出 [ARM 架构特有]</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">w</span></code></td>
<td>导出处于不可中断状态（阻塞）的任务。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">x</span></code></td>
<td>在 ppc/powerpc 架构上用于 xmon 接口。
在 sparc64 架构上用于显示全局的 PMU（性能监控单元）寄存器。
在 MIPS 架构上导出所有的 tlb 条目。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">y</span></code></td>
<td>显示全局 cpu 寄存器 [SPARC-64 架构特有]</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">z</span></code></td>
<td>导出 ftrace 缓存信息</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0</span></code>-<code class="docutils literal notranslate"><span class="pre">9</span></code></td>
<td>设置控制台日志级别，该级别控制什么样的内核信息将被打印到你的
控制台。（比如 <code class="docutils literal notranslate"><span class="pre">0</span></code> ，将使得只有紧急信息，像 PANICs or OOPSes
才能到你的控制台。）</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id4">
<h2>好了，我能用他们做什么呢？<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>嗯，当你的 X 服务端或者 svgalib 程序崩溃，unraw(r) 非原始模式命令键是非常
方便的。</p>
<p>sak(k)（安全访问秘钥）在你尝试登陆的同时，又想确保当前控制台没有可以获取你的
密码的特洛伊木马程序运行时是有用的。它会杀掉给定控制台的所有程序，这样你
就可以确认当前的登陆提示程序是实际来自 init 进程的程序，而不是某些特洛伊
木马程序。</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">在其实际的形式中，在兼容 C2 安全标准的系统上，它不是一个真正的 SAK，
它也不应该误认为此。</p>
</div>
<p>似乎其他人发现其可以作为（系统终端联机键）当你想退出一个程序，
同时不会让你切换控制台的方法。（比如，X 服务端或者 svgalib 程序）</p>
<p><code class="docutils literal notranslate"><span class="pre">reboot(b)</span></code> 是个好方法，当你不能关闭机器时，它等同于按下”复位”按钮。</p>
<p><code class="docutils literal notranslate"><span class="pre">crash(c)</span></code> 可以用于手动触发一个 crashdump，当系统卡住时。
注意当 crashdump 机制不可用时，这个只是触发一个内核 crash。</p>
<p><code class="docutils literal notranslate"><span class="pre">sync(s)</span></code> 在拔掉可移动介质之前，或者在使用不提供优雅关机的
救援 shell 之后很方便 – 它将确保你的数据被安全地写入磁盘。注意，在你看到
屏幕上出现 “OK” 和 “Done” 之前，同步还没有发生。</p>
<p><code class="docutils literal notranslate"><span class="pre">umount(u)</span></code> 可以用来标记文件系统正常卸载，从正在运行的系统角度来看，它们将
被重新挂载为只读。这个重新挂载动作直到你看到 “OK” 和 “Done” 信息出现在屏幕上
才算完成。</p>
<p>日志级别 <code class="docutils literal notranslate"><span class="pre">0</span></code> - <code class="docutils literal notranslate"><span class="pre">9</span></code> 用于当你的控制台被大量的内核信息冲击，你不想看见的时候。
选择 <code class="docutils literal notranslate"><span class="pre">0</span></code> 将禁止除了最紧急的内核信息外的所有的内核信息输出到控制台。（但是如果
syslogd/klogd 进程是运行的，它们仍将被记录。）</p>
<p><code class="docutils literal notranslate"><span class="pre">term(e)</span></code> 和 <code class="docutils literal notranslate"><span class="pre">kill(i)</span></code> 用于当你有些有点失控的进程，你无法通过其他方式杀掉
它们的时候，特别是它正在创建其他进程。</p>
<p>“just thaw <code class="docutils literal notranslate"><span class="pre">it(j)</span></code> ” 用于当你的系统由于一个 FIFREEZE ioctl 调用而产生的文件
系统冻结，而导致的不响应时。</p>
</div>
<div class="section" id="id5">
<h2>有的时候 SysRq 键在使用它之后，看起来像是“卡住”了，我能做些什么？<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h2>
<p>这也会发生在我这，我发现轻敲键盘两侧的 shift、alt 和 control 键，然后再次敲击
一个无效的 SysRq 键序列可以解决问题。（比如，像键盘组合键 <kbd class="kbd docutils literal notranslate">alt-sysrq-z</kbd> ）
切换到另一个虚拟控制台（键盘操作 <kbd class="kbd docutils literal notranslate">ALT+Fn</kbd> ），然后再切回来应该也有帮助。</p>
</div>
<div class="section" id="id6">
<h2>我敲击了 SysRq 键，但像是什么都没发生，发生了什么错误？<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h2>
<p>有一些键盘对于 SysRq 键设置了不同的键值，而不是提前定义的 99
(查看在 <code class="docutils literal notranslate"><span class="pre">include/uapi/linux/input-event-codes.h</span></code> 文件中 <code class="docutils literal notranslate"><span class="pre">KEY_SYSRQ</span></code> 的定义)
或者就根本没有 SysRq 键。在这些场景下，执行 <code class="docutils literal notranslate"><span class="pre">showkey</span> <span class="pre">-s</span></code> 命令来找到一个合适
的扫描码序列，然后使用 <code class="docutils literal notranslate"><span class="pre">setkeycodes</span> <span class="pre">&lt;sequence&gt;</span> <span class="pre">99</span></code> 命令映射这个序列值到通用
的 SysRq 键编码上（比如 <code class="docutils literal notranslate"><span class="pre">setkeycodes</span> <span class="pre">e05b</span> <span class="pre">99</span></code> ）。最好将这个命令放在启动脚本
中。
哦，顺便说一句，你十秒钟不输入任何东西就将退出 “showkey”。</p>
</div>
<div class="section" id="id7">
<h2>我想添加一个 SysRq 键事件到一个模块中，如何去做呢？<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p>为了注册一个基础函数到这个表中，首先你必须包含 <code class="docutils literal notranslate"><span class="pre">include/linux/sysrq.h</span></code> 头
文件，这个头文件定义了你所需要的所有东西。然后你必须创建一个 <code class="docutils literal notranslate"><span class="pre">sysrq_key_op</span></code>
结构体，然后初始化它，使用如下内容，A） 你将使用的这个键的处理函数， B） 一个
help_msg 字符串，在 SysRq 键打印帮助信息时将打印出来，C） 一个 action_msg 字
符串，就在你的处理函数调用前打印出来。你的处理函数必须符合在 ‘sysrq.h’ 文件中
的函数原型。</p>
<p>在 <code class="docutils literal notranslate"><span class="pre">sysrq_key_op</span></code> 结构体被创建后，你可以调用内核函数
<code class="docutils literal notranslate"><span class="pre">register_sysrq_key(int</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">struct</span> <span class="pre">sysrq_key_op</span> <span class="pre">*op_p);</span></code>，
该函数在表中的 ‘key’ 对应位置内容是空的情况下，将通过 <code class="docutils literal notranslate"><span class="pre">op_p</span></code> 指针注册这个操作
函数到表中 ‘key’ 对应位置上。在模块卸载的时候，你必须调用
<code class="docutils literal notranslate"><span class="pre">unregister_sysrq_key(int</span> <span class="pre">key,</span> <span class="pre">const</span> <span class="pre">struct</span> <span class="pre">sysrq_key_op</span> <span class="pre">*op_p)</span></code> 函数，该函数
只有在当前该键对应的处理函数被注册到了 ‘key’ 对应位置时，才会移除 ‘op_p’ 指针
对应的键值操作函数。这是为了防止在你注册之后，该位置被改写的情况。</p>
<p>魔法 SysRq 键系统的工作原理是将键对应操作函数注册到键的操作查找表，
该表定义在 ‘drivers/tty/sysrq.c’ 文件中。
该键表有许多在编译时候就注册进去的操作函数，但是是可变的。
并且有两个函数作为操作该表的接口被导出:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>register_sysrq_key 和 unregister_sysrq_key.
</pre></div>
</div>
<p>当然，永远不要在表中留下无效指针，即，当你的模块存在调用 register_sysrq_key()
函数，它一定要调用 unregister_sysrq_key() 来清除它使用过的 SysRq 键表条目。
表中的空指针是安全的。:)</p>
<p>如果对于某种原因，在 handle_sysrq 调用的处理函数中，你认为有必要调用
handle_sysrq 函数时，你必须意识到当前你处于一个锁中（你同时也处于一个中断处理
函数中，这意味着不能睡眠）。所以这时你必须使用 <code class="docutils literal notranslate"><span class="pre">__handle_sysrq_nolock</span></code> 替代。</p>
</div>
<div class="section" id="id8">
<h2>当我敲击一个 SysRq 组合键时，只有标题打印出现在控制台？<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h2>
<p>SysRq 键的输出和所有其他控制台输出一样，受制于控制台日志级别控制。
这意味着，如果内核以发行版内核中常见的 “quiet” 方式启动，则输出可能不会出现在实际
的控制台上，即使它会出现在 dmesg 缓存中，也可以通过 dmesg 命令和 <code class="docutils literal notranslate"><span class="pre">/proc/kmsg</span></code>
文件的消费访问到。作为一个特例，来自 sysrq 命令的标题行将被传递给所有控制台
使用者，就好像当前日志级别是最大的一样。如果只发出标题头，则几乎可以肯定内核日志
级别太低。如果你需要控制台上的输出，那么你将需要临时提高控制台日志级别，通过使用
键盘组合键 <kbd class="kbd docutils literal notranslate">alt-sysrq-8</kbd> 或者:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>echo 8 &gt; /proc/sysrq-trigger
</pre></div>
</div>
<p>在触发了你感兴趣的 SysRq 键命令后，记得恢复日志级别到正常情况。</p>
</div>
<div class="section" id="id9">
<h2>我有很多问题时，可以请教谁？<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>请教在内核邮件列表上的人，邮箱：</dt>
<dd><a class="reference external" href="mailto:linux-kernel&#37;&#52;&#48;vger&#46;kernel&#46;org">linux-kernel<span>&#64;</span>vger<span>&#46;</span>kernel<span>&#46;</span>org</a></dd>
</dl>
</div>
<div class="section" id="id10">
<h2>致谢<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Mydraal &lt;<a class="reference external" href="mailto:vulpyne&#37;&#52;&#48;vulpyne&#46;net">vulpyne<span>&#64;</span>vulpyne<span>&#46;</span>net</a>&gt; 撰写了该文件</li>
<li>Adam Sulmicki &lt;<a class="reference external" href="mailto:adam&#37;&#52;&#48;cfar&#46;umd&#46;edu">adam<span>&#64;</span>cfar<span>&#46;</span>umd<span>&#46;</span>edu</a>&gt; 进行了更新</li>
<li>Jeremy M. Dolan &lt;<a class="reference external" href="mailto:jmd&#37;&#52;&#48;turbogeek&#46;org">jmd<span>&#64;</span>turbogeek<span>&#46;</span>org</a>&gt; 在 2001/01/28 10:15:59 进行了更新</li>
<li>Crutcher Dunnavant &lt;<a class="reference external" href="mailto:crutcher+kernel&#37;&#52;&#48;datastacks&#46;com">crutcher+kernel<span>&#64;</span>datastacks<span>&#46;</span>com</a>&gt; 添加键注册部分</li>
</ul>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mm/index.html" class="btn btn-neutral float-right" title="内存管理" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="unicode.html" class="btn btn-neutral" title="Unicode（统一码）支持" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>TEE subsystem &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Unsorted Documentation" href="index.html"/>
        <link rel="next" title="XZ data compression in Linux" href="xz.html"/>
        <link rel="prev" title="Static Keys" href="static-keys.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Unsorted Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="crc32.html">brief tutorial on CRC computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="lzo.html">LZO stream format as understood by Linux’s LZO decompressor</a></li>
<li class="toctree-l2"><a class="reference internal" href="remoteproc.html">Remote Processor Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpmsg.html">Remote Processor Messaging (rpmsg) Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="speculation.html">Speculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="speculation.html#mitigating-speculation-side-channels">Mitigating speculation side-channels</a></li>
<li class="toctree-l2"><a class="reference internal" href="static-keys.html">Static Keys</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">TEE subsystem</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-tee-interface">The TEE interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-tee-kernel-interface">The TEE kernel interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tee-client-driver-example">TEE client driver example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#op-tee-driver">OP-TEE driver</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#op-tee-device-enumeration">OP-TEE device enumeration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#op-tee-notifications">OP-TEE notifications</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#amd-tee-driver">AMD-TEE driver</a></li>
<li class="toctree-l3"><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="xz.html">XZ data compression in Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Unsorted Documentation</a> &raquo;</li>
        
      <li>TEE subsystem</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/staging/tee.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tee-subsystem">
<h1>TEE subsystem<a class="headerlink" href="#tee-subsystem" title="Permalink to this headline">¶</a></h1>
<p>This document describes the TEE subsystem in Linux.</p>
<p>A TEE (Trusted Execution Environment) is a trusted OS running in some
secure environment, for example, TrustZone on ARM CPUs, or a separate
secure co-processor etc. A TEE driver handles the details needed to
communicate with the TEE.</p>
<p>This subsystem deals with:</p>
<ul class="simple">
<li>Registration of TEE drivers</li>
<li>Managing shared memory between Linux and the TEE</li>
<li>Providing a generic API to the TEE</li>
</ul>
<div class="section" id="the-tee-interface">
<h2>The TEE interface<a class="headerlink" href="#the-tee-interface" title="Permalink to this headline">¶</a></h2>
<p>include/uapi/linux/tee.h defines the generic interface to a TEE.</p>
<p>User space (the client) connects to the driver by opening /dev/tee[0-9]* or
/dev/teepriv[0-9]*.</p>
<ul class="simple">
<li>TEE_IOC_SHM_ALLOC allocates shared memory and returns a file descriptor
which user space can mmap. When user space doesn’t need the file
descriptor any more, it should be closed. When shared memory isn’t needed
any longer it should be unmapped with munmap() to allow the reuse of
memory.</li>
<li>TEE_IOC_VERSION lets user space know which TEE this driver handles and
its capabilities.</li>
<li>TEE_IOC_OPEN_SESSION opens a new session to a Trusted Application.</li>
<li>TEE_IOC_INVOKE invokes a function in a Trusted Application.</li>
<li>TEE_IOC_CANCEL may cancel an ongoing TEE_IOC_OPEN_SESSION or TEE_IOC_INVOKE.</li>
<li>TEE_IOC_CLOSE_SESSION closes a session to a Trusted Application.</li>
</ul>
<p>There are two classes of clients, normal clients and supplicants. The latter is
a helper process for the TEE to access resources in Linux, for example file
system access. A normal client opens /dev/tee[0-9]* and a supplicant opens
/dev/teepriv[0-9].</p>
<p>Much of the communication between clients and the TEE is opaque to the
driver. The main job for the driver is to receive requests from the
clients, forward them to the TEE and send back the results. In the case of
supplicants the communication goes in the other direction, the TEE sends
requests to the supplicant which then sends back the result.</p>
</div>
<div class="section" id="the-tee-kernel-interface">
<h2>The TEE kernel interface<a class="headerlink" href="#the-tee-kernel-interface" title="Permalink to this headline">¶</a></h2>
<p>Kernel provides a TEE bus infrastructure where a Trusted Application is
represented as a device identified via Universally Unique Identifier (UUID) and
client drivers register a table of supported device UUIDs.</p>
<p>TEE bus infrastructure registers following APIs:</p>
<dl class="docutils">
<dt>match():</dt>
<dd>iterates over the client driver UUID table to find a corresponding
match for device UUID. If a match is found, then this particular device is
probed via corresponding probe API registered by the client driver. This
process happens whenever a device or a client driver is registered with TEE
bus.</dd>
<dt>uevent():</dt>
<dd>notifies user-space (udev) whenever a new device is registered on
TEE bus for auto-loading of modularized client drivers.</dd>
</dl>
<p>TEE bus device enumeration is specific to underlying TEE implementation, so it
is left open for TEE drivers to provide corresponding implementation.</p>
<p>Then TEE client driver can talk to a matched Trusted Application using APIs
listed in include/linux/tee_drv.h.</p>
<div class="section" id="tee-client-driver-example">
<h3>TEE client driver example<a class="headerlink" href="#tee-client-driver-example" title="Permalink to this headline">¶</a></h3>
<p>Suppose a TEE client driver needs to communicate with a Trusted Application
having UUID: <code class="docutils literal notranslate"><span class="pre">ac6a4085-0e82-4c33-bf98-8eb8e118b6c2</span></code>, so driver registration
snippet would look like:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>static const struct tee_client_device_id client_id_table[] = {
        {UUID_INIT(0xac6a4085, 0x0e82, 0x4c33,
                   0xbf, 0x98, 0x8e, 0xb8, 0xe1, 0x18, 0xb6, 0xc2)},
        {}
};

MODULE_DEVICE_TABLE(tee, client_id_table);

static struct tee_client_driver client_driver = {
        .id_table       = client_id_table,
        .driver         = {
                .name           = DRIVER_NAME,
                .bus            = &amp;tee_bus_type,
                .probe          = client_probe,
                .remove         = client_remove,
        },
};

static int __init client_init(void)
{
        return driver_register(&amp;client_driver.driver);
}

static void __exit client_exit(void)
{
        driver_unregister(&amp;client_driver.driver);
}

module_init(client_init);
module_exit(client_exit);
</pre></div>
</div>
</div>
</div>
<div class="section" id="op-tee-driver">
<h2>OP-TEE driver<a class="headerlink" href="#op-tee-driver" title="Permalink to this headline">¶</a></h2>
<p>The OP-TEE driver handles OP-TEE [1] based TEEs. Currently it is only the ARM
TrustZone based OP-TEE solution that is supported.</p>
<p>Lowest level of communication with OP-TEE builds on ARM SMC Calling
Convention (SMCCC) [2], which is the foundation for OP-TEE’s SMC interface
[3] used internally by the driver. Stacked on top of that is OP-TEE Message
Protocol [4].</p>
<p>OP-TEE SMC interface provides the basic functions required by SMCCC and some
additional functions specific for OP-TEE. The most interesting functions are:</p>
<ul class="simple">
<li>OPTEE_SMC_FUNCID_CALLS_UID (part of SMCCC) returns the version information
which is then returned by TEE_IOC_VERSION</li>
<li>OPTEE_SMC_CALL_GET_OS_UUID returns the particular OP-TEE implementation, used
to tell, for instance, a TrustZone OP-TEE apart from an OP-TEE running on a
separate secure co-processor.</li>
<li>OPTEE_SMC_CALL_WITH_ARG drives the OP-TEE message protocol</li>
<li>OPTEE_SMC_GET_SHM_CONFIG lets the driver and OP-TEE agree on which memory
range to used for shared memory between Linux and OP-TEE.</li>
</ul>
<p>The GlobalPlatform TEE Client API [5] is implemented on top of the generic
TEE API.</p>
<p>Picture of the relationship between the different components in the
OP-TEE architecture:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   User space                  Kernel                   Secure world
   ~~~~~~~~~~                  ~~~~~~                   ~~~~~~~~~~~~
+--------+                                             +-------------+
| Client |                                             | Trusted     |
+--------+                                             | Application |
   /\                                                  +-------------+
   || +----------+                                           /\
   || |tee-      |                                           ||
   || |supplicant|                                           \/
   || +----------+                                     +-------------+
   \/      /\                                          | TEE Internal|
+-------+  ||                                          | API         |
+ TEE   |  ||            +--------+--------+           +-------------+
| Client|  ||            | TEE    | OP-TEE |           | OP-TEE      |
| API   |  \/            | subsys | driver |           | Trusted OS  |
+-------+----------------+----+-------+----+-----------+-------------+
|      Generic TEE API        |       |     OP-TEE MSG               |
|      IOCTL (TEE_IOC_*)      |       |     SMCCC (OPTEE_SMC_CALL_*) |
+-----------------------------+       +------------------------------+
</pre></div>
</div>
<p>RPC (Remote Procedure Call) are requests from secure world to kernel driver
or tee-supplicant. An RPC is identified by a special range of SMCCC return
values from OPTEE_SMC_CALL_WITH_ARG. RPC messages which are intended for the
kernel are handled by the kernel driver. Other RPC messages will be forwarded to
tee-supplicant without further involvement of the driver, except switching
shared memory buffer representation.</p>
<div class="section" id="op-tee-device-enumeration">
<h3>OP-TEE device enumeration<a class="headerlink" href="#op-tee-device-enumeration" title="Permalink to this headline">¶</a></h3>
<p>OP-TEE provides a pseudo Trusted Application: drivers/tee/optee/device.c in
order to support device enumeration. In other words, OP-TEE driver invokes this
application to retrieve a list of Trusted Applications which can be registered
as devices on the TEE bus.</p>
</div>
<div class="section" id="op-tee-notifications">
<h3>OP-TEE notifications<a class="headerlink" href="#op-tee-notifications" title="Permalink to this headline">¶</a></h3>
<p>There are two kinds of notifications that secure world can use to make
normal world aware of some event.</p>
<ol class="arabic simple">
<li>Synchronous notifications delivered with <code class="docutils literal notranslate"><span class="pre">OPTEE_RPC_CMD_NOTIFICATION</span></code>
using the <code class="docutils literal notranslate"><span class="pre">OPTEE_RPC_NOTIFICATION_SEND</span></code> parameter.</li>
<li>Asynchronous notifications delivered with a combination of a non-secure
edge-triggered interrupt and a fast call from the non-secure interrupt
handler.</li>
</ol>
<p>Synchronous notifications are limited by depending on RPC for delivery,
this is only usable when secure world is entered with a yielding call via
<code class="docutils literal notranslate"><span class="pre">OPTEE_SMC_CALL_WITH_ARG</span></code>. This excludes such notifications from secure
world interrupt handlers.</p>
<p>An asynchronous notification is delivered via a non-secure edge-triggered
interrupt to an interrupt handler registered in the OP-TEE driver. The
actual notification value are retrieved with the fast call
<code class="docutils literal notranslate"><span class="pre">OPTEE_SMC_GET_ASYNC_NOTIF_VALUE</span></code>. Note that one interrupt can represent
multiple notifications.</p>
<p>One notification value <code class="docutils literal notranslate"><span class="pre">OPTEE_SMC_ASYNC_NOTIF_VALUE_DO_BOTTOM_HALF</span></code> has a
special meaning. When this value is received it means that normal world is
supposed to make a yielding call <code class="docutils literal notranslate"><span class="pre">OPTEE_MSG_CMD_DO_BOTTOM_HALF</span></code>. This
call is done from the thread assisting the interrupt handler. This is a
building block for OP-TEE OS in secure world to implement the top half and
bottom half style of device drivers.</p>
</div>
</div>
<div class="section" id="amd-tee-driver">
<h2>AMD-TEE driver<a class="headerlink" href="#amd-tee-driver" title="Permalink to this headline">¶</a></h2>
<p>The AMD-TEE driver handles the communication with AMD’s TEE environment. The
TEE environment is provided by AMD Secure Processor.</p>
<p>The AMD Secure Processor (formerly called Platform Security Processor or PSP)
is a dedicated processor that features ARM TrustZone technology, along with a
software-based Trusted Execution Environment (TEE) designed to enable
third-party Trusted Applications. This feature is currently enabled only for
APUs.</p>
<p>The following picture shows a high level overview of AMD-TEE:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>                                            |
   x86                                      |
                                            |
User space            (Kernel space)        |    AMD Secure Processor (PSP)
~~~~~~~~~~            ~~~~~~~~~~~~~~        |    ~~~~~~~~~~~~~~~~~~~~~~~~~~
                                            |
+--------+                                  |       +-------------+
| Client |                                  |       | Trusted     |
+--------+                                  |       | Application |
    /\                                      |       +-------------+
    ||                                      |             /\
    ||                                      |             ||
    ||                                      |             \/
    ||                                      |         +----------+
    ||                                      |         |   TEE    |
    ||                                      |         | Internal |
    \/                                      |         |   API    |
+---------+           +-----------+---------+         +----------+
| TEE     |           | TEE       | AMD-TEE |         | AMD-TEE  |
| Client  |           | subsystem | driver  |         | Trusted  |
| API     |           |           |         |         |   OS     |
+---------+-----------+----+------+---------+---------+----------+
|   Generic TEE API        |      | ASP     |      Mailbox       |
|   IOCTL (TEE_IOC_*)      |      | driver  | Register Protocol  |
+--------------------------+      +---------+--------------------+
</pre></div>
</div>
<p>At the lowest level (in x86), the AMD Secure Processor (ASP) driver uses the
CPU to PSP mailbox register to submit commands to the PSP. The format of the
command buffer is opaque to the ASP driver. It’s role is to submit commands to
the secure processor and return results to AMD-TEE driver. The interface
between AMD-TEE driver and AMD Secure Processor driver can be found in [6].</p>
<p>The AMD-TEE driver packages the command buffer payload for processing in TEE.
The command buffer format for the different TEE commands can be found in [7].</p>
<p>The TEE commands supported by AMD-TEE Trusted OS are:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>TEE_CMD_ID_LOAD_TA          - loads a Trusted Application (TA) binary into</dt>
<dd>TEE environment.</dd>
</dl>
</li>
<li>TEE_CMD_ID_UNLOAD_TA        - unloads TA binary from TEE environment.</li>
<li>TEE_CMD_ID_OPEN_SESSION     - opens a session with a loaded TA.</li>
<li>TEE_CMD_ID_CLOSE_SESSION    - closes session with loaded TA</li>
<li>TEE_CMD_ID_INVOKE_CMD       - invokes a command with loaded TA</li>
<li>TEE_CMD_ID_MAP_SHARED_MEM   - maps shared memory</li>
<li>TEE_CMD_ID_UNMAP_SHARED_MEM - unmaps shared memory</li>
</ul>
<p>AMD-TEE Trusted OS is the firmware running on AMD Secure Processor.</p>
<p>The AMD-TEE driver registers itself with TEE subsystem and implements the
following driver function callbacks:</p>
<ul class="simple">
<li>get_version - returns the driver implementation id and capability.</li>
<li>open - sets up the driver context data structure.</li>
<li>release - frees up driver resources.</li>
<li>open_session - loads the TA binary and opens session with loaded TA.</li>
<li>close_session -  closes session with loaded TA and unloads it.</li>
<li>invoke_func - invokes a command with loaded TA.</li>
</ul>
<p>cancel_req driver callback is not supported by AMD-TEE.</p>
<p>The GlobalPlatform TEE Client API [5] can be used by the user space (client) to
talk to AMD’s TEE. AMD’s TEE provides a secure environment for loading, opening
a session, invoking commands and closing session with TA.</p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<p>[1] <a class="reference external" href="https://github.com/OP-TEE/optee_os">https://github.com/OP-TEE/optee_os</a></p>
<p>[2] <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0028a/index.html">http://infocenter.arm.com/help/topic/com.arm.doc.den0028a/index.html</a></p>
<p>[3] drivers/tee/optee/optee_smc.h</p>
<p>[4] drivers/tee/optee/optee_msg.h</p>
<dl class="docutils">
<dt>[5] <a class="reference external" href="http://www.globalplatform.org/specificationsdevice.asp">http://www.globalplatform.org/specificationsdevice.asp</a> look for</dt>
<dd>“TEE Client API Specification v1.0” and click download.</dd>
</dl>
<p>[6] include/linux/psp-tee.h</p>
<p>[7] drivers/tee/amdtee/amdtee_if.h</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="xz.html" class="btn btn-neutral float-right" title="XZ data compression in Linux" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="static-keys.html" class="btn btn-neutral" title="Static Keys" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
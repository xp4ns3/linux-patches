

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Landlock LSM: kernel documentation &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../index.html"/>
        <link rel="up" title="Security Documentation" href="index.html"/>
        <link rel="next" title="Linux Sound Subsystem Documentation" href="../sound/index.html"/>
        <link rel="prev" title="Digital Signature Verification API" href="digsig.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../driver-api/index.html">The Linux driver implementer’s API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Security Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="credentials.html">Credentials in Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="IMA-templates.html">IMA Template Management Mechanism</a></li>
<li class="toctree-l2"><a class="reference internal" href="keys/index.html">Kernel Keys</a></li>
<li class="toctree-l2"><a class="reference internal" href="lsm.html">Linux Security Modules: General Security Hooks for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="lsm-development.html">Linux Security Module Development</a></li>
<li class="toctree-l2"><a class="reference internal" href="sak.html">Linux Secure Attention Key (SAK) handling</a></li>
<li class="toctree-l2"><a class="reference internal" href="SCTP.html">SCTP</a></li>
<li class="toctree-l2"><a class="reference internal" href="self-protection.html">Kernel Self-Protection</a></li>
<li class="toctree-l2"><a class="reference internal" href="siphash.html">SipHash - a short input PRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="siphash.html#halfsiphash-siphash-s-insecure-younger-cousin">HalfSipHash - SipHash’s insecure younger cousin</a></li>
<li class="toctree-l2"><a class="reference internal" href="tpm/index.html">Trusted Platform Module documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="digsig.html">Digital Signature Verification API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Landlock LSM: kernel documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#guiding-principles-for-safe-access-controls">Guiding principles for safe access controls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tests">Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-structures">Kernel structures</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#object">Object</a></li>
<li class="toctree-l4"><a class="reference internal" href="#filesystem">Filesystem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ruleset-and-domain">Ruleset and domain</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Security Documentation</a> &raquo;</li>
        
      <li>Landlock LSM: kernel documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/security/landlock.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="landlock-lsm-kernel-documentation">
<h1>Landlock LSM: kernel documentation<a class="headerlink" href="#landlock-lsm-kernel-documentation" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Mickaël Salaün</td>
</tr>
<tr class="field-even field"><th class="field-name">Date:</th><td class="field-body">March 2021</td>
</tr>
</tbody>
</table>
<p>Landlock’s goal is to create scoped access-control (i.e. sandboxing).  To
harden a whole system, this feature should be available to any process,
including unprivileged ones.  Because such process may be compromised or
backdoored (i.e. untrusted), Landlock’s features must be safe to use from the
kernel and other processes point of view.  Landlock’s interface must therefore
expose a minimal attack surface.</p>
<p>Landlock is designed to be usable by unprivileged processes while following the
system security policy enforced by other access control mechanisms (e.g. DAC,
LSM).  Indeed, a Landlock rule shall not interfere with other access-controls
enforced on the system, only add more restrictions.</p>
<p>Any user can enforce Landlock rulesets on their processes.  They are merged and
evaluated according to the inherited ones in a way that ensures that only more
constraints can be added.</p>
<p>User space documentation can be found here:
<a class="reference internal" href="../userspace-api/landlock.html"><span class="doc">Landlock: unprivileged access control</span></a>.</p>
<div class="section" id="guiding-principles-for-safe-access-controls">
<h2>Guiding principles for safe access controls<a class="headerlink" href="#guiding-principles-for-safe-access-controls" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>A Landlock rule shall be focused on access control on kernel objects instead
of syscall filtering (i.e. syscall arguments), which is the purpose of
seccomp-bpf.</li>
<li>To avoid multiple kinds of side-channel attacks (e.g. leak of security
policies, CPU-based attacks), Landlock rules shall not be able to
programmatically communicate with user space.</li>
<li>Kernel access check shall not slow down access request from unsandboxed
processes.</li>
<li>Computation related to Landlock operations (e.g. enforcing a ruleset) shall
only impact the processes requesting them.</li>
</ul>
</div>
<div class="section" id="tests">
<h2>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h2>
<p>Userspace tests for backward compatibility, ptrace restrictions and filesystem
support can be found here: <a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/tools/testing/selftests/landlock/">tools/testing/selftests/landlock/</a>.</p>
</div>
<div class="section" id="kernel-structures">
<h2>Kernel structures<a class="headerlink" href="#kernel-structures" title="Permalink to this headline">¶</a></h2>
<div class="section" id="object">
<h3>Object<a class="headerlink" href="#object" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.landlock_object_underops">
struct <code class="descname">landlock_object_underops</code><a class="headerlink" href="#c.landlock_object_underops" title="Permalink to this definition">¶</a></dt>
<dd><p>Operations on an underlying object</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_object_underops {
  void (*release)(struct landlock_object *const object) __releases(object-&gt;lock);
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">release</span></code></dt>
<dd>Releases the underlying object (e.g. <a class="reference internal" href="../filesystems/api-summary.html#c.iput" title="iput"><code class="xref c c-func docutils literal notranslate"><span class="pre">iput()</span></code></a> for an inode).</dd>
</dl>
<dl class="type">
<dt id="c.landlock_object">
struct <code class="descname">landlock_object</code><a class="headerlink" href="#c.landlock_object" title="Permalink to this definition">¶</a></dt>
<dd><p>Security blob tied to a kernel object</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_object {
  refcount_t usage;
  spinlock_t lock;
  void *underobj;
  union {
    struct rcu_head rcu_free;
    const struct landlock_object_underops *underops;
  };
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">usage</span></code></dt>
<dd>This counter is used to tie an object to the rules matching
it or to keep it alive while adding a new rule.  If this counter
reaches zero, this struct must not be modified, but this counter can
still be read from within an RCU read-side critical section.  When
adding a new rule to an object with a usage counter of zero, we must
wait until the pointer to this object is set to NULL (or recycled).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt>
<dd><p class="first">Protects against concurrent modifications.  This lock must be
held from the time <strong>usage</strong> drops to zero until any weak references
from <strong>underobj</strong> to this object have been cleaned up.</p>
<p class="last">Lock ordering: inode-&gt;i_lock nests inside this.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">underobj</span></code></dt>
<dd>Used when cleaning up an object and to mark an object as
tied to its underlying kernel structure.  This pointer is protected
by <strong>lock</strong>.  Cf. landlock_release_inodes() and release_inode().</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_union}</span></code></dt>
<dd>anonymous</dd>
<dt><code class="docutils literal notranslate"><span class="pre">rcu_free</span></code></dt>
<dd>Enables lockless use of <strong>usage</strong>, <strong>lock</strong> and
<strong>underobj</strong> from within an RCU read-side critical section.
<strong>rcu_free</strong> and <strong>underops</strong> are only used by
landlock_put_object().</dd>
<dt><code class="docutils literal notranslate"><span class="pre">underops</span></code></dt>
<dd>Enables landlock_put_object() to release the
underlying object (e.g. inode).</dd>
</dl>
<p><strong>Description</strong></p>
<p>The goal of this structure is to enable to tie a set of ephemeral access
rights (pertaining to different domains) to a kernel object (e.g an inode)
in a safe way.  This implies to handle concurrent use and modification.</p>
<p>The lifetime of a <a class="reference internal" href="#c.landlock_object" title="landlock_object"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_object</span></code></a> depends on the rules referring to
it.</p>
</div>
<div class="section" id="filesystem">
<h3>Filesystem<a class="headerlink" href="#filesystem" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.landlock_inode_security">
struct <code class="descname">landlock_inode_security</code><a class="headerlink" href="#c.landlock_inode_security" title="Permalink to this definition">¶</a></dt>
<dd><p>Inode security blob</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_inode_security {
  struct landlock_object __rcu *object;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">object</span></code></dt>
<dd>Weak pointer to an allocated object.  All assignments of a
new object are protected by the underlying inode-&gt;i_lock.  However,
atomically disassociating <strong>object</strong> from the inode is only protected
by <strong>object-&gt;lock</strong>, from the time <strong>object</strong>’s usage refcount drops to
zero to the time this pointer is nulled out (cf. release_inode() and
hook_sb_delete()).  Indeed, such disassociation doesn’t require
inode-&gt;i_lock thanks to the careful <a class="reference internal" href="../core-api/kernel-api.html#c.rcu_access_pointer" title="rcu_access_pointer"><code class="xref c c-func docutils literal notranslate"><span class="pre">rcu_access_pointer()</span></code></a> check
performed by get_inode_object().</dd>
</dl>
<p><strong>Description</strong></p>
<p>Enable to reference a <a class="reference internal" href="#c.landlock_object" title="landlock_object"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_object</span></code></a> tied to an inode (i.e.
underlying object).</p>
<dl class="type">
<dt id="c.landlock_superblock_security">
struct <code class="descname">landlock_superblock_security</code><a class="headerlink" href="#c.landlock_superblock_security" title="Permalink to this definition">¶</a></dt>
<dd><p>Superblock security blob</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_superblock_security {
  atomic_long_t inode_refs;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">inode_refs</span></code></dt>
<dd>Number of pending inodes (from this superblock) that
are being released by release_inode().
Cf. struct super_block-&gt;s_fsnotify_inode_refs .</dd>
</dl>
<p><strong>Description</strong></p>
<p>Enable hook_sb_delete() to wait for concurrent calls to release_inode().</p>
</div>
<div class="section" id="ruleset-and-domain">
<h3>Ruleset and domain<a class="headerlink" href="#ruleset-and-domain" title="Permalink to this headline">¶</a></h3>
<p>A domain is a read-only ruleset tied to a set of subjects (i.e. tasks’
credentials).  Each time a ruleset is enforced on a task, the current domain is
duplicated and the ruleset is imported as a new layer of rules in the new
domain.  Indeed, once in a domain, each rule is tied to a layer level.  To
grant access to an object, at least one rule of each layer must allow the
requested action on the object.  A task can then only transit to a new domain
that is the intersection of the constraints from the current domain and those
of a ruleset provided by the task.</p>
<p>The definition of a subject is implicit for a task sandboxing itself, which
makes the reasoning much easier and helps avoid pitfalls.</p>
<dl class="type">
<dt id="c.landlock_layer">
struct <code class="descname">landlock_layer</code><a class="headerlink" href="#c.landlock_layer" title="Permalink to this definition">¶</a></dt>
<dd><p>Access rights for a given layer</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_layer {
  u16 level;
  u16 access;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">level</span></code></dt>
<dd>Position of this layer in the layer stack.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">access</span></code></dt>
<dd>Bitfield of allowed actions on the kernel object.  They are
relative to the object type (e.g. <code class="docutils literal notranslate"><span class="pre">LANDLOCK_ACTION_FS_READ</span></code>).</dd>
</dl>
<dl class="type">
<dt id="c.landlock_rule">
struct <code class="descname">landlock_rule</code><a class="headerlink" href="#c.landlock_rule" title="Permalink to this definition">¶</a></dt>
<dd><p>Access rights tied to an object</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_rule {
  struct rb_node node;
  struct landlock_object *object;
  u32 num_layers;
  struct landlock_layer layers[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">node</span></code></dt>
<dd>Node in the ruleset’s red-black tree.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">object</span></code></dt>
<dd>Pointer to identify a kernel object (e.g. an inode).  This
is used as a key for this ruleset element.  This pointer is set once
and never modified.  It always points to an allocated object because
each rule increments the refcount of its object.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_layers</span></code></dt>
<dd>Number of entries in <strong>layers</strong>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">layers</span></code></dt>
<dd>Stack of layers, from the latest to the newest, implemented
as a flexible array member (FAM).</dd>
</dl>
<dl class="type">
<dt id="c.landlock_hierarchy">
struct <code class="descname">landlock_hierarchy</code><a class="headerlink" href="#c.landlock_hierarchy" title="Permalink to this definition">¶</a></dt>
<dd><p>Node in a ruleset hierarchy</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_hierarchy {
  struct landlock_hierarchy *parent;
  refcount_t usage;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">parent</span></code></dt>
<dd>Pointer to the parent node, or NULL if it is a root
Landlock domain.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usage</span></code></dt>
<dd>Number of potential children domains plus their parent
domain.</dd>
</dl>
<dl class="type">
<dt id="c.landlock_ruleset">
struct <code class="descname">landlock_ruleset</code><a class="headerlink" href="#c.landlock_ruleset" title="Permalink to this definition">¶</a></dt>
<dd><p>Landlock ruleset</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct landlock_ruleset {
  struct rb_root root;
  struct landlock_hierarchy *hierarchy;
  union {
    struct work_struct work_free;
    struct {
      struct mutex lock;
      refcount_t usage;
      u32 num_rules;
      u32 num_layers;
      u16 fs_access_masks[];
    };
  };
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">root</span></code></dt>
<dd>Root of a red-black tree containing <a class="reference internal" href="#c.landlock_rule" title="landlock_rule"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">landlock_rule</span></code></a>
nodes.  Once a ruleset is tied to a process (i.e. as a domain), this
tree is immutable until <strong>usage</strong> reaches zero.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">hierarchy</span></code></dt>
<dd>Enables hierarchy identification even when a parent
domain vanishes.  This is needed for the ptrace protection.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_union}</span></code></dt>
<dd>anonymous</dd>
<dt><code class="docutils literal notranslate"><span class="pre">work_free</span></code></dt>
<dd>Enables to free a ruleset within a lockless
section.  This is only used by
landlock_put_ruleset_deferred() when <strong>usage</strong> reaches zero.
The fields <strong>lock</strong>, <strong>usage</strong>, <strong>num_rules</strong>, <strong>num_layers</strong> and
<strong>fs_access_masks</strong> are then unused.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">{unnamed_struct}</span></code></dt>
<dd>anonymous</dd>
<dt><code class="docutils literal notranslate"><span class="pre">lock</span></code></dt>
<dd>Protects against concurrent modifications of
<strong>root</strong>, if <strong>usage</strong> is greater than zero.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">usage</span></code></dt>
<dd>Number of processes (i.e. domains) or file
descriptors referencing this ruleset.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_rules</span></code></dt>
<dd>Number of non-overlapping (i.e. not for
the same object) rules in this ruleset.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">num_layers</span></code></dt>
<dd>Number of layers that are used in this
ruleset.  This enables to check that all the layers
allow an access request.  A value of 0 identifies a
non-merged ruleset (i.e. not a domain).</dd>
<dt><code class="docutils literal notranslate"><span class="pre">fs_access_masks</span></code></dt>
<dd>Contains the subset of filesystem
actions that are restricted by a ruleset.  A domain
saves all layers of merged rulesets in a stack
(FAM), starting from the first layer to the last
one.  These layers are used when merging rulesets,
for user space backward compatibility (i.e.
future-proof), and to properly handle merged
rulesets without overlapping access rights.  These
layers are set once and never changed for the
lifetime of the ruleset.</dd>
</dl>
<p><strong>Description</strong></p>
<p>This data structure must contain unique entries, be updatable, and quick to
match an object.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../sound/index.html" class="btn btn-neutral float-right" title="Linux Sound Subsystem Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="digsig.html" class="btn btn-neutral" title="Digital Signature Verification API" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>
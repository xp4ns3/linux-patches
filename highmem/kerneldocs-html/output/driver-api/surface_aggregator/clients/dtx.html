

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User-Space DTX (Clipboard Detachment System) Interface &mdash; The Linux Kernel 5.18.0-rc1-torvalds+ documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="../../../_static/theme_rtd_colors.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="The Linux Kernel 5.18.0-rc1-torvalds+ documentation" href="../../../index.html"/>
        <link rel="up" title="Client Driver Documentation" href="index.html"/>
        <link rel="next" title="Surface ACPI Notify" href="san.html"/>
        <link rel="prev" title="User-Space EC Interface (cdev)" href="cdev.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> The Linux Kernel
          

          
          </a>

          
            
            
              <div class="version">
                5.18.0-rc2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../admin-guide/index.html">The Linux kernel user’s and administrator’s guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kbuild/index.html">Kernel Build System</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../firmware-guide/index.html">The Linux kernel firmware guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devicetree/index.html">Open Firmware and Devicetree</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../userspace-api/index.html">The Linux kernel user-space API guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../process/index.html">Working with the kernel development community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev-tools/index.html">Development tools for the kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../doc-guide/index.html">How to write kernel documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kernel-hacking/index.html">Kernel Hacking Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../trace/index.html">Linux Tracing Technologies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintainer/index.html">Kernel Maintainer Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fault-injection/index.html">fault-injection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../livepatch/index.html">Kernel Livepatching</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">The Linux driver implementer’s API guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../driver-model/index.html">Driver Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../basics.html">Driver Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../infrastructure.html">Device drivers infrastructure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ioctl.html">ioctl based interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../early-userspace/index.html">Early Userspace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pm/index.html">CPU and Device Power Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../clk.html">The Common Clk Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../device-io.html">Bus-Independent Device Accesses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dma-buf.html">Buffer Sharing and Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../device_link.html">Device links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../component.html">Component Helper for Aggregate Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../message-based.html">Message-based devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../infiniband.html">InfiniBand and Remote DMA (RDMA) Interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../frame-buffer.html">Frame Buffer Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../regulator.html">Voltage and current regulator API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reset.html">Reset controller API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../input.html">Input Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../usb/index.html">Linux USB API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firewire.html">Firewire (IEEE 1394) driver Interface Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pci/index.html">The Linux PCI driver implementer’s API guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cxl/index.html">Compute Express Link</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../spi.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../i2c.html">I<sup>2</sup>C and SMBus Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ipmb.html">IPMB Driver for a Satellite MC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ipmi.html">The Linux IPMI Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../i3c/index.html">I3C subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../interconnect.html">Generic System Interconnect Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../devfreq.html">Device Frequency Scaling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hsi.html">High Speed Synchronous Serial Interface (HSI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../edac.html">Error Detection And Correction (EDAC) Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../scsi.html">SCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../libata.html">libATA Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../target.html">target and iSCSI Interfaces Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mailbox.html">The Common Mailbox Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mtdnand.html">MTD NAND Driver Programming Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../miscellaneous.html">Parallel Port Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../miscellaneous.html#x50-uart-driver">16x50 UART Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../miscellaneous.html#pulse-width-modulation-pwm">Pulse-Width Modulation (PWM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mei/index.html">Intel(R) Management Engine Interface (Intel(R) MEI)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mtd/index.html">Memory Technology Device (MTD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../mmc/index.html">MMC/SD/SDIO card support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nvdimm/index.html">Non-Volatile Memory Device (NVDIMM)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../w1.html">W1: Dallas’ 1-wire bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rapidio/index.html">The Linux RapidIO Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../s390-drivers.html">Writing s390 channel device drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vme.html">VME Device Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../80211/index.html">Linux 802.11 Driver Developer’s Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../uio-howto.html">The Userspace I/O HOWTO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../firmware/index.html">Linux Firmware API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pin-control.html">PINCTRL (PIN CONTROL) subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gpio/index.html">General Purpose Input/Output (GPIO)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../md/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../media/index.html">Media subsystem kernel internal API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc_devices.html">Miscellaneous Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nfc/index.html">Near Field Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dmaengine/index.html">DMAEngine documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../slimbus.html">Linux kernel SLIMbus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../soundwire/index.html">SoundWire Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../thermal/index.html">Thermal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../fpga/index.html">FPGA Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../acpi/index.html">ACPI Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../auxiliary_bus.html">Auxiliary Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../backlight/lp855x-driver.html">Kernel driver lp855x</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../connector.html">Kernel Connector</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../console.html">Console Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../dcdbas.html">Dell Systems Management Base Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../eisa.html">EISA bus support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../isa.html">ISA Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../isapnp.html">ISA Plug &amp; Play support by Jaroslav Kysela &lt;perex&#64;suse.cz&gt;</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../io-mapping.html">The io_mapping functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../io_ordering.html">Ordering I/O writes to memory-mapped addresses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../generic-counter.html">Generic Counter Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../memory-devices/index.html">Memory Controller drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../men-chameleon-bus.html">MEN Chameleon Bus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ntb.html">NTB Drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../nvmem.html">NVMEM Subsystem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../parport-lowlevel.html">PARPORT interface documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pps.html">PPS - Pulse Per Second</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ptp.html">PTP hardware clock infrastructure for Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../phy/index.html">Generic PHY Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pwm.html">Pulse Width Modulation (PWM) interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pldmfw/index.html">PLDM Firmware Flash Update Library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../pldmfw/index.html#overview-of-the-pldmfw-library">Overview of the <code class="docutils literal notranslate"><span class="pre">pldmfw</span></code> library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../rfkill.html">rfkill - RF kill switch support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../serial/index.html">Support for Serial devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sm501.html">SM501 Driver</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Surface System Aggregator Module (SSAM)</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../overview.html">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../client.html">Writing Client Drivers</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Client Driver Documentation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="cdev.html">User-Space EC Interface (cdev)</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">User-Space DTX (Clipboard Detachment System) Interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="san.html">Surface ACPI Notify</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../ssh.html">Surface Serial Hub Protocol</a></li>
<li class="toctree-l3"><a class="reference internal" href="../internal.html">Core Driver Internals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../switchtec.html">Linux Switchtec Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sync_file.html">Sync File API Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vfio-mediated-device.html">VFIO Mediated devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vfio.html">VFIO - “Virtual Function I/O” </a></li>
<li class="toctree-l2"><a class="reference internal" href="../../vfio-pci-device-specific-driver-acceptance.html">Acceptance criteria for vfio-pci device specific driver variants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xilinx/index.html">Xilinx FPGA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../xillybus.html">Xillybus driver for generic FPGA interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../zorro.html">Writing Device Drivers for Zorro Devices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../core-api/index.html">Core API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../locking/index.html">locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../accounting/index.html">Accounting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../block/index.html">Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cdrom/index.html">cdrom</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cpu-freq/index.html">Linux CPUFreq - CPU frequency and voltage scaling code in the Linux(TM) kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ide/index.html">Integrated Drive Electronics (IDE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fb/index.html">Frame Buffer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../fpga/index.html">fpga</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hid/index.html">Human Interface Devices (HID)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../i2c/index.html">I2C/SMBus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../iio/index.html">Industrial I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../isdn/index.html">ISDN</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../infiniband/index.html">InfiniBand</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../leds/index.html">LEDs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../netlabel/index.html">NetLabel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../networking/index.html">Linux Networking Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../pcmcia/index.html">pcmcia</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../power/index.html">Power Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../target/index.html">TCM Virtual Device</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../timers/index.html">timers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../spi/index.html">Serial Peripheral Interface (SPI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../w1/index.html">1-Wire Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watchdog/index.html">Linux Watchdog Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../virt/index.html">Linux Virtualization Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../input/index.html">The Linux Input Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hwmon/index.html">Linux Hardware Monitoring</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gpu/index.html">Linux GPU Driver Developer’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../sound/index.html">Linux Sound Subsystem Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../crypto/index.html">Linux Kernel Crypto API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../filesystems/index.html">Filesystems in the Linux kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../vm/index.html">Linux Memory Management Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../bpf/index.html">BPF Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../usb/index.html">USB support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PCI/index.html">Linux PCI Bus Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scsi/index.html">Linux SCSI Subsystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc-devices/index.html">Assorted Miscellaneous Devices Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../scheduler/index.html">Linux Scheduler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../mhi/index.html">MHI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tty/index.html">TTY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../peci/index.html">Linux PECI Subsystem</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../asm-annotations.html">Assembler Annotations</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../arch.html">CPU Architectures</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/index.html">Kernel tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html">Unsorted Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-types">Atomic Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#atomic-bitops">Atomic bitops</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../staging/index.html#memory-barriers">Memory Barriers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../watch_queue.html">General notification mechanism</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../translations/index.html">Translations</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">The Linux Kernel</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">The Linux driver implementer’s API guide</a> &raquo;</li>
        
          <li><a href="../index.html">Surface System Aggregator Module (SSAM)</a> &raquo;</li>
        
          <li><a href="index.html">Client Driver Documentation</a> &raquo;</li>
        
      <li>User-Space DTX (Clipboard Detachment System) Interface</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/driver-api/surface_aggregator/clients/dtx.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-space-dtx-clipboard-detachment-system-interface">
<h1><a class="toc-backref" href="#id13">User-Space DTX (Clipboard Detachment System) Interface</a><a class="headerlink" href="#user-space-dtx-clipboard-detachment-system-interface" title="Permalink to this headline">¶</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">surface_dtx</span></code> driver is responsible for proper clipboard detachment
and re-attachment handling. To this end, it provides the <code class="docutils literal notranslate"><span class="pre">/dev/surface/dtx</span></code>
device file, through which it can interface with a user-space daemon. This
daemon is then ultimately responsible for determining and taking necessary
actions, such as unmounting devices attached to the base,
unloading/reloading the graphics-driver, user-notifications, etc.</p>
<p>There are two basic communication principles used in this driver: Commands
(in other parts of the documentation also referred to as requests) and
events. Commands are sent to the EC and may have a different implications in
different contexts. Events are sent by the EC upon some internal state
change. Commands are always driver-initiated, whereas events are always
initiated by the EC.</p>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#user-space-dtx-clipboard-detachment-system-interface" id="id13">User-Space DTX (Clipboard Detachment System) Interface</a><ul>
<li><a class="reference internal" href="#nomenclature" id="id14">Nomenclature</a></li>
<li><a class="reference internal" href="#detachment-process" id="id15">Detachment Process</a><ul>
<li><a class="reference internal" href="#latch-states" id="id16">Latch States</a></li>
<li><a class="reference internal" href="#detachment-procedure" id="id17">Detachment Procedure</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user-space-interface-documentation" id="id18">User-Space Interface Documentation</a><ul>
<li><a class="reference internal" href="#error-codes-and-status-values" id="id19">Error Codes and Status Values</a></li>
<li><a class="reference internal" href="#events" id="id20">Events</a><ul>
<li><a class="reference internal" href="#sdtx-event-request" id="id21"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code></a></li>
<li><a class="reference internal" href="#sdtx-event-cancel" id="id22"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code></a></li>
<li><a class="reference internal" href="#sdtx-event-base-connection" id="id23"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code></a></li>
<li><a class="reference internal" href="#sdtx-event-latch-status" id="id24"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code></a></li>
<li><a class="reference internal" href="#sdtx-event-device-mode" id="id25"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_DEVICE_MODE</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#ioctls" id="id26">IOCTLs</a><ul>
<li><a class="reference internal" href="#sdtx-ioctl-events-enable" id="id27"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_EVENTS_ENABLE</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-events-disable" id="id28"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_EVENTS_DISABLE</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-lock" id="id29"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_LOCK</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-unlock" id="id30"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_UNLOCK</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-request" id="id31"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-confirm" id="id32"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CONFIRM</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-heartbeat" id="id33"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_HEARTBEAT</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-latch-cancel" id="id34"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CANCEL</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-get-base-info" id="id35"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_BASE_INFO</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-get-device-mode" id="id36"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_DEVICE_MODE</span></code></a></li>
<li><a class="reference internal" href="#sdtx-ioctl-get-latch-status" id="id37"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_LATCH_STATUS</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-note-on-base-ids" id="id38">A Note on Base IDs</a></li>
<li><a class="reference internal" href="#structures-and-enums" id="id39">Structures and Enums</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api-users" id="id40">API Users</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="nomenclature">
<h2><a class="toc-backref" href="#id14">Nomenclature</a><a class="headerlink" href="#nomenclature" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><strong>Clipboard:</strong>
The detachable upper part of the Surface Book, housing the screen and CPU.</li>
<li><strong>Base:</strong>
The lower part of the Surface Book from which the clipboard can be
detached, optionally (model dependent) housing the discrete GPU (dGPU).</li>
<li><strong>Latch:</strong>
The mechanism keeping the clipboard attached to the base in normal
operation and allowing it to be detached when requested.</li>
<li><strong>Silently ignored commands:</strong>
The command is accepted by the EC as a valid command and acknowledged
(following the standard communication protocol), but the EC does not act
upon it, i.e. ignores it.e upper part of the</li>
</ul>
</div>
<div class="section" id="detachment-process">
<h2><a class="toc-backref" href="#id15">Detachment Process</a><a class="headerlink" href="#detachment-process" title="Permalink to this headline">¶</a></h2>
<p>Warning: This part of the documentation is based on reverse engineering and
testing and thus may contain errors or be incomplete.</p>
<div class="section" id="latch-states">
<h3><a class="toc-backref" href="#id16">Latch States</a><a class="headerlink" href="#latch-states" title="Permalink to this headline">¶</a></h3>
<p>The latch mechanism has two major states: <em>open</em> and <em>closed</em>. In the
<em>closed</em> state (default), the clipboard is secured to the base, whereas in
the <em>open</em> state, the clipboard can be removed by a user.</p>
<p>The latch can additionally be locked and, correspondingly, unlocked, which
can influence the detachment procedure. Specifically, this locking mechanism
is intended to prevent the dGPU, positioned in the base of the device, from
being hot-unplugged while in use. More details can be found in the
documentation for the detachment procedure below. By default, the latch is
unlocked.</p>
</div>
<div class="section" id="detachment-procedure">
<h3><a class="toc-backref" href="#id17">Detachment Procedure</a><a class="headerlink" href="#detachment-procedure" title="Permalink to this headline">¶</a></h3>
<p>Note that the detachment process is governed fully by the EC. The
<code class="docutils literal notranslate"><span class="pre">surface_dtx</span></code> driver only relays events from the EC to user-space and
commands from user-space to the EC, i.e. it does not influence this process.</p>
<p>The detachment process is started with the user pressing the <em>detach</em> button
on the base of the device or executing the <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code> IOCTL.
Following that:</p>
<ol class="arabic simple">
<li>The EC turns on the indicator led on the detach-button, sends a
<em>detach-request</em> event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code>), and awaits further
instructions/commands. In case the latch is unlocked, the led will flash
green. If the latch has been locked, the led will be solid red</li>
<li>The event is, via the <code class="docutils literal notranslate"><span class="pre">surface_dtx</span></code> driver, relayed to user-space, where
an appropriate user-space daemon can handle it and send instructions back
to the EC via IOCTLs provided by this driver.</li>
<li>The EC waits for instructions from user-space and acts according to them.
If the EC does not receive any instructions in a given period, it will
time out and continue as follows:<ul>
<li>If the latch is unlocked, the EC will open the latch and the clipboard
can be detached from the base. This is the exact behavior as without
this driver or any user-space daemon. See the <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CONFIRM</span></code>
description below for more details on the follow-up behavior of the EC.</li>
<li>If the latch is locked, the EC will <em>not</em> open the latch, meaning the
clipboard cannot be detached from the base. Furthermore, the EC sends
an cancel event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code>) detailing this with the cancel
reason <code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_TIMEDOUT</span></code> (see <a class="reference internal" href="#events"><span class="std std-ref">Events</span></a> for details).</li>
</ul>
</li>
</ol>
<p>Valid responses by a user-space daemon to a detachment request event are:</p>
<ul>
<li><p class="first">Execute <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code>. This will immediately abort the
detachment process. Furthermore, the EC will send a detach-request event,
similar to the user pressing the detach-button to cancel said process (see
below).</p>
</li>
<li><p class="first">Execute <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CONFIRM</span></code>. This will cause the EC to open the
latch, after which the user can separate clipboard and base.</p>
<p>As this changes the latch state, a <em>latch-status</em> event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code>) will be sent once the latch has been opened
successfully. If the EC fails to open the latch, e.g. due to hardware
error or low battery, a latch-cancel event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code>) will be
sent with the cancel reason indicating the specific failure.</p>
<p>If the latch is currently locked, the latch will automatically be
unlocked before it is opened.</p>
</li>
<li><p class="first">Execute <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_HEARTBEAT</span></code>. This will reset the internal timeout.
No other actions will be performed, i.e. the detachment process will neither
be completed nor canceled, and the EC will still be waiting for further
responses.</p>
</li>
<li><p class="first">Execute <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CANCEL</span></code>. This will abort the detachment process,
similar to <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code>, described above, or the button
press, described below. A <em>generic request</em> event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code>)
is send in response to this. In contrast to those, however, this command
does not trigger a new detachment process if none is currently in
progress.</p>
</li>
<li><p class="first">Do nothing. The detachment process eventually times out as described in
point 3.</p>
</li>
</ul>
<p>See <a class="reference internal" href="#ioctls"><span class="std std-ref">IOCTLs</span></a> for more details on these responses.</p>
<p>It is important to note that, if the user presses the detach button at any
point when a detachment operation is in progress (i.e. after the EC has sent
the initial <em>detach-request</em> event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code>) and before it
received the corresponding response concluding the process), the detachment
process is canceled on the EC-level and an identical event is being sent.
Thus a <em>detach-request</em> event, by itself, does not signal the start of the
detachment process.</p>
<p>The detachment process may further be canceled by the EC due to hardware
failures or a low clipboard battery. This is done via a cancel event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code>) with the corresponding cancel reason.</p>
</div>
</div>
<div class="section" id="user-space-interface-documentation">
<h2><a class="toc-backref" href="#id18">User-Space Interface Documentation</a><a class="headerlink" href="#user-space-interface-documentation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="error-codes-and-status-values">
<h3><a class="toc-backref" href="#id19">Error Codes and Status Values</a><a class="headerlink" href="#error-codes-and-status-values" title="Permalink to this headline">¶</a></h3>
<p>Error and status codes are divided into different categories, which can be
used to determine if the status code is an error, and, if it is, the
severity and type of that error. The current categories are:</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Overview of Status/Error Categories.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="33%" />
<col width="17%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Value</th>
<th class="head">Short Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x0000</span></code></td>
<td>Non-error status codes.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">RUNTIME_ERROR</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x1000</span></code></td>
<td>Non-critical runtime errors.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">HARDWARE_ERROR</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2000</span></code></td>
<td>Critical hardware failures.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0xF000</span></code></td>
<td>Unknown error codes.</td>
</tr>
</tbody>
</table>
<p>Other categories are reserved for future use. The <code class="docutils literal notranslate"><span class="pre">SDTX_CATEGORY()</span></code> macro
can be used to determine the category of any status value. The
<code class="docutils literal notranslate"><span class="pre">SDTX_SUCCESS()</span></code> macro can be used to check if the status value is a
success value (<code class="docutils literal notranslate"><span class="pre">SDTX_CATEGORY_STATUS</span></code>) or if it indicates a failure.</p>
<p>Unknown status or error codes sent by the EC are assigned to the <code class="docutils literal notranslate"><span class="pre">UNKNOWN</span></code>
category by the driver and may be implemented via their own code in the
future.</p>
<p>Currently used error codes are:</p>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-text">Overview of Error Codes.</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="14%" />
<col width="14%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Category</th>
<th class="head">Value</th>
<th class="head">Short Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_NOT_FEASIBLE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">RUNTIME</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x1001</span></code></td>
<td>Detachment not feasible due to low clipboard battery.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_TIMEDOUT</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">RUNTIME</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x1002</span></code></td>
<td>Detachment process timed out while the latch was locked.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_OPEN</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">HARDWARE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2001</span></code></td>
<td>Failed to open latch.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_REMAIN_OPEN</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">HARDWARE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2002</span></code></td>
<td>Failed to keep latch open.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_CLOSE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">HARDWARE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2003</span></code></td>
<td>Failed to close latch.</td>
</tr>
</tbody>
</table>
<p>Other error codes are reserved for future use. Non-error status codes may
overlap and are generally only unique within their use-case:</p>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-text">Latch Status Codes.</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="14%" />
<col width="14%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Category</th>
<th class="head">Value</th>
<th class="head">Short Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_CLOSED</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x0000</span></code></td>
<td>Latch is closed/has been closed.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_OPENED</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x0001</span></code></td>
<td>Latch is open/has been opened.</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id6">
<caption><span class="caption-text">Base State Codes.</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="14%" />
<col width="14%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Category</th>
<th class="head">Value</th>
<th class="head">Short Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_DETACHED</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x0000</span></code></td>
<td>Base has been detached/is not present.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_ATTACHED</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x0001</span></code></td>
<td>Base has been attached/is present.</td>
</tr>
</tbody>
</table>
<p>Again, other codes are reserved for future use.</p>
</div>
<div class="section" id="events">
<span id="id1"></span><h3><a class="toc-backref" href="#id20">Events</a><a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h3>
<p>Events can be received by reading from the device file. They are disabled by
default and have to be enabled by executing <code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_EVENTS_ENABLE</span></code>
first. All events follow the layout prescribed by <a class="reference internal" href="#c.sdtx_event" title="sdtx_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sdtx_event</span></code></a>. Specific
event types can be identified by their event code, described in
<a class="reference internal" href="#c.sdtx_event_code" title="sdtx_event_code"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">sdtx_event_code</span></code></a>. Note that other event codes are reserved for future use,
thus an event parser must be able to handle any unknown/unsupported event
types gracefully, by relying on the payload length given in the event header.</p>
<p>Currently provided event types are:</p>
<table border="1" class="docutils" id="id7">
<caption><span class="caption-text">Overview of DTX events.</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="14%" />
<col width="14%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Code</th>
<th class="head">Payload</th>
<th class="head">Short Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">1</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0</span></code> bytes</td>
<td>Detachment process initiated/aborted.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">2</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">2</span></code> bytes</td>
<td>EC canceled detachment process.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">3</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">4</span></code> bytes</td>
<td>Base connection state changed.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">4</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">2</span></code> bytes</td>
<td>Latch status changed.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_DEVICE_MODE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">2</span></code> bytes</td>
<td>Device mode changed.</td>
</tr>
</tbody>
</table>
<p>Individual events in more detail:</p>
<div class="section" id="sdtx-event-request">
<h4><a class="toc-backref" href="#id21"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code></a><a class="headerlink" href="#sdtx-event-request" title="Permalink to this headline">¶</a></h4>
<p>Sent when a detachment process is started or, if in progress, aborted by the
user, either via a detach button press or a detach request
(<code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code>) being sent from user-space.</p>
<p>Does not have any payload.</p>
</div>
<div class="section" id="sdtx-event-cancel">
<h4><a class="toc-backref" href="#id22"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code></a><a class="headerlink" href="#sdtx-event-cancel" title="Permalink to this headline">¶</a></h4>
<p>Sent when a detachment process is canceled by the EC due to unfulfilled
preconditions (e.g. clipboard battery too low to detach) or hardware
failure. The reason for cancellation is given in the event payload detailed
below and can be one of</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_TIMEDOUT</span></code>: Detachment timed out while the latch was locked.
The latch has neither been opened nor unlocked.</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_NOT_FEASIBLE</span></code>: Detachment not feasible due to low clipboard
battery.</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_OPEN</span></code>: Could not open the latch (hardware failure).</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_REMAIN_OPEN</span></code>: Could not keep the latch open (hardware
failure).</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_CLOSE</span></code>: Could not close the latch (hardware failure).</li>
</ul>
<p>Other error codes in this context are reserved for future use.</p>
<p>These codes can be classified via the <code class="docutils literal notranslate"><span class="pre">SDTX_CATEGORY()</span></code> macro to discern
between critical hardware errors (<code class="docutils literal notranslate"><span class="pre">SDTX_CATEGORY_HARDWARE_ERROR</span></code>) or
runtime errors (<code class="docutils literal notranslate"><span class="pre">SDTX_CATEGORY_RUNTIME_ERROR</span></code>), the latter of which may
happen during normal operation if certain preconditions for detachment are
not given.</p>
<table border="1" class="docutils" id="id8">
<caption><span class="caption-text">Detachment Cancel Event Payload</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">reason</span></code></td>
<td><code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code></td>
<td>Reason for cancellation.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sdtx-event-base-connection">
<h4><a class="toc-backref" href="#id23"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code></a><a class="headerlink" href="#sdtx-event-base-connection" title="Permalink to this headline">¶</a></h4>
<p>Sent when the base connection state has changed, i.e. when the base has been
attached, detached, or detachment has become infeasible due to low clipboard
battery. The new state and, if a base is connected, ID of the base is
provided as payload of type <a class="reference internal" href="#c.sdtx_base_info" title="sdtx_base_info"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sdtx_base_info</span></code></a> with its layout presented
below:</p>
<table border="1" class="docutils" id="id9">
<caption><span class="caption-text">Base-Connection-Change Event Payload</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">state</span></code></td>
<td><code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code></td>
<td>Base connection state.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">base_id</span></code></td>
<td><code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code></td>
<td>Type of base connected (zero if none).</td>
</tr>
</tbody>
</table>
<p>Possible values for <code class="docutils literal notranslate"><span class="pre">state</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_DETACHED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_ATTACHED</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_NOT_FEASIBLE</span></code>.</li>
</ul>
<p>Other values are reserved for future use.</p>
</div>
<div class="section" id="sdtx-event-latch-status">
<h4><a class="toc-backref" href="#id24"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code></a><a class="headerlink" href="#sdtx-event-latch-status" title="Permalink to this headline">¶</a></h4>
<p>Sent when the latch status has changed, i.e. when the latch has been opened,
closed, or an error occurred. The current status is provided as payload:</p>
<table border="1" class="docutils" id="id10">
<caption><span class="caption-text">Latch-Status-Change Event Payload</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">status</span></code></td>
<td><code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code></td>
<td>Latch status.</td>
</tr>
</tbody>
</table>
<p>Possible values for <code class="docutils literal notranslate"><span class="pre">status</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_CLOSED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_OPENED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_OPEN</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_REMAIN_OPEN</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_CLOSE</span></code>.</li>
</ul>
<p>Other values are reserved for future use.</p>
</div>
<div class="section" id="sdtx-event-device-mode">
<h4><a class="toc-backref" href="#id25"><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_DEVICE_MODE</span></code></a><a class="headerlink" href="#sdtx-event-device-mode" title="Permalink to this headline">¶</a></h4>
<p>Sent when the device mode has changed. The new device mode is provided as
payload:</p>
<table border="1" class="docutils" id="id11">
<caption><span class="caption-text">Device-Mode-Change Event Payload</span><a class="headerlink" href="#id11" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="17%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Field</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">mode</span></code></td>
<td><code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code></td>
<td>Device operation mode.</td>
</tr>
</tbody>
</table>
<p>Possible values for <code class="docutils literal notranslate"><span class="pre">mode</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_TABLET</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_LAPTOP</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_STUDIO</span></code>.</li>
</ul>
<p>Other values are reserved for future use.</p>
</div>
</div>
<div class="section" id="ioctls">
<span id="id2"></span><h3><a class="toc-backref" href="#id26">IOCTLs</a><a class="headerlink" href="#ioctls" title="Permalink to this headline">¶</a></h3>
<p>The following IOCTLs are provided:</p>
<table border="1" class="docutils" id="id12">
<caption><span class="caption-text">Overview of DTX IOCTLs</span><a class="headerlink" href="#id12" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Number</th>
<th class="head">Direction</th>
<th class="head">Name</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x21</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">EVENTS_ENABLE</span></code></td>
<td>Enable events for the current file descriptor.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x22</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">EVENTS_DISABLE</span></code></td>
<td>Disable events for the current file descriptor.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x23</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_LOCK</span></code></td>
<td>Lock the latch.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x24</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_UNLOCK</span></code></td>
<td>Unlock the latch.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x25</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_REQUEST</span></code></td>
<td>Request clipboard detachment.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x26</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_CONFIRM</span></code></td>
<td>Confirm clipboard detachment request.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x27</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_HEARTBEAT</span></code></td>
<td>Send heartbeat signal to EC.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x28</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">-</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">LATCH_CANCEL</span></code></td>
<td>Cancel detachment process.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x29</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">R</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">GET_BASE_INFO</span></code></td>
<td>Get current base/connection information.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2A</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">R</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">GET_DEVICE_MODE</span></code></td>
<td>Get current device operation mode.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">0xA5</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">0x2B</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">R</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">GET_LATCH_STATUS</span></code></td>
<td>Get current device latch status.</td>
</tr>
</tbody>
</table>
<div class="section" id="sdtx-ioctl-events-enable">
<h4><a class="toc-backref" href="#id27"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_EVENTS_ENABLE</span></code></a><a class="headerlink" href="#sdtx-ioctl-events-enable" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x22)</span></code>.</p>
<p>Enable events for the current file descriptor. Events can be obtained by
reading from the device, if enabled. Events are disabled by default.</p>
</div>
<div class="section" id="sdtx-ioctl-events-disable">
<h4><a class="toc-backref" href="#id28"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_EVENTS_DISABLE</span></code></a><a class="headerlink" href="#sdtx-ioctl-events-disable" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x22)</span></code>.</p>
<p>Disable events for the current file descriptor. Events can be obtained by
reading from the device, if enabled. Events are disabled by default.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-lock">
<h4><a class="toc-backref" href="#id29"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_LOCK</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-lock" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x23)</span></code>.</p>
<p>Locks the latch, causing the detachment procedure to abort without opening
the latch on timeout. The latch is unlocked by default. This command will be
silently ignored if the latch is already locked.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-unlock">
<h4><a class="toc-backref" href="#id30"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_UNLOCK</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-unlock" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x24)</span></code>.</p>
<p>Unlocks the latch, causing the detachment procedure to open the latch on
timeout. The latch is unlocked by default. This command will not open the
latch when sent during an ongoing detachment process. It will be silently
ignored if the latch is already unlocked.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-request">
<h4><a class="toc-backref" href="#id31"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_REQUEST</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-request" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x25)</span></code>.</p>
<p>Generic latch request. Behavior depends on the context: If no
detachment-process is active, detachment is requested. Otherwise the
currently active detachment-process will be aborted.</p>
<p>If a detachment process is canceled by this operation, a generic detachment
request event (<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code>) will be sent.</p>
<p>This essentially behaves the same as a detachment button press.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-confirm">
<h4><a class="toc-backref" href="#id32"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CONFIRM</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-confirm" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x26)</span></code>.</p>
<p>Acknowledges and confirms a latch request. If sent during an ongoing
detachment process, this command causes the latch to be opened immediately.
The latch will also be opened if it has been locked. In this case, the latch
lock is reset to the unlocked state.</p>
<p>This command will be silently ignored if there is currently no detachment
procedure in progress.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-heartbeat">
<h4><a class="toc-backref" href="#id33"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_HEARTBEAT</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-heartbeat" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x27)</span></code>.</p>
<p>Sends a heartbeat, essentially resetting the detachment timeout. This
command can be used to keep the detachment process alive while work required
for the detachment to succeed is still in progress.</p>
<p>This command will be silently ignored if there is currently no detachment
procedure in progress.</p>
</div>
<div class="section" id="sdtx-ioctl-latch-cancel">
<h4><a class="toc-backref" href="#id34"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_LATCH_CANCEL</span></code></a><a class="headerlink" href="#sdtx-ioctl-latch-cancel" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IO(0xA5,</span> <span class="pre">0x28)</span></code>.</p>
<p>Cancels detachment in progress (if any). If a detachment process is canceled
by this operation, a generic detachment request event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code>) will be sent.</p>
<p>This command will be silently ignored if there is currently no detachment
procedure in progress.</p>
</div>
<div class="section" id="sdtx-ioctl-get-base-info">
<h4><a class="toc-backref" href="#id35"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_BASE_INFO</span></code></a><a class="headerlink" href="#sdtx-ioctl-get-base-info" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IOR(0xA5,</span> <span class="pre">0x29,</span> <span class="pre">struct</span> <span class="pre">sdtx_base_info)</span></code>.</p>
<p>Get the current base connection state (i.e. attached/detached) and the type
of the base connected to the clipboard. This is command essentially provides
a way to query the information provided by the base connection change event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code>).</p>
<p>Possible values for <code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sdtx_base_info.state</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_DETACHED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_BASE_ATTACHED</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_NOT_FEASIBLE</span></code>.</li>
</ul>
<p>Other values are reserved for future use.</p>
</div>
<div class="section" id="sdtx-ioctl-get-device-mode">
<h4><a class="toc-backref" href="#id36"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_DEVICE_MODE</span></code></a><a class="headerlink" href="#sdtx-ioctl-get-device-mode" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IOR(0xA5,</span> <span class="pre">0x2A,</span> <span class="pre">__u16)</span></code>.</p>
<p>Returns the device operation mode, indicating if and how the base is
attached to the clipboard. This is command essentially provides a way to
query the information provided by the device mode change event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_DEVICE_MODE</span></code>).</p>
<p>Returned values are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_LAPTOP</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_TABLET</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_STUDIO</span></code></li>
</ul>
<p>See <a class="reference internal" href="#c.sdtx_device_mode" title="sdtx_device_mode"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sdtx_device_mode</span></code></a> for details. Other values are reserved for future
use.</p>
</div>
<div class="section" id="sdtx-ioctl-get-latch-status">
<h4><a class="toc-backref" href="#id37"><code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_LATCH_STATUS</span></code></a><a class="headerlink" href="#sdtx-ioctl-get-latch-status" title="Permalink to this headline">¶</a></h4>
<p>Defined as <code class="docutils literal notranslate"><span class="pre">_IOR(0xA5,</span> <span class="pre">0x2B,</span> <span class="pre">__u16)</span></code>.</p>
<p>Get the current latch status or (presumably) the last error encountered when
trying to open/close the latch. This is command essentially provides a way
to query the information provided by the latch status change event
(<code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code>).</p>
<p>Returned values are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_CLOSED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_LATCH_OPENED</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_OPEN</span></code>,</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_REMAIN_OPEN</span></code>, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_ERR_FAILED_TO_CLOSE</span></code>.</li>
</ul>
<p>Other values are reserved for future use.</p>
</div>
</div>
<div class="section" id="a-note-on-base-ids">
<h3><a class="toc-backref" href="#id38">A Note on Base IDs</a><a class="headerlink" href="#a-note-on-base-ids" title="Permalink to this headline">¶</a></h3>
<p>Base types/IDs provided via <code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code> or
<code class="docutils literal notranslate"><span class="pre">SDTX_IOCTL_GET_BASE_INFO</span></code> are directly forwarded from the EC in the lower
byte of the combined <code class="xref c c-type docutils literal notranslate"><span class="pre">__u16</span></code> value, with the driver storing the EC type from
which this ID comes in the high byte (without this, base IDs over different
types of ECs may be overlapping).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_TYPE()</span></code> macro can be used to determine the EC device
type. This can be one of</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_TYPE_HID</span></code>, for Surface Aggregator Module over HID, and</li>
<li><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_TYPE_SSH</span></code>, for Surface Aggregator Module over Surface Serial
Hub.</li>
</ul>
<p>Note that currently only the <code class="docutils literal notranslate"><span class="pre">SSH</span></code> type EC is supported, however <code class="docutils literal notranslate"><span class="pre">HID</span></code>
type is reserved for future use.</p>
</div>
<div class="section" id="structures-and-enums">
<h3><a class="toc-backref" href="#id39">Structures and Enums</a><a class="headerlink" href="#structures-and-enums" title="Permalink to this headline">¶</a></h3>
<dl class="type">
<dt id="c.sdtx_device_mode">
enum <code class="descname">sdtx_device_mode</code><a class="headerlink" href="#c.sdtx_device_mode" title="Permalink to this definition">¶</a></dt>
<dd><p>Mode describing how (and if) the clipboard is attached to the base of the device.</p>
</dd></dl>

<p><strong>Constants</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_TABLET</span></code></dt>
<dd>The clipboard is detached from the base and the
device operates as tablet.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_LAPTOP</span></code></dt>
<dd>The clipboard is attached normally to the base
and the device operates as laptop.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_DEVICE_MODE_STUDIO</span></code></dt>
<dd>The clipboard is attached to the base in reverse.
The device operates as tablet with keyboard and
touchpad deactivated, however, the base battery
and, if present in the specific device model, dGPU
are available to the system.</dd>
</dl>
<dl class="type">
<dt id="c.sdtx_event">
struct <code class="descname">sdtx_event</code><a class="headerlink" href="#c.sdtx_event" title="Permalink to this definition">¶</a></dt>
<dd><p>Event provided by reading from the DTX device file.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct sdtx_event {
  __u16 length;
  __u16 code;
  __u8 data[];
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">length</span></code></dt>
<dd>Length of the event payload, in bytes.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">code</span></code></dt>
<dd>Event code, detailing what type of event this is.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">data</span></code></dt>
<dd>Payload of the event, containing <strong>length</strong> bytes.</dd>
</dl>
<p><strong>Description</strong></p>
<p>See <a class="reference internal" href="#c.sdtx_event_code" title="sdtx_event_code"><code class="xref c c-type docutils literal notranslate"><span class="pre">enum</span> <span class="pre">sdtx_event_code</span></code></a> for currently valid event codes.</p>
<dl class="type">
<dt id="c.sdtx_event_code">
enum <code class="descname">sdtx_event_code</code><a class="headerlink" href="#c.sdtx_event_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Code describing the type of an event.</p>
</dd></dl>

<p><strong>Constants</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_REQUEST</span></code></dt>
<dd>Detachment request event type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_CANCEL</span></code></dt>
<dd>Cancel detachment process event type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_BASE_CONNECTION</span></code></dt>
<dd>Base/clipboard connection change event type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_LATCH_STATUS</span></code></dt>
<dd>Latch status change event type.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">SDTX_EVENT_DEVICE_MODE</span></code></dt>
<dd>Device mode change event type.</dd>
</dl>
<p><strong>Description</strong></p>
<p>Used in <a class="reference internal" href="#c.sdtx_event" title="sdtx_event"><code class="xref c c-type docutils literal notranslate"><span class="pre">struct</span> <span class="pre">sdtx_event</span></code></a> to describe the type of the event. Further event
codes are reserved for future use. Any event parser should be able to
gracefully handle unknown events, i.e. by simply skipping them.</p>
<p>Consult the DTX user-space interface documentation for details regarding
the individual event types.</p>
<dl class="type">
<dt id="c.sdtx_base_info">
struct <code class="descname">sdtx_base_info</code><a class="headerlink" href="#c.sdtx_base_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Describes if and what type of base is connected.</p>
</dd></dl>

<p><strong>Definition</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct sdtx_base_info {
  __u16 state;
  __u16 base_id;
};
</pre></div>
</div>
<p><strong>Members</strong></p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">state</span></code></dt>
<dd>The state of the connection. Valid values are <code class="docutils literal notranslate"><span class="pre">SDTX_BASE_DETACHED</span></code>,
<code class="docutils literal notranslate"><span class="pre">SDTX_BASE_ATTACHED</span></code>, and <code class="docutils literal notranslate"><span class="pre">SDTX_DETACH_NOT_FEASIBLE</span></code> (in case a base
is attached but low clipboard battery prevents detachment). Other
values are currently reserved.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">base_id</span></code></dt>
<dd>The type of base connected. Zero if no base is connected.</dd>
</dl>
</div>
</div>
<div class="section" id="api-users">
<h2><a class="toc-backref" href="#id40">API Users</a><a class="headerlink" href="#api-users" title="Permalink to this headline">¶</a></h2>
<p>A user-space daemon utilizing this API can be found at
<a class="reference external" href="https://github.com/linux-surface/surface-dtx-daemon">https://github.com/linux-surface/surface-dtx-daemon</a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="san.html" class="btn btn-neutral float-right" title="Surface ACPI Notify" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cdev.html" class="btn btn-neutral" title="User-Space EC Interface (cdev)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright The kernel development community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'5.18.0-rc1-torvalds+',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>